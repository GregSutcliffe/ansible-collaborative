<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="The Ansible VMware modules as part of the current community.vmware Collection are extremely popular. According to GitHub, it's the second most forked Collection.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Introducing the VMware REST Ansible Content Collection | Ansible Collaborative</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../../assets/css/main.css">
<link rel="stylesheet" href="../../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/introducing-the-vmware-rest-ansible-content-collection/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Gonéri Le Bouder">
<link rel="prev" href="../developing-and-testing-ansible-roles-with-molecule-and-podman-part-2/" title="Developing and Testing Ansible Roles with Molecule and Podman - Part 2" type="text/html">
<link rel="next" href="../customer-spotlights-at-ansiblefest-2020/" title="Customer Spotlights at AnsibleFest 2020" type="text/html">
<meta property="og:site_name" content="Ansible Collaborative">
<meta property="og:title" content="Introducing the VMware REST Ansible Content Collection">
<meta property="og:url" content="https://ansible.com/blog/introducing-the-vmware-rest-ansible-content-collection/">
<meta property="og:description" content="The Ansible VMware modules as part of the current community.vmware Collection are extremely popular. According to GitHub, it's the second most forked Collection.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-09-29T00:00:00Z">
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../../">
        <img src="../../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="../archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
  <article class="post-text h-entry hentry postpage ansible-content" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Introducing the VMware REST Ansible Content Collection</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/goneri-le-bouder/">Gonéri Le Bouder</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-09-29T00:00:00Z" itemprop="datePublished" title="2020-09-29 00:00">2020-09-29 00:00</time></a>
            </p>
                    <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
<h2>Introducing the VMware REST Ansible Content Collection</h2>
<p>The VMware Ansible modules as part of the current <a href="https://galaxy.ansible.com/community/vmware">community.vmware Collection</a>
are extremely popular. According to GitHub, it's the second most forked Collection, just after
<a href="https://galaxy.ansible.com/community/general">community.general</a>.
The VMware modules and plugins for Ansible have benefited from a stream
of contributions from dozens of users. Many IT infrastructure engineers
rely on managing their VMware infrastructure by means of a simple
Ansible Playbook. The vast majority of the current VMware modules are
built on top of a dependent python library called
<a href="https://github.com/vmware/pyvmomi">pyVmomi</a>,
also known as vSphere Automation SDK for Python.</p>
<h3>Why a new VMware Ansible Content Collection?</h3>
<p>VMware has recently introduced the vSphere REST API for vSphere 6.0 and
later, which will likely replace the existing SOAP SDK used in the
<a href="https://galaxy.ansible.com/community/vmware">community.vmware</a>
Collection.</p>
<p>Since the REST API's initial release, vSphere support for the REST API
has only improved. Furthermore, there is no longer a need for any
dependent python packages. In order to maintain the existing VMware
modules in the
<a href="https://galaxy.ansible.com/community/vmware">community.vmware</a>
Collection, a set of modules specifically for interacting with the
VMware REST API is now available in the newly created
<a href="https://galaxy.ansible.com/vmware/vmware_rest">vmware.vmware_rest</a>
Collection.</p>
<p>If you compare modules used with the VMware vSphere API (SOAP) to the
ones using the REST API, you'll notice the REST API modules are not yet
feature complete, as this is an early release of the Collection. For
example, there currently is no way to create a cluster or a folder using
the modules in the
<a href="https://galaxy.ansible.com/vmware/vmware_rest" rel="noopener">vmware.vmware_rest</a>
Collection, but the API provides all you need for a VMware guest for
future Collection enablement and much more.</p>
<h3>Using the VMware REST API</h3>
<p>In order to understand how the new modules function against the new REST API, let's take a look at the REST API itself first.
For example, the <code>com.vmware.vcenter.vm.power</code> API endpoint changes the power state of a VM.
It's equivalent to the following sample URL:</p>
<div class="code"><pre class="code literal-block">https://vcenter.test/rest/vcenter/vm/<span class="se">\$</span>vm/power
</pre></div>

<p>With the vCenter 7.0 release, 723 total REST endpoints are exposed,
which can be discovered using the following <code>curl</code> command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>curl<span class="w"> </span>-k<span class="w"> </span>https://vcenter.test/rest/com/vmware/vapi/metadata/cli/command<span class="p">|</span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s2">".[][].path"</span><span class="p">|</span>uniq<span class="p">|</span>wc<span class="w"> </span>-l
<span class="m">723</span>
</pre></div>

<p>The VMware REST APIs are documented in the Swagger 2.0 format. You can
find the JSON files on your vCenter node in the following directory
path:</p>
<div class="code"><pre class="code literal-block">root@vcenter<span class="w"> </span><span class="o">[</span><span class="w"> </span>/etc/vmware-vapi/apiexplorer/json<span class="w"> </span><span class="o">]</span><span class="c1"># ls -lh</span>
total<span class="w"> </span><span class="m">3</span>.3M
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w">  </span><span class="m">145</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>api.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>396K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>appliance.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>153K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>cis.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>272K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>content.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>395K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>esx.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>153K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>stats.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>176K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>vapi.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span><span class="m">1</span>.8M<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>vcenter.json
</pre></div>

<p>To summarize, the
<a href="https://galaxy.ansible.com/vmware/vmware_rest">vmware.vmware_rest</a>
Collection has all these REST endpoints ready to be consumed with the
descriptions in a well documented format.</p>
<h3>Building the vmware_rest Collection</h3>
<p>The modules contained in this Collection are generated using a tool
called 
<a href="https://github.com/ansible-collections/vmware_rest_code_generator">vmware_rest_code_generator</a>,
which was developed and open sourced by the Ansible team. It loads the
Swagger files and then auto-generates a module per each resource,
generating more than 300 modules this way. You'll notice that not every
module has been released to the Collection. For purposes of starting
small, we are only generating modules against a subset of the endpoints
exposed, only those associated with guest management use cases. We may
expand and extend the number of modules over time.</p>
<h3>Using the vmware_rest Collection</h3>
<p>The following tasks retrieve a list of the VM, shuts them down, and then deletes them:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect the list of the existing VM</span>
<span class="w">  </span><span class="nt">vcenter_vm_info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">existing_vms</span>
<span class="w">  </span><span class="nt">until</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">existing_vms is not failed</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Turn off the VM</span>
<span class="w">  </span><span class="nt">vcenter_vm_power</span><span class="p">:</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stop</span>
<span class="w">    </span><span class="nt">vm</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">item.vm</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">existing_vms.value</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">  </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete some VM</span>
<span class="w">  </span><span class="nt">vcenter_vm</span><span class="p">:</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="w">    </span><span class="nt">vm</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">item.vm</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">existing_vms.value</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Refer to the following gist file for more information:
<a href="https://gist.github.com/goneri/6afd05397390cf5a0976f3611814949a">https://gist.github.com/goneri/6afd05397390cf5a0976f3611814949a</a></p>
<h3>Downloading the vmware_rest Collection</h3>
<p>The goal of this early release is to get as much community feedback as
possible.</p>
<p>The Collection is available on Ansible Galaxy, and requires the
following:</p>
<ul>
<li>Ansible 2.9 or later </li>
<li>Python 3.6 or later</li>
<li>The <code>aiohttp</code> package</li>
</ul>
<p>Use the <code>ansible-galaxy</code> command to retrieve the Collection:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ansible-galaxy collection install vmware.vmware_rest</span>
</pre></div>

<p>If you use a virtualenv, you can install <code>aiohttp</code> with following command:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># pip install aiohttp</span>
</pre></div>

<p>Else, you will need to download and install the <code>python3-aiohttp</code> package.</p>
<p>To read the module documentation, use the <code>ansible-doc</code> command.
For example, to read documentation for the <code>vcenter_cluster_info</code> module, refer to the following command:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ansible-doc -t module vmware.vmware_rest.vcenter_cluster_info</span>
</pre></div>

<h3>vCenter-Managed Object Reference ID</h3>
<p>If you are already using the community.vmware Collection, the main
difference is that the newer modules rely on the MORef ID to identify
the elements instead of the name of the object. For example, if the user
creates a datacenter called dc1, the MORef ID using the new modules will
be datacenter-2. The community.vmware Collection uses the name and the
folder instead.</p>
<p>By using the MORef ID directly, the module is able to interact with the
resource without any time consuming preliminary look up.</p>
<h3>How can I contribute?</h3>
<p>Because the modules are auto-generated, it GitHub pull requests should
be raised against the <a href="https://github.com/ansible-collections/vmware_rest_code_generator">code generator</a>
itself, and not the resulting Collection contents.</p>
<p>Don't hesitate to report any issues on the GitHub project at
<a href="https://github.com/ansible-collections/vmware_rest/issues">https://github.com/ansible-collections/vmware_rest/issues</a>.</p>
<p>Reference:</p>
<p>The forks per collection can be found programmatically by accessing the Github API:
<a href="https://api.github.com/orgs/ansible-collections/repos">https://api.github.com/orgs/ansible-collections/repos</a> </p>
<p>This can be sorted, for example:</p>
<div class="code"><pre class="code literal-block">method:<span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.github.com/orgs/ansible-collections/repos<span class="p">|</span>jq<span class="w"> </span>-r<span class="w"> </span>-c<span class="w"> </span>--sort-keys<span class="w"> </span><span class="s1">'.|sort_by(.forks)|reverse|.[]|[.name, .forks]'</span>
</pre></div>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../developing-and-testing-ansible-roles-with-molecule-and-podman-part-2/" rel="prev" title="Developing and Testing Ansible Roles with Molecule and Podman - Part 2">Previous post</a>
            </li>
            <li class="next">
                <a href="../customer-spotlights-at-ansiblefest-2020/" rel="next" title="Customer Spotlights at AnsibleFest 2020">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
