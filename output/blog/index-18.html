<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Ansible Collaborative Website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ansible Collaborative (old posts, page 18) | Ansible Collaborative</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/index-18.html">
<link rel="prev" href="index-19.html" type="text/html">
<link rel="next" href="index-17.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../">
        <img src="../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
    
  <div class="postindex ansible-content">
      <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-76/" class="u-url">Bullhorn #76</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-76/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-30T17:45:00Z" itemprop="datePublished" title="2022-09-30 17:45">2022-09-30 17:45</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #76, 2022-09-30 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-75/" class="u-url">Bullhorn #75</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-75/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-26T12:00:00Z" itemprop="datePublished" title="2022-09-26 12:00">2022-09-26 12:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #75, 2022-09-23 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-74/" class="u-url">Bullhorn #74</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-74/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-16T23:00:00Z" itemprop="datePublished" title="2022-09-16 23:00">2022-09-16 23:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #74, 2022-09-16 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="ansible-vs.-terraform-demystified/" class="u-url">Ansible versus Terraform Demystified</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/sean-cavanaugh/">Sean Cavanaugh</a>
              </span>
            </p>
            <p class="dateline">
              <a href="ansible-vs.-terraform-demystified/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-13T00:00:00Z" itemprop="datePublished" title="2022-09-13 00:00">2022-09-13 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Ansible versus Terraform Demystified</h2>
<blockquote>
<p>Consider also checking out the article <a href="https://www.redhat.com/en/topics/automation/ansible-vs-terraform">Ansible vs. Terraform</a>, clarified on RedHat.com</p>
</blockquote>
<p>Ansible and Terraform are two very powerful but unique open source IT
tools that are often compared in competitive discussions.  We often see
comparisons of the two tools - but many times, these comparisons are
done purely from a "spec sheet" comparison. This type of comparison,
while an interesting read, doesn't take into account using the products
at scale or if the comparison is realistic as a binary all-or-nothing
approach. We at Red Hat have been helping enterprises for over 20 years
and have a good idea how most IT administrators are using these two
tools in production. Although both tools <em>can</em> generally do most things,
we typically see that they are each leveraged by means of their biggest
strengths as opposed to having to choose one or the other.</p>
<p>Spoiler:  The two tools are better together and can work in harmony to
create a better experience for developers and operations teams.</p>
<p>Both Ansible and Terraform are open source tools with huge user bases,
which often leads to cult followings because of the classical "hammer"
approach.  That is, if my only tool is a hammer, every problem will
start resembling a nail. This ends up trying to solve new problems the
only way I know how, rather than trying another tool that might be more
effective.  It is never a great idea to only understand one tool and its
approach and philosophy. Instead, you should open your mind to
understanding why different tools and platforms exist, and why
successful organizations may be using both.  In this blog we will go
over the differences and similarities between Ansible and Terraform, the
open source projects and their downstream enterprise products.  Keep in
mind that this is a blog and to check the date for relevancy as products
and projects are constantly changing and evolving.</p>
<h3>Terraform</h3>
<p>Terraform is an open source project that is sponsored by the company
HashiCorp. Terraform is one of several open source projects that have
been productized by HashiCorp; other projects include Vagrant, Packer,
Consul and Vault.  HashiCorp specifically has a design philosophy called
the <a href="https://www.hashicorp.com/tao-of-hashicorp">Tao of HashiCorp</a> where
they want their projects and products to be simple, modular, and
composable. In this case, each project and product pairing has well
defined scopes and for larger workflows you would combine multiple
projects and products.  They define Terraform with the following
purpose:</p>
<p>Terraform is the infrastructure as code offering from HashiCorp. It is
a tool for building, changing, and managing infrastructure in a safe,
repeatable way. Operators and Infrastructure teams can use Terraform to
manage environments with a configuration language called the HashiCorp
Configuration Language (HCL) for human-readable, automated
deployments. <a href="https://learn.hashicorp.com/tutorials/terraform/infrastructure-as-code">source</a></p>
<p>Terraform is mainly command-line only, but is well integrated with a set
of popular public clouds. Terraform is great at provisioning fixed sets
of cloud infrastructure and tearing them down afterwards.  HashiCorp
provides two productization methods of Terraform for customers, they can
either self-manage their custom deployment with Terraform Enterprise or
they can use their managed service <a href="https://www.hashicorp.com/products/terraform/pricing">Terraform Cloud</a>.
Their
business tier provides drift detection, SSO Audit logs, self-hosted
agents and customized concurrency.</p>
<h3>Ansible</h3>
<p>Ansible is an IT automation tool. It can configure systems, deploy
software, and orchestrate more advanced IT tasks such as continuous
deployments or zero downtime rolling updates.  Most people are familiar
with community Ansible, which is the command-line tool for running
Ansible Playbooks.  Like Terraform, Ansible focuses on simplicity and
ease-of-use.  Ansible uses <a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html">YAML syntax</a> for
Ansible playbooks.  We use YAML because it is easier for humans to read
and write than other common data formats like XML or JSON.</p>
<p>Red Hat Ansible Automation Platform is the product that is offered to
customers.  It is built on the foundations of Ansible with numerous
enterprise features, combining more than a dozen upstream projects into
an integrated, streamlined product. Each product component also has a
specific purpose with a well defined scope similar to HashiCorp's design
philosophy.  For example, the automation controller is the Web UI and
API for Ansible automation, which is based on the upstream project AWX.
 This component is bundled into the platform to manage automation.
Ansible Automation Platform is available to be <a href="https://www.redhat.com/en/technologies/management/ansible/trial?extIdCarryOver=true&amp;sc_cid=701f2000000txokAAA">run on-premises</a> and
charged by node (rather than by user) or you can use the
<a href="https://www.redhat.com/en/technologies/management/ansible/azure">managed service offering on Microsoft Azure</a>.</p>
<p>To summarize, both Ansible and Terraform have open source command-line
only versions.  They both have products available with enterprise
features such as a Web UI or SSO.  The primary difference for their
community versions is that Ansible is an multi-purpose automation tool,
whereas Terraform is an infrastructure as code tool.  The confusion
starts occurring because there are numerous use cases that could
potentially be solved by either tool, and both Ansible and Terraform
have plugins to call each other.  For example, many Ansible experts
simply provision AWS resources with an Ansible Playbook and might not
understand why others use an entirely different tool. Similarly,
Terraform experts might create and destroy entire instances for even the
smallest configuration change (see next section about immutability).</p>
<h3>Immutable Infrastructure: The Killer App?</h3>
<p>Terraform takes an immutable approach to infrastructure.  If you are
unfamiliar with immutable infrastructure, it is defined as instances
that do not change over time or are unable to be changed. To greatly
simplify, an IT operator can create a declarative file (a Terraform HCL
file) that represents in structured data what they want their end-state
cloud footprint to look like and deploy this with Terraform.  One of the
advantages of this approach is that it creates a single source of truth
(that HCL file) that can be deployed over and over again without having
to understand how it gets to the end-state.  This approach can be simple
and elegant for individuals getting started quickly but depending on the
size of infrastructure can become <a href="https://www.youtube.com/watch?v=wRgQxfrFJYU">complex and hard to manage</a>.
Another advantage
of an immutable approach is that it is just as easy to tear down
(de-provision) your cloud resources. This allows developers to quickly
spin up resources, test something, then tear them down.</p>
<p>Ansible, by design, takes an imperative approach to automation.  You
simply have a task list that iterates through each resource.  You would
tell it to provision this VPC, this subnet, then this VM.  The advantage
of this approach is it is very simple to understand, there is no hidden
magic, which helps it become easy to troubleshoot.  The disadvantage is
usually it is more cumbersome to do teardowns and de-provision without
knowing the correct order.  I have to delete the instance, then the
security group, and so on and so forth. However, Ansible has support for
calling both AWS CloudFormation (another immutable and declarative
approach for AWS), and Terraform.  In fact, Ansible Automation Platform
does this for all major public clouds, and encourages people to use
their preference for provisioning and de-provisioning.  This is a great
example of how Terraform and Ansible are better together.</p>
<p><strong>Important:</strong> Although Ansible is not universally immutable, depending
on how you implement your individual tasks, some Ansible tasks can be
immutable.</p>
<p>Here's an example: You can have an Ansible Playbook that provisions a
Linux virtual machine into a public cloud using a CloudFormation
Template, and then subsequently installs an application via the
<a href="https://docs.ansible.com/ansible/latest/collections/ansible/builtin/dnf_module.html">dnf Ansible module</a>.
This activity would be entirely immutable by Ansible.  Most Ansible
modules are designed to be
<a href="https://docs.ansible.com/ansible/latest/reference_appendices/glossary.html#term-Idempotency">idempotent</a> so
that they only make changes when they need to.  Ansible is extremely
flexible, and it's easy to just automate shell commands which are not
idempotent and change every time the playbook is run.  This showcases
how Ansible shines as a multi-purpose automation tool versus a discrete
infrastructure as code tool.  </p>
<h3>Use Cases Compared</h3>
<p>If you read all the articles about Terraform, you will find they are
public-cloud focused. This is where immutable infrastructure works well
and Terraform is great at provisioning cloud resources and applications
for AWS, Azure, Docker, GCP, and OCI.  However, there is more to IT
operations than automated infrastructure provisioning and this is why
Ansible is extremely popular as well.  This is not a knock on Terraform,
it is a specific tool with a specific purpose and ethos designed
purposely to do infrastructure as code.  However, this infrastructure as
code wholly depends on how you define your infrastructure.  Is my
critical Cisco IOS network switch not infrastructure?  IT Infrastructure
can mean a lot of different things to different IT administrators
depending on if they are a network engineer, cloud operations engineer,
system administrator or have another title or role.</p>
<p>Ansible focuses on automation with a variety of use cases that are
typically divided up into domains, due to their legacy silos:</p>
<ul>
<li>Infrastructure automation - includes automation of Linux and
    Microsoft Windows, as well as storage vendors like NetApp,
    PureStorage, and HPE.</li>
<li>Network automation - includes physical switches, routers, load
    balancers, and SDN controllers from popular vendors such as Arista,
    Cisco, F5 and Juniper.</li>
<li>Security automation - integrates SIEM, IDPS, and firewalls from
    vendors like IBM, Checkpoint, and ITSM tools like ServiceNow.  </li>
<li>Edge and hybrid cloud footprints.</li>
</ul>
<h3>Moving to an Event-Driven IT Strategy</h3>
<p>As opposed to Terraform, Ansible is more focused on the entire IT
workflow. For example, consider the following workflow:</p>
<ol>
<li>Deploy a Web Application to AWS.</li>
<li>Update your ServiceNow ITSM with Web Application Information.</li>
<li>Run a schedule to check every hour that the Web Application is
    responding on the correct ports <em>or</em> use event streams to monitor
    ports and the application for further automation.</li>
<li>Update/Create a ServiceNow ticket if the Web Application stops
    responding and attempts automation for remediation.</li>
</ol>
<p>In the above example, it is not enough to simply provision a web
application into a public cloud.  There are other steps that need to
take place in this automation workflow.  We need the automation to sync
with the customer\'s ITSM tool, and include event-driven checks for the
web application to ensure it is operating correctly (we call this
continuous IT compliance).  Stateful automation can even guarantee this
service is kept running while human operators make changes out of band
from your automation.</p>
<h3>Better: Ansible Orchestrating Terraform</h3>
<p>Terraform is an excellent cloud provisioning and de-provisioning tool
for infrastructure as code.  Ansible is a great all-purpose,
cross-domain automation solution.  Both have an amazing open source
communities and well supported downstream paid products.  What we see
with the community, customers and even our own IT workflows is that you
can combine these tools and solutions to create even more amazing IT
workflows.  If you are already invested with Terraform, Ansible simply
allows you to wrap those HCL templates into more holistic automation
workflows. Ansible further extends your automation allowing you to add
tasks like configuration management and application deployment to the
Terraform IaC deployment.</p>
<h3>How are people using Ansible?</h3>
<p>We've noticed that many IT administrators refer to the specific "cloud
deployment and retirement" use case rather than looking at other cloud
operations use cases, such as Day 2 operations.  To help spark some
ideas, let's highlight some Ansible cloud automation use cases today
outside of just provisioning and de-provisioning cloud resources.</p>
<ul>
<li>
<strong>Infrastructure visibility -</strong> This is simply using Ansible to
    retrieve information from your public clouds to understand your
    cloud footprint.  This is very helpful for brownfield environments
    where there are numerous IT administrators configuring resources
    out-of-band from each other.  When there isn't a forced IT process,
    it is a great starter use case because it is read-only and requires
    no production changes.</li>
<li>
<strong>Compliance -</strong> We need to not only treat cloud infrastructure as
    code, but also the cloud as code.  For example, we can enforce IAM
    policies and make sure there is a common experience across public
    clouds.  Another example would be to force a tag policy across your
    instances for billing and auditing and shutting down instances out
    of compliance.  What's great about Ansible is that it can operate
    and enforce these policies on mutable and immutable infrastructure.</li>
<li>
<strong>Business continuity -</strong> Ansible can help keep the lights on.  Move
    and copy resources off cloud, create and manage policies for backups
    and build automation to manage disruptions and failures.</li>
<li>
<strong>Cloud operations -</strong> Ansible can automate Day 2 activities.  This
    includes application deployments and CI/CD pipelines, lifecycle
    management and enforcement as well as OS patching and maintenance.</li>
<li>
<strong>Cloud migration -</strong> Ansible can help move workloads to where you
    need them.  For example, adopting automation for your on-premises
    infrastructure can help operators adopt public cloud.  Making sure
    your source of truth is automation versus the on-box configurations
    is the first step for cloud migration.  Ansible automation can also
    reduce friction for migration to cloud native, allowing developers
    to migrate off legacy infrastructure.  By using Ansible automation,
    an IT group can help unify automation architecture across legacy and
    cloud-native.</li>
<li>
<strong>Infrastructure optimization -</strong> Adopting clouds can help IT
    operators save time and money, but initially it\'s hard to predict
    costs and understand how your billing requirements change.  Having
    an automation strategy can help you keep costs under control by
    turning off unused resources, rightsizing cloud resources and
    combining with use cases like infrastructure visibility, you can
    easily recover orphaned resources and make sure there are no
    surprise costs.</li>
<li>
<strong>Infrastructure orchestration -</strong> We talked about this previously,
    but how are you integrating everything that's not in your public
    cloud? Orchestration is simply how we break down silos and integrate
    with infrastructure outside the cloud.  This allows IT operators to
    orchestrate business outcomes versus tech silos and apply consistent
    compliance across all infrastructure.</li>
<li>
<strong>Automated troubleshooting -</strong> As your IT team gains confidence
    with automation, we can move towards an event-driven architecture.
     This allows IT teams to respond faster to incidents, speed up
    meantime to resolution and integrate with an organization's ITSM
    solution.</li>
</ul>
<h3>Are people succeeding?</h3>
<p>The quick answer? Yes! Even automating Terraform with Ansible! But
holistic automation goes beyond doing one thing well in the cloud.
Ansible can automate and orchestrate physical, virtual and cloud
resources. It can automate the provisioning, configuration management,
and manage Day 2 operations of network devices, Windows servers, storage
and of course Linux. But regardless of what people decide to use to
solve a problem, we've found that the real issues aren't with "what" or
"how" a problem is solved from a technology perspective, but more about
standardizing across technology domains while growing up and out to
scale across the entire IT organization.</p>
<p>One of the most impressive and recent success stories using Ansible
Automation Platform in the cloud was by Asian Development Bank. The
published <a href="https://www.redhat.com/en/resources/asian-development-bank-case-study">case study</a>
details how they modernized their infrastructure while at the same time
modernizing their workforce, allowing them more time to focus on more
important things, like innovative projects and new service offerings.
They standardized on Terraform for Day 0 while standardizing on Ansible
Automation Platform for Day 1 and Day 2 operations. Check out their
story in the embedded
<a href="https://www.redhat.com/en/resources/asian-development-bank-case-study">video</a>!</p>
<h3>Final Thoughts</h3>
<p>The confusion between Ansible and Terraform has existed for some time,
either through inaccurate (or outdated) source material or through
inexperience in using either/both technologies. This blog post (while
somewhat biased) should help to at least start the conversation around
the deeper connections between Ansible and Terraform. Every situation,
use case, and person implementing the solution can be different, but
because of these factors we believe Ansible is the best solution for
automation.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="the-anatomy-of-automation-execution-environments/" class="u-url">The anatomy of automation execution environments</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/anshul-behl/">Anshul Behl</a>
              </span>
            </p>
            <p class="dateline">
              <a href="the-anatomy-of-automation-execution-environments/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-12T00:00:00Z" itemprop="datePublished" title="2022-09-12 00:00">2022-09-12 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>The anatomy of automation execution environments</h2>
<p>Red Hat Ansible Automation Platform 2 introduced  major architectural
changes, like automation mesh and automation execution environments,
that help extend Ansible automation across your organization in a
flexible manner, providing a single solution to all your organizational
and hybrid cloud automation needs.</p>
<p>Automation execution environments are container images that act as
Ansible runtimes for automation controller jobs. Ansible Automation
Platform also includes a command-line tool called
ansible-builder(execution environment builder)that lets you create
automation execution environments by specifying Ansible Content
Collections and Python dependencies.</p>
<p>In general, an automation execution environment includes:</p>
<ul>
<li>A version of Python.</li>
<li>A version of ansible-core.</li>
<li>Python modules/dependencies.</li>
<li>Ansible Content Collections (optional).</li>
</ul>
<p><img alt="diagram of an execution environment" src="../images/posts/archive/execution-environment-ubi.png"></p>
<p>In this blog, I will take you through the inner workings of
ansible-builder and <strong>how</strong> all the above requirements are packaged
inside automation execution environments and delivered as part of
Ansible Automation Platform.</p>
<h2>A tale of two ansible-builder packages</h2>
<p>As all projects in Red Hat, ansible-builder follows an open development
model and an upstream-first approach. The upstream project for
<a href="https://github.com/ansible/ansible-builder">ansible-builder</a> is
distributed as a Python package, and then packaged into an RPM for
Ansible Automation Platform downstream. This
also means that there are different ways to install the upstream package
and the downstream ansible-builder.</p>
<p>NOTE: To get the downstream packages, you must subscribe to Ansible
Automation Platform repos from Red Hat.</p>
<p>Upstream:</p>
<div class="code"><pre class="code literal-block">pip3<span class="w"> </span>install<span class="w"> </span>ansible-builder
</pre></div>

<p>Downstream: </p>
<div class="code"><pre class="code literal-block">dnf<span class="w"> </span>install<span class="w"> </span>ansible-builder
</pre></div>

<p>This has sometimes led to confusions among users, as customers of
Ansible Automation Platform can also install the Python package for
free. There are minor differences between both upstream and downstream
packages that you should understand before diving deeper into building
automation execution environments.</p>
<p>As mentioned earlier, automation execution environments are container
images that act as Ansible runtimes and ansible-builder is quite similar
to generally available container engines such as Podman and Docker. So
like any other container engine, the concept of building an image starts
with a base image; that is where the upstream and downstream packages
for ansible-builder differ. The base images used in upstream
ansible-builder (Python package) as predefined constants are as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">EE_BASE_IMAGE</span><span class="o">=</span><span class="s1">'quay.io/ansible/ansible-runner:latest'</span>
<span class="nv">EE_BUILDER_IMAGE</span><span class="o">=</span><span class="s1">'quay.io/ansible/ansible-builder:latest'</span>
</pre></div>

<p>Base images in the downstream package are as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nv">EE_BASE_IMAGE</span><span class="o">=</span><span class="s1">'registry.redhat.io/ansible-automation-platform-22/ee-minimal-rhel8:latest'</span>
<span class="nv">EE_BUILDER_IMAGE</span><span class="o">=</span><span class="s1">'registry.redhat.io/ansible-automation-platform-22/ansible-builder-rhel8:latest'</span>
</pre></div>

<p>Upstream base images are available through Red Hat Quay.io, while the
downstream ones come from Red Hat Ecosystem Catalog(registry.redhat.io),
which requires authentication with a Red Hat account. The other
difference in these images is that upstream ones use CentOS image as the
base image while the downstream ones use Red Hat Universal Base Image
(UBI). UBI offers greater reliability, security, and performance for
official Red Hat container images compared with CentOS images.</p>
<p>One commonality for the upstream and downstream packages is that they
both allow image configuration through an automation execution
environment specification file called execution-environment.yml.</p>
<p>Whether you are an Ansible Automation Platform customer or a community
user of ansible-builder, you can use UBI images as base images or the
CentOS images for your automation execution environments based on the
package or by  passing a different set of base images to your automation
execution environment specification file.</p>
<h2>Why does the ansible-builder package have two base images?</h2>
<p>Continuing from the previous section that introduce the upstream and
downstream base images for ansible-builder, there are two arguments that
specify which images to use:</p>
<ul>
<li>The <code>EE_BASE_IMAGE</code> build argument specifies the parent image for the
    automation execution environment.</li>
<li>The <code>EE_BUILDER_IMAGE</code> build argument specifies the image used for
    compiling type tasks.</li>
</ul>
<p>For most container images, you generally only need one base image on top
of which you add different instructions, also known as build steps, to
create your final container image.</p>
<p>However, the base automation execution environment (ee-minimal) is built
using the multi-stage build concept of containers. The <code>EE_BUILDER_IMAGE</code>
build argument serves as the intermediary step to install Collections
and build dependencies to keep the base image size as low as possible.</p>
<p>Let's take an example: Suppose your Ansible Content Collection depends
on a Python package that needs to be compiled using python-dev package
(e.g. NumPy). Because python-dev is a compile time dependency, you don't
necessarily need it in the final package (you just need the NumPy
package). You wouldn't want to include python-dev in the final image to
keep the image size as low as possible. For this purpose, the
<code>EE_BUILDER_IMAGE</code> is used to build dependencies and then copy over only
the package wheels needed for the final automation execution
environment.</p>
<h3>Does this matter if I want to build a custom automation execution environment?</h3>
<p>In most cases it doesn't matter. When you build your automation
execution environment using ansible-builder, you just need <code>EE_BASE_IMAGE</code>
and not <code>EE_BUILDER_IMAGE</code>. However, you should understand how a compile
time binary dependency is applied in the execution-environment
definition file called bindep.txt. For the above example, if you need to
install the NumPy Python package as a dependency for your Collection on
UBI8, you specify the bindep.txt and requirements.txt as follows:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># bindep.txt</span>
python38-devel<span class="w"> </span><span class="o">[</span>compile<span class="w"> </span>platform:rhel-8<span class="o">]</span><span class="w"> </span><span class="c1">#compile time dependency</span>
</pre></div>

<div class="code"><pre class="code literal-block"><span class="c1"># requirements.txt</span>
NumPy
</pre></div>

<p>There will be instances where the configuration in the automation
execution environment specification isn't reflected or errors occur when
you're building the automation execution environment. In these
instances, it's important to understand the role for the
EE_BUILDER_IMAGE. The next section explains this in more detail.</p>
<h2>Automation execution environment design</h2>
<p><img alt="diagram picture of automation execution environment design" src="../images/posts/archive/execution-environment-diagram.png"></p>
<p>The above diagram outlines how automation execution environments are
designed. I have mentioned the upstream image name and the downstream
counterparts in the same boxes.</p>
<p>For reference, CentOS 8 and UBI8 (for downstream) serve as the base
images for the python-base container image, which acts as the image for
running python-based projects, hence it bundles a version of Python that
is supported by the ansible-core package (python 3.8 for reference).</p>
<p>This python-base image serves as the base image for both the
python-builder image as well as the ansible-runner (ee-minimal
downstream) image. To summarize the purpose of python-builder and
ansible-builder images, they build Python projects such as ansible-core
and any Collections that are dependent on Python. For instance, if your
Collection relies on Python dependencies for which wheels need to be
built on the machine itself, they are built on the python-builder image.</p>
<p>Finally, the ansible-runner (ee-minimal downstream) image includes a
version of the ansible-core package. The ansible-builder image works in
conjunction with this image to build Python wheels, so that the final
automation execution environment size is minimal by only keeping things
that are necessary to run your required automation. custom-ee1 and
custom-ee2 in the diagram represent any custom automation execution
environments that can be created using ansible-runner (ee-minimal
downstream) and the ansible-builder image.</p>
<h2>Verifying your base images</h2>
<p>To start building your custom automation execution environments, you
should first verify which <code>EE_BASE_IMAGE</code> and <code>EE_BUILDER_IMAGE</code> are used in
ansible-builder by default. To verify, first create an empty automation
execution environment definition file called execution-environment.yml</p>
<div class="code"><pre class="code literal-block">touch<span class="w"> </span>execution-environment.yml
</pre></div>

<p>Then create a build context from the empty definition file by running
this command in the same directory where you created the empty
definition file:</p>
<div class="code"><pre class="code literal-block">ansible-builder<span class="w"> </span>create
</pre></div>

<p>This will create a context directory in your working directory which
includes a Containerfile. Opening the Containerfile shows which images
are set as the BASE and BUILDER images and tells you which
ansible-builder you are using, the upstream or the downstream one. For
instance, if you open the Containerfile created through the above
process and a pip install of ansible-builder, you see the following
content:</p>
<div class="code"><pre class="code literal-block">ARG<span class="w"> </span><span class="nv">EE_BASE_IMAGE</span><span class="o">=</span>quay.io/ansible/ansible-runner:latest
ARG<span class="w"> </span><span class="nv">EE_BUILDER_IMAGE</span><span class="o">=</span>quay.io/ansible/ansible-builder:latest

FROM<span class="w"> </span><span class="nv">$EE_BASE_IMAGE</span><span class="w"> </span>as<span class="w"> </span>galaxy
ARG<span class="w"> </span><span class="nv">ANSIBLE_GALAXY_CLI_COLLECTION_OPTS</span><span class="o">=</span>
USER<span class="w"> </span>root


FROM<span class="w"> </span><span class="nv">$EE_BUILDER_IMAGE</span><span class="w"> </span>as<span class="w"> </span>builder

FROM<span class="w"> </span><span class="nv">$EE_BASE_IMAGE</span>
USER<span class="w"> </span>root
COPY<span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/output/<span class="w"> </span>/output/
RUN<span class="w"> </span>/output/install-from-bindep<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/output/wheels
</pre></div>

<p>In the first two lines you can observe that the images point to the
upstream images. If you do the same process on the downstream install of
ansible-builder, you find the downstream images in a similar
Containerfile.</p>
<h2>Using the ansible-builder context</h2>
<p>The context building is an important aspect of ansible-builder. You can
use the context to change the Containerfile and customize your
automation execution environments to your needs. You can use this
context and the knowledge of multi-stage builds using BUILDER and BASE
images to build an automation execution environment in a disconnected
environment. The following shows an execution-environment definition
that pulls the BUILDER and BASE images from a private automation hub
instance:</p>
<div class="code"><pre class="code literal-block"><span class="gh">#</span> cat execution-environment.yml
---
version: 1
build_arg_defaults:
  EE_BASE_IMAGE: 'automation-hub.demolab.local/ansible-automation-platform-22/ee-minimal-rhel8:latest'
  EE_BUILDER_IMAGE: 'automation-hub.demolab.local/ansible-automation-platform-22/ansible-builder-rhel8:latest'

dependencies:
  python: requirements.txt
</pre></div>

<p>And the contents of the requirements.txt file are as follows:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># cat requirements.txt</span>
<span class="nv">dnspython</span><span class="o">==</span><span class="m">1</span>.15.0
</pre></div>

<p>Let's create a context for the above definition file,
execution-environment.yml:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ansible-builder create</span>
Complete!<span class="w"> </span>The<span class="w"> </span>build<span class="w"> </span>context<span class="w"> </span>can<span class="w"> </span>be<span class="w"> </span>found<span class="w"> </span>at:<span class="w"> </span>/root/disconnected_ee/context
</pre></div>

<p>The following issues may arise when building an automation execution
environment in a disconnected environment (this example takes into
account the building of a downstream image):</p>
<ul>
<li>Cannot reach the external yum repositories.</li>
<li>Cannot pull Python dependencies from an external PyPI server, so
    using an internal PyPI proxy when building an automation execution
    environment.</li>
<li>(Optional) SSL certificate issues when pulling from internal PyPI
    mirror.</li>
</ul>
<p>Firstly, create a pip.conf that points to the local mirror:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># cat context/pip.conf</span>
<span class="o">[</span>global<span class="o">]</span>
index-url<span class="w"> </span><span class="o">=</span><span class="w"> </span>https://nexus-nexus.apps.celeron.demolab.local/repository/pypi-proxy/simple/
</pre></div>

<p>You add the above pip.conf file and the certificate to the context
folder for the targeted automation execution environment creation to add
these files inside your custom execution-environment.</p>
<p>Using the multi-stage build knowledge and context editing, edit the
Containerfile. Note the sections marked in bold text as well as some
comments. These are the changes to build an automation execution
environment in a disconnected fashion.</p>
<div class="code"><pre class="code literal-block"><span class="c1"># cat Containerfile</span>
ARG<span class="w"> </span><span class="nv">EE_BASE_IMAGE</span><span class="o">=</span>automation-hub.demolab.local/ansible-automation-platform-21/ee-supported-rhel8:latest
ARG<span class="w"> </span><span class="nv">EE_BUILDER_IMAGE</span><span class="o">=</span>automation-hub.demolab.local/ansible-automation-platform-21/ansible-builder-rhel8:latest

FROM<span class="w"> </span><span class="nv">$EE_BASE_IMAGE</span><span class="w"> </span>as<span class="w"> </span>galaxy
ARG<span class="w"> </span><span class="nv">ANSIBLE_GALAXY_CLI_COLLECTION_OPTS</span><span class="o">=</span>
USER<span class="w"> </span>root

ADD<span class="w"> </span>_build<span class="w"> </span>/build
WORKDIR<span class="w"> </span>/build


FROM<span class="w"> </span><span class="nv">$EE_BUILDER_IMAGE</span><span class="w"> </span>as<span class="w"> </span>builder
ADD<span class="w"> </span>_build/requirements.txt<span class="w"> </span>requirements.txt
RUN<span class="w"> </span>ansible-builder<span class="w"> </span>introspect<span class="w"> </span>--sanitize<span class="w"> </span>--user-pip<span class="o">=</span>requirements.txt<span class="w"> </span>--write-bindep<span class="o">=</span>/tmp/src/bindep.txt<span class="w"> </span>--write-pip<span class="o">=</span>/tmp/src/requirements.txt

<span class="c1">####### Changes to create EE in a disconnected environment</span>
<span class="c1"># Remove ubi repo which tries to reach external links</span>
RUN<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/yum.repos.d/ubi.repo
<span class="c1"># Add pip.conf for internal pypi proxy</span>
ADD<span class="w"> </span>pip.conf<span class="w"> </span>/etc/pip.conf
<span class="c1"># Add CA certificate and update trust</span>
ADD<span class="w"> </span>demolab-ca.crt<span class="w"> </span>/etc/pki/ca-trust/source/anchors/demolab-ca.crt
RUN<span class="w"> </span>update-ca-trust
<span class="c1">####### This marks the end of edits for the builder stage</span>

RUN<span class="w"> </span>assemble

FROM<span class="w"> </span><span class="nv">$EE_BASE_IMAGE</span>
USER<span class="w"> </span>root
COPY<span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/output/<span class="w"> </span>/output/

<span class="c1">####### Changes to create EE in a disconnected environment</span>
<span class="c1"># Remove ubi repo which tries to reach external links</span>
RUN<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/yum.repos.d/ubi.repo
<span class="c1"># Add pip.conf for internal pypi proxy</span>
ADD<span class="w"> </span>pip.conf<span class="w"> </span>/etc/pip.conf
<span class="c1"># Add CA certificate and update trust</span>
ADD<span class="w"> </span>demolab-ca.crt<span class="w"> </span>/etc/pki/ca-trust/source/anchors/demolab-ca.crt
RUN<span class="w"> </span>update-ca-trust
<span class="c1">####### This marks the end of edits for the main image</span>

RUN<span class="w"> </span>/output/install-from-bindep<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/output/wheels
</pre></div>

<p>If you look closely in the above Containerfile, you can notice the
additions that fix all the issues previously mentioned in both the
BUILDER and the BASE image stages because both images use this
information to pull and build Python dependencies.</p>
<p>Understanding what happens in each stage helps you understand where to
edit your Containerfile, and at which stage, allowing you to make
endless customizations to your custom automation execution environments.</p>
<p>Finally let's build the above execution-environment with the following
command:</p>
<div class="code"><pre class="code literal-block">podman<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>context/Containerfile<span class="w"> </span>-t<span class="w"> </span>disconnected_ee:1.0
</pre></div>

<p>When the build succeeds, you should see a message like this:</p>
<div class="code"><pre class="code literal-block">--&gt;<span class="w"> </span>2316db485a1
Successfully<span class="w"> </span>tagged<span class="w"> </span>localhost/disconnected_ee:1.0
2316db485a1c4e7be4a687c682d0fc90335372d7e5564774f1ff6451840ac35f
</pre></div>

<h3>Looking forward</h3>
<p>Our ultimate goal is to make the developer experience as seamless as
possible for customers. Ansible engineering teams are working on
enhancements to the automation execution environment building
experience, with several improvements already in the planning stage.
Until those enhancements are available, this blog should help you tackle
any challenges around the process of building automation execution
environments. Following the upstream first model means you can also
participate in community discussions and provide your thoughts and
feedback through IRC. Please follow the link
<a href="https://docs.ansible.com/ansible/latest/community/communication.html#ansible-community-on-irc">here</a>
to join us. One of the main enhancements to the automation execution
environment experience is being discussed in this
<a href="https://github.com/ansible/ansible-builder/pull/411">GitHub pull request</a>,
so you can participate in the GitHub discussions as well.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-73/" class="u-url">Bullhorn #73</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-73/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-09T08:15:00Z" itemprop="datePublished" title="2022-09-09 08:15">2022-09-09 08:15</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #73, 2022-09-09 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="the-automation-experience-ansiblefest-2022/" class="u-url">The Automation Experience, AnsibleFest 2022</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/elle-universal/">Elle Universal</a>
              </span>
            </p>
            <p class="dateline">
              <a href="the-automation-experience-ansiblefest-2022/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-07T00:00:00Z" itemprop="datePublished" title="2022-09-07 00:00">2022-09-07 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>The Automation Experience, AnsibleFest 2022</h2>
<p>It is almost time for our favorite event of the year! AnsibleFest is
back as an in-person event, and it's the only place to feel the full
power of automation. <a href="http://ansiblefest.com/">Join us</a> October 18 and 19 in Chicago, and immerse
yourself in the movement that's made Ansible an industry-leading
automation technology.</p>
<p>The AnsibleFest 2022 session catalog and agenda builder are now
available. That means you can see all this year's session content and
build your own custom experience. Let's take a closer look at all that
AnsibleFest 2022 has to offer.</p>
<h3>Breakout Sessions</h3>
<p>This year we will be featuring six content tracks. These tracks
include: Getting Started with Automation, the Ansible Community,
Automation Applied, Ansible Automation Platform, Advanced Ansible, and
Automation Adoption. Sessions across these tracks will cover a range of
focus areas, including network automation, security automation,
automation at the edge, IT leaders, developers, and several more. We
also have a wide range of customer, partner, and Ansible contributor
talks to join. You can see a list of all the sessions being offered in
our <a href="https://events.experiences.redhat.com/widget/redhat/rhaf22/SessionCatalog2022?tab.day=20221018">session catalog</a>.</p>
<h3>Workshops and Labs</h3>
<p>Get hands-on experience at AnsibleFest in our workshops and labs. We
will have a mixture of self-paced and instructor led workshops for our
attendees. Topics range from Ansible 101 and writing your first playbook
to Terraforming with Ansible and Ansible 301. With over 20 labs and
workshops available, there is something for every level of automation
user to explore. See how AnsibleFest can help build your automation
skills by checking out all the hands-on content we will be offering in
the <a href="https://events.experiences.redhat.com/widget/redhat/rhaf22/SessionCatalog2022?tab.day=20221018">session catalog</a>.</p>
<h3>Spotlight Sessions</h3>
<p>In Chicago, we're introducing a new session segment, Spotlight Stage.
These sessions will be 15 minute lightning talks and demos from key
Ansible customers and partners, with an interactive component where the
speakers will answer questions from the audience. The Spotlight Stage
will be attached directly to the Red Hat Ansible Automation Platform
booth in the expo hall for easy access for all
attendees.</p>
<h3>Communities of Practice</h3>
<p>The Communities of Practice are a new set of open forums in the
AnsibleFest Hallway Track for this year's AnsibleFest. These are 30
minute open forums led by Ansible experts in a set of diverse topics.
The audience will drive the discussion on
these topics based on what they want to learn from the experts. We will
be covering topics that include automation community + enthusiasm,
network automation, Ansible Automation Platform, automation at the edge,
security automation, event-driven automation, and cloud
automation. </p>
<h3>Ask the Expert</h3>
<p>As AnsibleFest returns in-person, we're excited to bring back the Ask
the Expert area. Here, you can get one-on-one time with Ansible experts
to ask any burning questions about automation. We will now feature a
larger space with designated areas for each expert's individual
expertise, helping ensure you can find the right person for your
questions. Experts will cover a wide range of topics that include
product components and features, migrations, as well as use
case-specific topics, like edge, network and event-driven
automation.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-72/" class="u-url">Bullhorn #72</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-72/" rel="bookmark">
                <time class="published dt-published" datetime="2022-09-02T15:30:00Z" itemprop="datePublished" title="2022-09-02 15:30">2022-09-02 15:30</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #72, 2022-09-02 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-71/" class="u-url">Bullhorn #71</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-71/" rel="bookmark">
                <time class="published dt-published" datetime="2022-08-26T14:00:00Z" itemprop="datePublished" title="2022-08-26 14:00">2022-08-26 14:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #71, 2022-08-26 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="managing-a-vmware-template-lifecycle-with-ansible/" class="u-url">Managing a VMware Template Lifecycle with Ansible</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/goneri-le-bouder/">Gonéri Le Bouder</a>
              </span>
            </p>
            <p class="dateline">
              <a href="managing-a-vmware-template-lifecycle-with-ansible/" rel="bookmark">
                <time class="published dt-published" datetime="2022-08-22T00:00:00Z" itemprop="datePublished" title="2022-08-22 00:00">2022-08-22 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Managing a VMware Template Lifecycle with Ansible</h2>
<p>When we manage a large number of virtual machines (VMs), we want to
reduce the differences between them and create a standard template. By
using a standard template, it becomes easier to manage and propagate the
same operation on the different nodes. When using VMware vSphere, it is
a common practice to share a standardized VM template and use it to
create new VMs. This template is often called a golden image. Its
creation involves a series of steps that can be automated with Ansible.
In this blog, we will see how one can create and use a new golden image.</p>
<h2>Prepare the golden image</h2>
<p><img alt="screenshot" src="../images/posts/archive/my-golden-image.png"></p>
<p>We use <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/composing_a_customized_rhel_system_image/composer-description_composing-a-customized-rhel-system-image#doc-wrapper">image builder</a>
to prepare a new image. The tool provides a user interface that allows
users to define custom images. In this example, we include the SSH
server and tmux. The result image is a file in the VMDK4 format that is
not totally supported by VMware vSphere 7, so this is the reason why we
use a <code>.vmdk-4</code> suffix.</p>
<p><img alt="create image ui screenshot" src="../images/posts/archive/create-image-screenshot.png"></p>
<p>We upload the image using the <em>uri</em> module. Uploading large files using
this method is rather slow. If you can,  you may want to drop the file
on the datastore directly (e.g: NFS/CIFS). The following example
considers that the datastore is called <em>rw_datastore</em> and the datacenter
name is <em>my_dc</em>. The following excerpt from the playbook shows how we
upload the image.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Upload</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="k">remote</span><span class="w"> </span><span class="n">file</span>
<span class="w">  </span><span class="n">ansible</span><span class="o">.</span><span class="n">builtin</span><span class="o">.</span><span class="n">uri</span><span class="p">:</span>
<span class="w">    </span><span class="n">force_basic_auth</span><span class="p">:</span><span class="w"> </span><span class="bp">true</span>
<span class="w">    </span><span class="n">url</span><span class="p">:</span><span class="w"> </span><span class="s1">'https://vcenter.test/folder/my-vmdk/my-golden-image.vmdk-4?dcPath=my_dc&amp;dsName=rw_datastore'</span>
<span class="w">    </span><span class="n">url_username</span><span class="p">:</span><span class="w"> </span><span class="s1">'{{ lookup("ansible.builtin.env", "VMWARE_USER") }}'</span>
<span class="w">    </span><span class="n">url_password</span><span class="p">:</span><span class="w"> </span><span class="s1">'{{ lookup("ansible.builtin.env", "VMWARE_PASSWORD") }}'</span>
<span class="w">    </span><span class="n">method</span><span class="p">:</span><span class="w"> </span><span class="n">PUT</span>
<span class="w">    </span><span class="n">status_code</span><span class="p">:</span><span class="w"> </span><span class="mi">201</span>
<span class="w">    </span><span class="n">src</span><span class="p">:</span><span class="w"> </span><span class="n">my</span><span class="o">-</span><span class="n">golden</span><span class="o">-</span><span class="n">image</span><span class="o">.</span><span class="n">vmdk</span><span class="o">-</span><span class="mi">4</span>
<span class="w">    </span><span class="n">validate_certs</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span>
<span class="w">    </span><span class="n">follow_redirects</span><span class="p">:</span><span class="w"> </span><span class="n">yes</span>
</pre></div>

<p>Now that we've uploaded our file, we will convert it as an up to date
VMDK file. For this purpose, we use
<a href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.storage.doc/GUID-A5D85C33-A510-4A3E-8FC7-93E6BA0A048F.html">vmkfstools</a>.
The tool is available on the ESXi7 hosts by default. In the task below,
we use delegate_to: esxi1.test to run the command on one of our hosts.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Convert</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="n">VMDK</span><span class="w"> </span><span class="n">format</span>
<span class="w">  </span><span class="n">ansible</span><span class="o">.</span><span class="n">builtin</span><span class="o">.</span><span class="n">command</span><span class="p">:</span><span class="w"> </span><span class="s2">"vmkfstools -i /vmfs/volumes/rw_datastore/my-vmdk/my-golden-image.vmdk-4.vmdk-4   /vmfs/volumes/rw_datastore/my-vmdk/my-golden-image.vmdk -d thin"</span>
<span class="w">  </span><span class="n">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="n">esxi1</span><span class="o">.</span><span class="n">test</span>
<span class="w">  </span><span class="n">vars</span><span class="p">:</span>
<span class="w">      </span><span class="n">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="n">root</span>
<span class="w">      </span><span class="n">ansible_python_interpreter</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">python3</span>
</pre></div>

<h2>Preparing the golden VM</h2>
<p>At this stage, the disk is ready and we can connect it to a VM.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="k">Create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">VM</span>
<span class="w">  </span><span class="n">vmware</span><span class="p">.</span><span class="n">vmware_rest</span><span class="p">.</span><span class="nl">vcenter_vm</span><span class="p">:</span>
<span class="w">    </span><span class="nl">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nl">cluster</span><span class="p">:</span><span class="w"> </span><span class="ss">""</span>
<span class="w">      </span><span class="nl">datastore</span><span class="p">:</span><span class="w"> </span><span class="ss">""</span>
<span class="w">      </span><span class="nl">folder</span><span class="p">:</span><span class="w"> </span><span class="ss">""</span>
<span class="w">      </span><span class="nl">resource_pool</span><span class="p">:</span><span class="w"> </span><span class="ss">""</span>
<span class="w">    </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">my</span><span class="o">-</span><span class="n">golden</span><span class="o">-</span><span class="n">vm</span>
<span class="w">    </span><span class="nl">guest_OS</span><span class="p">:</span><span class="w"> </span><span class="n">RHEL_7_64</span>
<span class="w">    </span><span class="nl">hardware_version</span><span class="p">:</span><span class="w"> </span><span class="n">VMX_11</span>
<span class="w">    </span><span class="nl">memory</span><span class="p">:</span>
<span class="w">      </span><span class="nl">hot_add_enabled</span><span class="p">:</span><span class="w"> </span><span class="k">true</span>
<span class="w">      </span><span class="nl">size_MiB</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span>
<span class="w">    </span><span class="nl">disks</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">SATA</span>
<span class="w">        </span><span class="nl">backing</span><span class="p">:</span>
<span class="w">          </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">VMDK_FILE</span>
<span class="w">          </span><span class="nl">vmdk_file</span><span class="p">:</span><span class="w"> </span><span class="ss">"[rw_datastore] my-vmdk/my-golden-image.vmdk"</span>
<span class="w">    </span><span class="nl">cdroms</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">SATA</span>
<span class="w">        </span><span class="nl">sata</span><span class="p">:</span>
<span class="w">          </span><span class="nl">bus</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">          </span><span class="nl">unit</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">    </span><span class="nl">nics</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">backing</span><span class="p">:</span>
<span class="w">          </span><span class="nl">type</span><span class="p">:</span><span class="w"> </span><span class="n">STANDARD_PORTGROUP</span>
<span class="w">          </span><span class="nl">network</span><span class="p">:</span><span class="w"> </span><span class="ss">""</span>
<span class="w">  </span><span class="nl">register</span><span class="p">:</span><span class="w"> </span><span class="n">my_vm</span>
</pre></div>

<p>There are four different ways to clone a VM with Ansible's
<a href="https://console.redhat.com/ansible/automation-hub/repo/published/vmware/vmware_rest">vmware.vmware_rest</a> collection.
This article explains the difference between them and how to use them
with Ansible.</p>
<h3>Cloning the VM</h3>
<p>When we clone a VM, we create a copy of the original. However, the
original can still evolve and a second clone from the same VM is likely
to be different. There is no guarantee that two clones will be based on
exactly the same image.</p>
<p>The <code>vmware.vmware_rest.vcenter_vm</code> module allows us to prepare either
an instant clone or a regular clone.</p>
<h4>Instant clone</h4>
<p>According to the <a href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-853B1E2B-76CE-4240-A654-3806912820EB">VMware official documentation</a>,
an instant clone is a lightweight copy of a live VM. It shares memory
blocks with the original VM. This is the reason why the original VM must
be running before we can clone it.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Turn</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">power</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">VM</span><span class="w"> </span><span class="n">on</span><span class="p">,</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">it</span><span class="s1">'s are pre-condition for Instant Clone</span>
<span class="w">  </span><span class="n">vmware</span><span class="o">.</span><span class="n">vmware_rest</span><span class="o">.</span><span class="n">vcenter_vm_power</span><span class="p">:</span>
<span class="w">    </span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">start</span>
<span class="w">    </span><span class="n">vm</span><span class="p">:</span><span class="w"> </span><span class="s1">'{{ my_vm.id }}'</span>

<span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Wait</span><span class="w"> </span><span class="n">until</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">VM</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">ready</span>
<span class="w">  </span><span class="n">vmware</span><span class="o">.</span><span class="n">vmware_rest</span><span class="o">.</span><span class="n">vcenter_vm_tools_info</span><span class="p">:</span>
<span class="w">    </span><span class="n">vm</span><span class="p">:</span><span class="w"> </span><span class="s1">'{{ my_vm.id }}'</span>
<span class="w">  </span><span class="n">register</span><span class="p">:</span><span class="w"> </span><span class="n">vm_tools_info</span>
<span class="w">  </span><span class="n">until</span><span class="p">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">vm_tools_info</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">failed</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">vm_tools_info</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">run_state</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"RUNNING"</span>
<span class="w">  </span><span class="n">retries</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span>
<span class="w">  </span><span class="n">delay</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
</pre></div>

<p>Now we've got the VM up and running, we can instant clone it:</p>
<div class="code"><pre class="code literal-block"><span class="x">- name: Create an instant clone of a VM</span>
<span class="x">  vmware.vmware_rest.vcenter_vm:</span>
<span class="x">    placement:</span>
<span class="x">      datastore: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.datastore_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/datastore/local'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">      folder: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.folder_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/vm'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">      resource_pool: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.resource_pool_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/host/my_cluster/Resources'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">    state: instant_clone</span>
<span class="x">    source: "</span><span class="cp">{{</span> <span class="nv">my_vm.id</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">    name: instant_clone_1</span>
</pre></div>

<h4>Regular clone</h4>
<p>We can also <a href="https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-1E185A80-0B97-4B46-A32B-3EF8F309BEED.html">clone an existing VM</a>.
The operation takes more time, up to several hours, if the VM comes with
large disks. The operation creates a full clone of the original VM. This
time, the original VM doesn't need to be running.</p>
<div class="code"><pre class="code literal-block"><span class="x">- name: Create a full clone of a VM</span>
<span class="x">  vmware.vmware_rest.vcenter_vm:</span>
<span class="x">    placement:</span>
<span class="x">      datastore: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.datastore_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/datastore/local'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">      folder: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.folder_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/vm'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">      resource_pool: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'vmware.vmware_rest.resource_pool_moid'</span><span class="o">,</span> <span class="s1">'/my_dc/host/my_cluster/Resources'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">    state: clone</span>
<span class="x">    source: "</span><span class="cp">{{</span> <span class="nv">my_vm.id</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">    name: full_clone_1</span>
</pre></div>

<h3>Build a template</h3>
<p>Unlike clone, a template gives us the guarantee that the VM inherits
from a static VM image. The vmware.vmware_rest collection gives us the
ability to prepare OVF packages, and since the 2.2.0 release, we can
also prepare a template VM.</p>
<h3>Export a VM as an OVF package on a content library</h3>
<p>We can export a VM as an OVF package and upload the package into a
content library. This is handy if you want to prepare a standard
template that you will reuse on your vSphere infrastructure. Also, an
OVF package can be downloaded from one vSphere and be reuploaded in a
different one.</p>
<p>In this example, we use Ansible to prepare the OVF package. In this
example, <em>my_vm</em> is not running and the content library is called
<em>my_library_on_nfs</em>.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">List</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">Local</span><span class="w"> </span><span class="nx">Content</span><span class="w"> </span><span class="nx">Library</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">content_locallibrary_info</span><span class="p">:</span>
<span class="w">  </span><span class="nx">register</span><span class="p">:</span><span class="w"> </span><span class="nx">all_content_libraries</span>

<span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">identify</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">right</span><span class="w"> </span><span class="nx">Content</span><span class="w"> </span><span class="nx">Library</span>
<span class="w">  </span><span class="nx">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nx">nfs_lib</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ all_content_libraries.value | selectattr('name', 'equalto', 'my_library_on_nfs')|first }}"</span>

<span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Export</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">VM</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">OVF</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="kn">library</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">vcenter_ovf_libraryitem</span><span class="p">:</span>
<span class="w">    </span><span class="nx">session_timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">2900</span>
<span class="w">    </span><span class="nx">source</span><span class="p">:</span>
<span class="w">      </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">VirtualMachine</span>
<span class="w">      </span><span class="nx">id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ my_vm.id }}"</span>
<span class="w">    </span><span class="nx">target</span><span class="p">:</span>
<span class="w">      </span><span class="nx">library_id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ nfs_lib.id }}"</span>
<span class="w">    </span><span class="nx">create_spec</span><span class="p">:</span>
<span class="w">      </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">golden_image</span>
<span class="w">      </span><span class="nx">description</span><span class="p">:</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">OVF</span><span class="w"> </span><span class="nx">example</span>
<span class="w">      </span><span class="nx">flags</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="w">    </span><span class="nx">state</span><span class="p">:</span><span class="w"> </span><span class="nx">present</span>
</pre></div>

<p><img alt="vsphere client screenshot" src="../images/posts/archive/vsphere-client-screenshot.png"></p>
<p>To spawn a new VM based on this OVF package, you need first to identify
its item entry on the content library.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">NFS</span><span class="w"> </span><span class="kn">library</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">content_library_item_info</span><span class="p">:</span>
<span class="w">    </span><span class="nx">library_id</span><span class="p">:</span><span class="w"> </span><span class="err">'</span><span class="p">{{</span><span class="w"> </span><span class="nx">nfs_lib</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="p">}}</span><span class="err">'</span>
<span class="w">    </span><span class="nx">register</span><span class="p">:</span><span class="w"> </span><span class="nx">lib_items</span>
<span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Define</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">fact</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">golden</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">ID</span>
<span class="w">  </span><span class="nx">ansible</span><span class="p">.</span><span class="nx">builtin</span><span class="p">.</span><span class="nx">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nx">golden_image_id</span><span class="p">:</span><span class="w"> </span><span class="err">'</span><span class="p">{{</span><span class="w"> </span><span class="p">(</span><span class="nx">lib_items</span><span class="p">.</span><span class="nx">value</span><span class="o">|</span><span class="nx">selectattr</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span><span class="w"> </span><span class="s">"equalto"</span><span class="p">,</span><span class="w"> </span><span class="s">"golden_image"</span><span class="p">)</span><span class="o">|</span><span class="nx">first</span><span class="p">).</span><span class="nx">id</span><span class="w"> </span><span class="p">}}</span><span class="err">'</span>
</pre></div>

<p>Once we've got the item ID, we can call <code>vcenter_ovf_libraryitem</code> to
spawn a new VM. Since the ID is immutable, we can save for a future use.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">VM</span><span class="w"> </span><span class="nx">based</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">OVF</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">vcenter_ovf_libraryitem</span><span class="p">:</span>
<span class="w">    </span><span class="nx">ovf_library_item_id</span><span class="p">:</span><span class="w"> </span><span class="err">'</span><span class="p">{{</span><span class="w"> </span><span class="nx">golden_image_id</span><span class="w"> </span><span class="p">}}</span><span class="err">'</span>
<span class="w">    </span><span class="nx">state</span><span class="p">:</span><span class="w"> </span><span class="nx">deploy</span>
<span class="w">    </span><span class="nx">target</span><span class="p">:</span><span class="w"> </span><span class="nx">resource_pool_id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"</span>
<span class="w">    </span><span class="nx">deployment_spec</span><span class="p">:</span>
<span class="w">      </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">my_vm_from_ovf</span>
<span class="w">      </span><span class="nx">accept_all_EULA</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="nx">storage_provisioning</span><span class="p">:</span><span class="w"> </span><span class="nx">thin</span>
</pre></div>

<h4>Export a VM as a VM template on a content library</h4>
<p>The template creation is done with one call of the
<code>vmware.vmware_rest.vcenter_vmtemplate_libraryitems</code> module. This module
was introduced in the vmware_rest collection 2.2.0.</p>
<p>Here, <code>nfs_lib</code> is your content library and your VM details are
registered in the <code>my_vm</code> variable.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">VM</span><span class="w"> </span><span class="nx">template</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="kn">library</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">vcenter_vmtemplate_libraryitems</span><span class="p">:</span>
<span class="w">    </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">golden</span><span class="o">-</span><span class="nx">template</span>
<span class="w">    </span><span class="kn">library</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ nfs_lib.id }}"</span>
<span class="w">    </span><span class="nx">source_vm</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ my_vm.id }}"</span>
<span class="w">    </span><span class="nx">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nx">cluster</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.cluster_moid', '/my_dc/host/my_cluster') }}"</span>
<span class="w">      </span><span class="nx">folder</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/vm') }}"</span>
<span class="w">      </span><span class="nx">resource_pool</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"</span>
</pre></div>

<p><img alt="vsphere client screenshot" src="../images/posts/archive/vsphere-client-screenshot-one.png"></p>
<p>To spawn a new VM based on this template, we once again need to identify
the item on the content library.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">items</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">NFS</span><span class="w"> </span><span class="kn">library</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">content_library_item_info</span><span class="p">:</span>
<span class="w">    </span><span class="nx">library_id</span><span class="p">:</span><span class="w"> </span><span class="err">'</span><span class="p">{{</span><span class="w"> </span><span class="nx">nfs_lib</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="p">}}</span><span class="err">'</span>
<span class="w">  </span><span class="nx">register</span><span class="p">:</span><span class="w"> </span><span class="nx">lib_items</span>

<span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">identify</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">item</span>
<span class="w">  </span><span class="nx">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nx">my_template_item</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lib_items.value | selectattr('name', 'equalto', 'golden-template')|first }}"</span>
</pre></div>

<p>We use the same module for the deployment:</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">Deploy</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="nx">VM</span><span class="w"> </span><span class="nx">based</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">template</span>
<span class="w">  </span><span class="nx">vmware</span><span class="p">.</span><span class="nx">vmware_rest</span><span class="p">.</span><span class="nx">vcenter_vmtemplate_libraryitems</span><span class="p">:</span>
<span class="w">    </span><span class="nx">name</span><span class="p">:</span><span class="w"> </span><span class="nx">vm</span><span class="o">-</span><span class="nx">from</span><span class="o">-</span><span class="nx">template</span>
<span class="w">    </span><span class="kn">library</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ nfs_lib.id }}"</span>
<span class="w">    </span><span class="nx">template_library_item</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ my_template_item.id }}"</span>
<span class="w">    </span><span class="nx">placement</span><span class="p">:</span>
<span class="w">      </span><span class="nx">cluster</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.cluster_moid', '/my_dc/host/my_cluster') }}"</span>
<span class="w">      </span><span class="nx">folder</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.folder_moid', '/my_dc/vm') }}"</span>
<span class="w">      </span><span class="nx">resource_pool</span><span class="p">:</span><span class="w"> </span><span class="s">"{{ lookup('vmware.vmware_rest.resource_pool_moid', '/my_dc/host/my_cluster/Resources') }}"</span>
<span class="w">    </span><span class="nx">state</span><span class="p">:</span><span class="w"> </span><span class="nx">deploy</span>
</pre></div>

<p>In conclusion, in just a couple of Ansible tasks, we can promote an
existing VM as a Template. This allows us to rely on Ansible to automate
the maintenance of our VM Templates and ensure the reproducibility of
the process.</p>
          </div>
      </article><br><hr>
<br>
</div>
          <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-19.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-17.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/popper.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
