<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="In October 2019 as part of the Red Hat Ansible Engine 2.9 release, the Ansible Network Automation team introduced the first resource modules. These opinionated network modules make network automation easier and more consistent for those automating various network platforms in production.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Deep Dive, ACL Configuration Management Using Ansible Network Automation Resource Modules | Ansible Collaborative</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../../assets/css/main.css">
<link rel="stylesheet" href="../../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/deep-dive-acl-configuration-management-using-ansible-network-automation-resource-modules/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Sumit Jaiswal">
<link rel="prev" href="../getting-started-with-aws-ansible-module-development/" title="Getting Started With AWS Ansible Module Development and Community Contribution" type="text/html">
<link rel="next" href="../best-of-fest-ansiblefest-2020/" title="Best of AnsibleFest 2020" type="text/html">
<meta property="og:site_name" content="Ansible Collaborative">
<meta property="og:title" content="Deep Dive, ACL Configuration Management Using Ansible Network Automati">
<meta property="og:url" content="https://ansible.com/blog/deep-dive-acl-configuration-management-using-ansible-network-automation-resource-modules/">
<meta property="og:description" content="In October 2019 as part of the Red Hat Ansible Engine 2.9 release, the Ansible Network Automation team introduced the first resource modules. These opinionated network modules make network automation ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-10-12T00:00:00Z">
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../../">
        <img src="../../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="../archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
  <article class="post-text h-entry hentry postpage ansible-content" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Deep Dive, ACL Configuration Management Using Ansible Network Automation Resource Modules</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/sumit-jaiswal/">Sumit Jaiswal</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-10-12T00:00:00Z" itemprop="datePublished" title="2020-10-12 00:00">2020-10-12 00:00</time></a>
            </p>
                    <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
<h2>Deep Dive, ACL Configuration Management Using Ansible Network Automation Resource Modules</h2>
<p>In October 2019 as part of the Red Hat Ansible Engine 2.9 release, the
Ansible Network Automation team introduced the first resource modules.</p>
<p>These opinionated network modules make
network automation easier and more consistent for those automating
various network platforms in production. The goal for resource modules
is to avoid creating and maintaining overly complex jinja2 templates for
rendering and pushing network configuration.</p>
<p>This blog post covers the newly released <code>ios_acls</code>
resource module and how to automate manual processes associated with
switch and router configurations. These network automation modules are
used for configuring routers and switches from popular vendors (but not
limited to) Arista, Cisco, Juniper, and VyOS. The access control lists
(ACLs) network resource modules are able to read ACL configuration from
the network, provide the ability to modify and then push changes to the
network device. These opinionated network resource modules make network
automation easier and more consistent for those automating various
network platforms in production. I'll walk through several examples and
describe the use cases for each state parameter (including three newly
released state types) and how these are used in real world
scenarios.</p>
<h3>The Certified Content Collection</h3>
<p>This blog uses the <code>cisco.ios</code> Collection maintained by the Ansible team, but there are other platforms
that also have ACL resource modules, such as <code>arista.eos</code>, <code>junipernetworks.junos</code>, and <code>vyos.vyos</code>.</p>
<h4>How to obtain the certified (supported) and upstream (community) Collection</h4>
<p>The upstream community Collection can be found on Ansible Galaxy: <a href="https://galaxy.ansible.com/cisco/ios">https://galaxy.ansible.com/cisco/ios**</a></p>
<p>The downstream supported Collection can be found on Automation Hub: <a href="https://cloud.redhat.com/ansible/automation-hub/cisco/ios">https://cloud.redhat.com/ansible/automation-hub/cisco/ios**</a></p>
<p>For more information on Ansible Content Collections, please refer to the following documentation:</p>
<p>https://docs.ansible.com/ansible/latest/user_guide/collections_using.html</p>
<p>Before starting, let's quickly explain the rationale behind the naming
of the network resource modules. The newly added ACLs modules will be
plural <code>eos_acls</code>, <code>ios_acls</code>, <code>junos_acls</code>, <code>nxos_acls</code>, <code>iosxr_acls</code>. 
The older singular form modules (e.g. <code>ios_acl</code>, <code>nxos_acl</code>) will be
deprecated over time. This naming change was done so that those using
existing network modules would not have their Ansible Playbooks stop
working and have sufficient time to migrate to the new network
automation modules.</p>
<h3>Platform support</h3>
<p>This module is also available for the following Ansible-maintained
platforms on both Automation Hub (supported) and Galaxy (community):</p>
<table>
<thead><tr>
<th>Platform</th>
<th>Full Collection path</th>
<th>Automation Hub Link (requires subscription)</th>
<th>Ansible Galaxy Link</th>
</tr></thead>
<tbody>
<tr>
<td><code>Arista EOS</code></td>
<td><code>arista.eos.eos_acls</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/arista/eos">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/arista/eos">Galaxy</a></td>
</tr>
<tr>
<td><code>Cisco IOS</code></td>
<td><code>cisco.ios.ios_acls</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/cisco/ios">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/cisco/ios">Galaxy</a></td>
</tr>
<tr>
<td><code>Cisco IOS-XR</code></td>
<td><code>cisco.iosxr.iosxr_acls</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/cisco/iosxr">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/cisco/iosxr">Galaxy</a></td>
</tr>
<tr>
<td><code>Cisco NX-OS</code></td>
<td><code>cisco.nxos.nxos_acls</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/cisco/nxos">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/cisco/nxos">Galaxy</a></td>
</tr>
<tr>
<td><code>Juniper Junos</code></td>
<td><code>junipernetworks.junos.junos_acls</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/juniper/networks/junos">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/juniper/networks/junos">Galaxy</a></td>
</tr>
<tr>
<td><code>VyOS</code></td>
<td><code>vyos.vyos.vyos_firewall_rules</code></td>
<td><a href="https://cloud.redhat.com/ansible/automation-hub/vyos/vyos">Automation Hub</a></td>
<td><a href="https://galaxy.ansible.com/vyos/vyos">Galaxy</a></td>
</tr>
</tbody>
</table>
<h3>Getting started - Managing the ACL configuration with Ansible</h3>
<p>An access control list (ACL) provides rules
that are applied to port numbers and/or IP addresses  permitted to
transit or reach that network device. ACL order of access control entry
(ACE) is critical because the ACEs sequence/order route decides which
rules are applied to inbound/outbound network traffic.</p>
<p>An ACL resource module provides the same level of functionality that a
user can achieve when configuring manually on the Cisco IOS device. But
combined with Ansible facts gathering and resource module approach, this
is more closely aligned with how network professionals work day to day.</p>
<p>I'll be using an IOS router with version 15.6(3)M2 for all the
configuration of this post. Below is the initial state of router ACLs
configuration and currently there are already active ACLs configured on
the device.</p>
<h4>Network device configuration</h4>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">  </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">  </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>test_acl
<span class="w">  </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">  </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<h3>Using state gathered - Building an Ansible inventory</h3>
<p>Resource modules allow the user to read in an existing network
configuration and convert that into a structured data model. The
<strong>state: gathered</strong> is the equivalent for gathering Ansible facts for
this specific resource. This example will read in the existing network
configuration and store it as a flat file.</p>
<h4>Ansible Playbook Example</h4>
<p>Here is an Ansible Playbook example of using <strong>state: gathered</strong> and
storing the result as YAML into host_vars.  If you are new to the
concept of Ansible inventory and want to learn more about
<code>group_vars</code> and <code>host_vars</code>, please refer
to the <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">Ansible User Guide: Inventory.</a></p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">convert configured ACLs to structured data</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>


<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use the ACLs resource module to gather the current config</span>
<span class="w">       </span><span class="l l-Scalar l-Scalar-Plain">cisco.ios.ios_acls</span><span class="p p-Indicator">:</span>
<span class="w">           </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gathered</span>
<span class="w">           </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">acls</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create inventory directory</span>
<span class="w">      </span><span class="nt">file</span><span class="p">:</span>
<span class="w">       </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">inventory_dir</span><span class="nv"> </span><span class="s">}}/host_vars/{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">       </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Write the ACL configuration to a file</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">{‘acls’:</span><span class="nv"> </span><span class="s">acls['gathered']}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">to_nice_yaml</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">inventory_dir</span><span class="nv"> </span><span class="s">}}/host_vars/{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}/acls.yaml"</span>
</pre></div>

<p>Execute the Ansible Playbook with the ansible-playbook command: <code>ansible-playbook example.yml</code></p>
<h4>Examine File contents</h4>
<p>Here is the data structure that was created from reading in an existing
configuration:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># lab_inventory/host_vars/rtr2/acls.yaml</span>
<span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">             </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">             </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">           </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">           </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">icmp</span>
<span class="w">           </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">             </span><span class="nt">icmp</span><span class="p">:</span>
<span class="w">               </span><span class="nt">traceroute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">           </span><span class="nt">source</span><span class="p">:</span>
<span class="w">             </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">             </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">             </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">             </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">               </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">           </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">           </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">           </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">             </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">               </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">           </span><span class="nt">source</span><span class="p">:</span>
<span class="w">             </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">       </span><span class="nt">acl_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extended</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">'110'</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">             </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">             </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">                 </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">             </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">           </span><span class="nt">option</span><span class="p">:</span>
<span class="w">               </span><span class="nt">traceroute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">           </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">               </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">                   </span><span class="nt">fin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">           </span><span class="nt">source</span><span class="p">:</span>
<span class="w">             </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">             </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">               </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">       </span><span class="nt">acl_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extended</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_acl</span>
<span class="w">  </span><span class="w w-Error"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w w-Error"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">         </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">             </span><span class="nt">any</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">             </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">               </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">           </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">af11</span>
<span class="w">           </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">           </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tcp</span>
<span class="w">           </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">             </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">               </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">           </span><span class="nt">source</span><span class="p">:</span>
<span class="w">             </span><span class="nt">any</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">             </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">               </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">       </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R1_TRAFFIC</span>
<span class="w">   </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv6</span>
</pre></div>

<p>In the above output (and future reference):</p>
<ul>
<li>
<code>afi</code> refers to address family identifier, either IPv4 or IPv6</li>
<li>
<code>acls</code> refers to access control lists, and returns a list of dictionaries (ACEs)</li>
<li>
<code>aces</code> refers to access control entry, or the specific rule and sequence</li>
</ul>
<h3>Using state merged - Pushing configuration changes</h3>
<p>The state merged will take your Ansible configuration data (for example
Ansible variables) and merges them into the network device's network
configuration. This will not affect existing configuration not specified
in your Ansible configuration data. Let's walk through an example.</p>
<h4>Modify stored file</h4>
<p>We will modify the flat file created in the first example. We will then
create an Ansible Playbook to merge this new configuration into the
network device's running configuration.</p>
<p>Reference link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/056d2a6a44910863cbbbf38cad2273435574db84/Merged.txt</p>
<div class="code"><pre class="code literal-block"><span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">std_acl</span>
<span class="w">     </span><span class="nt">acl_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">standard</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.200</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.2.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">110</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">icmp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">traceroute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">     </span><span class="nt">acl_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extended</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">fin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">option</span><span class="p">:</span>
<span class="w">           </span><span class="nt">traceroute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.101.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">tos</span><span class="p">:</span>
<span class="w">           </span><span class="nt">service_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span>
<span class="w">     </span><span class="w w-Error"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="l l-Scalar l-Scalar-Plain">protocol_options</span><span class="p p-Indicator">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="w w-Error"> </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.4.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">lt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv6</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R1_TRAFFIC</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">any</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">any</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">af11</span>
</pre></div>

<p>Ansible Playbook Example:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Merged state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Merge ACLs config with device existing ACLs config</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merged</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">acls</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Once we run the respective Merge play, all of the provided parameters
will be configured on the Cisco IOS router with Ansible <strong>changed=True</strong></p>
<p>Network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>If we dig slightly into the device output, we make the following
observations:</p>
<ul>
<li>Based on the AFI value, it's decided by the module to call IP/IPV6
    access-lists. </li>
<li>The 'acl_type' key is required for named ACLs.</li>
<li>For ACLs identified by a number rather than a name, the 'acl_type'
    is derived from the platform's documented ACL number ranges. (eg
    Standard = 1--99 and 1300--1999, Extended = 100--199 and 2000--2699,
    etc)</li>
<li>If the sequence number is not mentioned in the ACE, it will be
    configured based on the order provided in the play. </li>
<li>With the second run, the respective Merge Play runs again and
    Ansible charm of Idempotency comes to picture, and if nothing's
    changed, play run results into changed=False, which confirms to the
    user that all of the provided configurations in the play are already
    configured on the IOS device.</li>
</ul>
<h3>Using state replaced - Pushing configuration changes</h3>
<p>The replaced parameter enforces the data model on the network device
for each configured ACL/ACE. If we modify any of the ACL/ACEs, it will
enforce all the parameters this resource module is aware of. To think of
this another way, the replaced parameter is aware of all the commands
that should and shouldn't be there.</p>
<p>For this scenario, an ACL with some ACEs is already configured on the
Cisco IOS device, and now the user wants to update the ACL with a new
set of ACEs and discard all the already configured ACL ACEs. The
resource module that replaced "s" will replace ACL existing ACEs with a
new set of ACEs given as input by the user.</p>
<p>Ref gist link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/056d2a6a44910863cbbbf38cad2273435574db84/Replaced.txt</p>
<div class="code"><pre class="code literal-block"><span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">110</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">syn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">syn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>

<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Replaced state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Replace ACLs config with device existing ACLs config</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replaced</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">acls</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>With the above play, the user is replacing the 123 extended ACL with
the provided ACL ACEs configuration and also configuring the 150
extended new ACL ACEs.</p>
<p>Before running the <code>replaced</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>With replaced Play run, commands that are fired:</p>
<div class="code"><pre class="code literal-block">-<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span>no<span class="w"> </span><span class="m">10</span>
-<span class="w"> </span>no<span class="w"> </span><span class="m">20</span>
-<span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>syn<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
-<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">150</span>
-<span class="w"> </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>syn<span class="w">  </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>After running the replaced play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>syn<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">150</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>syn<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>If we dig the output briefly, we may have following observation:</p>
<ul>
<li>
<code>replaced</code> will negate
    all the pre-existing ACEs under the input ACL and then apply the
    configuration provided as input in the play. The same behaviour can
    be seen in the commands output above for numbered ACL 123, where the
    pre-existing ACEs at sequence 10 and 20 are negated first before
    applying the changes for newer ACE configuration.</li>
<li>For the 150 extended ACL ACEs, since it wasn't already
    pre-configured on the device, the module goes ahead and applies the
    ACE configuration provided as input in the play. One thing to note
    here is that in the play input configuration value to sequence is
    mentioned as 20, and as a result ACE is configured on sequence 20
    instead of 10, which would have been the case if value to sequence
    wasn't provided by the user.</li>
</ul>
<p>With the second run of the above play, changed comes as false, which
satisfies the Ansible idempotency.</p>
<h3>Using state overridden - Pushing configuration changes</h3>
<p>For this example, we will mix it up slightly. Pretend you are a user
making a bespoke configuration on the network device (making a change
outside of automation).  The <code>state: overridden</code> will circle
back on enforcing the data model (configuration policy enforcement) and
remove the bespoke change.</p>
<p>If the user wants to re-configure the Cisco IOS device entirely
pre-configured ACLs, then resource module overridden state is the most
appropriate. When using the overridden state, a user can override all
ACLs with user provided ACLs.</p>
<p>To show the difference between replaced and overridden state working, we
will be using the same play that we used for the replaced scenario,
keeping the pre-existing configuration the same as well.</p>
<p>Ref gist link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/056d2a6a44910863cbbbf38cad2273435574db84/Overridden.txt</p>
<p>ACLs configuration:</p>
<div class="code"><pre class="code literal-block"><span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">110</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">ack</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">syn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>

<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Overridden state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Override ACLs config with device existing ACLs config</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overridden</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">acls</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>With the above play, the user is replacing the 123 extended ACL with
the provided ACL ACEs configuration and also configuring the 150
extended new ACL ACEs.</p>
<p>Before running the <code>Overridden</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>With <code>Overridden</code> play run, commands that are sent:</p>
<div class="code"><pre class="code literal-block">-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>standard<span class="w"> </span>std_acl
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">123</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">150</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
-<span class="w"> </span>no<span class="w"> </span>ipv6<span class="w"> </span>access-list<span class="w"> </span>R1_TRAFFIC
-<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">150</span>
-<span class="w"> </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>syn<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
-<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>After running the <code>Overridden</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">150</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>syn<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>Now, again if we dig the overridden play output:</p>
<ul>
<li>Overridden negates all of the pre-existing ACLs and deletes those
    configurations, which are not present inside the provided config.</li>
<li>For the ACL configurations that are pre-existing and also in the
    play, ios_acls overridden state will try to delete/negate all the
    pre-existing ACEs and then configure the new ACE as mentioned in the
    play</li>
<li>For any non-existing ACLs, overridden state will configure the ACL
    in a manner same as merged</li>
</ul>
<p>Now that we talked about how we can configure ACLs and the ACEs on the
CISCO IOS device by using ios_acls resource module merged, replaced and
overridden state, it's time we talk about how we can delete the
pre-configured ACLs and ACEs and what level of granularity is available
with the deleted operational state for the user.</p>
<h3>Deleting configuration changes</h3>
<p>If the user wants to delete the Cisco IOS device pre-configured ACLs
with the provided ACL configuration, then use the resource module delete
state.</p>
<p>Method 1: Delete individual ACLs <strong>based on ACL number</strong> (which means if the user needs to delete any specific ACLs configured under IPV4 or IPV6)</p>
<p>Ref gist link: </p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/056d2a6a44910863cbbbf38cad2273435574db84/Deleted.txt</p>
<p>ACLs that need to be deleted</p>
<div class="code"><pre class="code literal-block"><span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">      </span><span class="nt">acl_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extended</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">110</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">123</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv6</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R1_TRAFFIC</span>
</pre></div>

<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deleted state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete ACLs based on ACL number</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deleted</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">acls</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Before running the <code>Deleted</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>With <code>Delete by ACLs</code> play run, commands that are sent:</p>
<div class="code"><pre class="code literal-block">-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">123</span>
-<span class="w"> </span>no<span class="w"> </span>ipv6<span class="w"> </span>access-list<span class="w"> </span>R1_TRAFFIC
</pre></div>

<p>After running the <code>Deleted</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
cisco#
</pre></div>

<p>Method 2: Deleting individual ACLs <strong>based on it's AFI (i.e. Address Family Indicator)</strong> which means if the user needs to delete all of the ACLs configured under IPV4 or IPV6</p>
<p>Ref gist link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/8c65946eae561ff569cfc5398879c51598ae050c/Deleted_by_AFI</p>
<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deleted state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete ALL IPV4 configured ACLs</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deleted</span>
</pre></div>

<p>Before running the Deleted play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>With Delete by ACLs Play run, commands that are fired:</p>
<div class="code"><pre class="code literal-block">-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>standard<span class="w"> </span>std_acl
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">123</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
</pre></div>

<p>After running the <code>Deleted</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
cisco#
</pre></div>

<p>Method 3: Delete ALL ACLs at once</p>
<blockquote>
<p>Note: this is a very critical delete operation and if not used judiciously, it has the power of deleting all pre-configured ACLs</p>
</blockquote>
<p>Ref gist link:
https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/056d2a6a44910863cbbbf38cad2273435574db84/Deleted_wo_config.txt</p>
<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deleted state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete ALL configured ACLs w/o passing any config</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deleted</span>
</pre></div>

<p>Before running the Deleted play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
Standard<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>std_acl
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.1.200
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w">   </span><span class="m">192</span>.168.2.0,<span class="w"> </span>wildcard<span class="w"> </span>bits<span class="w"> </span><span class="m">0</span>.0.0.255
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">110</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>icmp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>traceroute<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span>host<span class="w"> </span><span class="m">198</span>.51.110.0<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="m">123</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">198</span>.51.100.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">198</span>.51.101.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>tos<span class="w"> </span><span class="m">12</span>
<span class="w">   </span><span class="m">20</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.4.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>ef<span class="w"> </span>ttl<span class="w"> </span>lt<span class="w"> </span><span class="m">20</span>
Extended<span class="w"> </span>IP<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span><span class="nb">test</span>
<span class="w">   </span><span class="m">10</span><span class="w"> </span>deny<span class="w"> </span>tcp<span class="w"> </span><span class="m">192</span>.0.2.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span><span class="m">192</span>.0.3.0<span class="w"> </span><span class="m">0</span>.0.0.255<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>fin<span class="w"> </span>option<span class="w"> </span>traceroute<span class="w"> </span>ttl<span class="w"> </span>eq<span class="w"> </span><span class="m">10</span>
IPv6<span class="w"> </span>access<span class="w"> </span>list<span class="w"> </span>R1_TRAFFIC
<span class="w">   </span>deny<span class="w"> </span>tcp<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>www<span class="w"> </span>any<span class="w"> </span>eq<span class="w"> </span>telnet<span class="w"> </span>ack<span class="w"> </span>dscp<span class="w"> </span>af11<span class="w"> </span>sequence<span class="w"> </span><span class="m">10</span>
</pre></div>

<p>With Delete by ACLs Play run, commands that are fired:</p>
<div class="code"><pre class="code literal-block">-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>standard<span class="w"> </span>std_acl
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">110</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="m">123</span>
-<span class="w"> </span>no<span class="w"> </span>ip<span class="w"> </span>access-list<span class="w"> </span>extended<span class="w"> </span><span class="nb">test</span>
-<span class="w"> </span>no<span class="w"> </span>ipv6<span class="w"> </span>access-list<span class="w"> </span>R1_TRAFFIC
</pre></div>

<p>After running the <code>Overridden</code> play network device configuration:</p>
<div class="code"><pre class="code literal-block">cisco#sh<span class="w"> </span>access-lists
cisco#
</pre></div>

<h3>Using state rendered - Development and working offline</h3>
<p>The state rendered transforms the provided structured data model into
platform specific CLI commands. This state does not require a connection
to the end device. For this example, it will render the provided data
model into the Cisco IOS syntax commands.</p>
<p>Ref gist link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/8c65946eae561ff569cfc5398879c51598ae050c/Rendered.txt</p>
<p>ACLs Config that needs to be rendered</p>
<div class="code"><pre class="code literal-block"><span class="nt">acls</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">  </span><span class="nt">acls</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">110</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">sequence</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">syn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.2.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.0.3.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">150</span>
<span class="w">     </span><span class="nt">aces</span><span class="p">:</span>
<span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">grant</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deny</span>
<span class="w">         </span><span class="nt">protocol_options</span><span class="p">:</span>
<span class="w">           </span><span class="nt">tcp</span><span class="p">:</span>
<span class="w">             </span><span class="nt">syn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">         </span><span class="nt">source</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.100.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">destination</span><span class="p">:</span>
<span class="w">           </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">198.51.110.0</span>
<span class="w">           </span><span class="nt">wildcard_bits</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.255</span>
<span class="w">           </span><span class="nt">port_protocol</span><span class="p">:</span>
<span class="w">             </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telnet</span>
<span class="w">         </span><span class="nt">dscp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ef</span>
<span class="w">         </span><span class="nt">ttl</span><span class="p">:</span>
<span class="w">           </span><span class="nt">eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</pre></div>

<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rendered state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Render the provided configuration</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">acls</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rendered</span>
</pre></div>

<p>With Render state module execution results:</p>
<div class="code"><pre class="code literal-block"><span class="s">"rendered"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">   </span><span class="s">"ip</span><span class="nv"> </span><span class="s">access-list</span><span class="nv"> </span><span class="s">extended</span><span class="nv"> </span><span class="s">110"</span><span class="p p-Indicator">,</span>
<span class="w">   </span><span class="s">"10</span><span class="nv"> </span><span class="s">deny</span><span class="nv"> </span><span class="s">tcp</span><span class="nv"> </span><span class="s">192.0.2.0</span><span class="nv"> </span><span class="s">0.0.0.255</span><span class="nv"> </span><span class="s">192.0.3.0</span><span class="nv"> </span><span class="s">0.0.0.255</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">www</span><span class="nv"> </span><span class="s">syn</span><span class="nv"> </span><span class="s">dscp</span><span class="nv"> </span><span class="s">ef</span><span class="nv"> </span><span class="s">ttl</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">10"</span><span class="p p-Indicator">,</span>
<span class="w">   </span><span class="s">"ip</span><span class="nv"> </span><span class="s">access-list</span><span class="nv"> </span><span class="s">extended</span><span class="nv"> </span><span class="s">150"</span><span class="p p-Indicator">,</span>
<span class="w">   </span><span class="s">"deny</span><span class="nv"> </span><span class="s">tcp</span><span class="nv"> </span><span class="s">198.51.100.0</span><span class="nv"> </span><span class="s">0.0.0.255</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">telnet</span><span class="nv"> </span><span class="s">198.51.110.0</span><span class="nv"> </span><span class="s">0.0.0.255</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">telnet</span><span class="nv"> </span><span class="s">syn</span><span class="nv"> </span><span class="s">dscp</span><span class="nv"> </span><span class="s">ef</span><span class="nv"> </span><span class="s">ttl</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">10"</span>
<span class="p p-Indicator">]</span>
</pre></div>

<p>NOTE: Render state won't change anything from configuration end</p>
<h3>Using state parsed - Development and working offline</h3>
<p>This state reads the configuration from running_config option and
transforms it into structured data (i.e. JSON). This is helpful if you
have off-line configurations, such as a backup text file, and want to
transform it into structured data. This is helpful for experimenting,
troubleshooting or offline creation of a source of truth for your data
models.</p>
<p>Ref gist link:</p>
<p>https://gist.githubusercontent.com/justjais/bb2a65c373ab4e64d1eeb47bc425c613/raw/8c65946eae561ff569cfc5398879c51598ae050c/Parsed.txt</p>
<p>ACLs Config that needs to be Parsed</p>
<p>Ansible Playbook Example</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parsed state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parse the provided ACLs configuration</span>
<span class="w">      </span><span class="nt">cisco.ios.ios_acls</span><span class="p">:</span>
<span class="w">        </span><span class="nt">running_config</span><span class="p">:</span>
<span class="w">           </span><span class="s">"ipv6</span><span class="nv"> </span><span class="s">access-list</span><span class="nv"> </span><span class="s">R1_TRAFFIC</span>
<span class="w">           </span><span class="s">deny</span><span class="nv"> </span><span class="s">tcp</span><span class="nv"> </span><span class="s">any</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">www</span><span class="nv"> </span><span class="s">any</span><span class="nv"> </span><span class="s">eq</span><span class="nv"> </span><span class="s">telnet</span><span class="nv"> </span><span class="s">ack</span><span class="nv"> </span><span class="s">dscp</span><span class="nv"> </span><span class="s">af11"</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">parsed</span>
</pre></div>

<p>With Parsed state module execution results:</p>
<div class="code"><pre class="code literal-block"><span class="s">"parsed"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">       </span><span class="p p-Indicator">{</span>
<span class="w">           </span><span class="s">"acls"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">               </span><span class="p p-Indicator">{</span>
<span class="w">                   </span><span class="s">"aces"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">                       </span><span class="p p-Indicator">{</span>
<span class="w">                           </span><span class="s">"destination"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                               </span><span class="s">"any"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">                               </span><span class="s">"port_protocol"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                                   </span><span class="s">"eq"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"telnet"</span>
<span class="w">                               </span><span class="p p-Indicator">}</span>
<span class="w">                           </span><span class="p p-Indicator">},</span>
<span class="w">                           </span><span class="s">"dscp"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"af11"</span><span class="p p-Indicator">,</span>
<span class="w">                           </span><span class="s">"grant"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"deny"</span><span class="p p-Indicator">,</span>
<span class="w">                           </span><span class="s">"protocol_options"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                               </span><span class="s">"tcp"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                                   </span><span class="s">"ack"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span>
<span class="w">                               </span><span class="p p-Indicator">}</span>
<span class="w">                           </span><span class="p p-Indicator">},</span>
<span class="w">                           </span><span class="s">"source"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                               </span><span class="s">"any"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span><span class="p p-Indicator">,</span>
<span class="w">                               </span><span class="s">"port_protocol"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                                   </span><span class="s">"eq"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"www"</span>
<span class="w">                               </span><span class="p p-Indicator">}</span>
<span class="w">                           </span><span class="p p-Indicator">}</span>
<span class="w">                       </span><span class="p p-Indicator">}</span>
<span class="w">                   </span><span class="p p-Indicator">],</span>
<span class="w">                   </span><span class="s">"name"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"R1_TRAFFIC"</span>
<span class="w">               </span><span class="p p-Indicator">}</span>
<span class="w">           </span><span class="p p-Indicator">],</span>
<span class="w">           </span><span class="s">"afi"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"ipv6"</span>
<span class="w">       </span><span class="p p-Indicator">}</span>
<span class="w">   </span><span class="p p-Indicator">]</span>
</pre></div>

<h3>Conclusion</h3>
<p>The ACLs resource modules provide an easy way for network engineers to
begin automating access lists on multiple network platforms. While some
configuration can remain static on network devices, ACLs might need
constant updates and verification. These resource modules allow users to
adopt automation in incremental steps to make it easy for organizations
to adopt.  As soon as you have transformed your ACLs into structured
data, any resource module from any network platform can read. Imagine
reading in ACLs for your Cisco IOS box and transforming them into Cisco
IOS-XR commands. </p>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../getting-started-with-aws-ansible-module-development/" rel="prev" title="Getting Started With AWS Ansible Module Development and Community Contribution">Previous post</a>
            </li>
            <li class="next">
                <a href="../best-of-fest-ansiblefest-2020/" rel="next" title="Best of AnsibleFest 2020">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
