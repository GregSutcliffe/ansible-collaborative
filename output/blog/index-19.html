<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Ansible Collaborative Website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ansible Collaborative (old posts, page 19) | Ansible Collaborative</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/index-19.html">
<link rel="prev" href="index-20.html" type="text/html">
<link rel="next" href="index-18.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../">
        <img src="../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
    
  <div class="postindex ansible-content">
      <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-80/" class="u-url">Bullhorn #80</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-80/" rel="bookmark">
                <time class="published dt-published" datetime="2022-11-04T21:00:00Z" itemprop="datePublished" title="2022-11-04 21:00">2022-11-04 21:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #80, 2022-11-04 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="introducing-the-ansible-api-for-servicenow-itsm/" class="u-url">Introducing the Ansible API for ServiceNow ITSM</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/tricia-mcconnell/">Tricia McConnell</a>
              </span>
            </p>
            <p class="dateline">
              <a href="introducing-the-ansible-api-for-servicenow-itsm/" rel="bookmark">
                <time class="published dt-published" datetime="2022-11-03T00:00:00Z" itemprop="datePublished" title="2022-11-03 00:00">2022-11-03 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Introducing the Ansible API for ServiceNow ITSM</h2>
<p>One of the most popular platform integrations available to Ansible
Automation Platform subscribers in <a href="https://console.redhat.com/">Ansible automation
hub</a> is the Red Hat Ansible Certified
Content Collection for ServiceNow ITSM. This collection helps you create
new automation workflows faster based on ServiceNow ITSM while
establishing a single source of truth in the ServiceNow configuration
management database (CMDB). You can help free teams from hours of manual
effort and have greater data integrity within your ServiceNow ITSM
instance. </p>
<p>For ServiceNow users, we've launched a new native ServiceNow
application, the API for Red Hat Ansible Automation Platform Certified
Content Collection, available exclusively through the <a href="https://store.servicenow.com/">ServiceNow
store</a> to enhance and support the
integration between the two platforms.   </p>
<h2>What is the Ansible API for ServiceNow ITSM?</h2>
<p>The API for Red Hat Ansible Automation Platform Certified Content
Collection integrates Ansible's certified content with your ServiceNow
instance. Prior to the launch of ServiceNow's Rome API, Ansible users
could download the Red Hat Ansible Certified Content Collection for
ServiceNow ITSM from the Ansible automation hub and directly manage
ServiceNow resources using their REST API. </p>
<p><strong>With the release of Rome</strong>, the REST API no longer provided all of the
support needed to automate ServiceNow using Ansible. To remedy this
problem, Red Hat and our partner, XLAB, developed this new API to
enhance and restore that functionality. </p>
<p>While the need to develop the Ansible API for ServiceNow ITSM was a
result of the release of Rome, it's also compatible with ServiceNow
ITSM San Diego and Tokyo.</p>
<h2>What can you automate in the ServiceNow ITSM?</h2>
<p>Using both the API and the Certified Content Collection for ServiceNow
ITSM, you can:</p>
<ul>
<li>
<strong>Automate change requests.</strong> Use Ansible Playbooks to automate
    ServiceNow ITSM service requests, including reporting change results
    and all information related to those changes. Your service
    representatives can simply kick off an Ansible Playbook to resolve
    common requests and reduce rote, repetitive tasks.</li>
<li>
<strong>Automate incident response.</strong> Assets in the ServiceNow Certified
    Collection support automatic updates to incident tickets to provide
    a consistent audit trail. Your team can also streamline the required
    steps for issue remediation and apply them at scale.</li>
<li>
<strong>Enable full "closed loop" automation.</strong> Simplify the opening,
    advancement, and resolution of IT service management workflow items
    while keeping relevant and accurate information flowing into the
    CMDB across disparate users, teams, and assets. Ensure that
    infrastructure information is always up to date, actionable, and
    auditable while work is completed by cross-domain teams that may or
    may not have access to ServiceNow.</li>
</ul>
<h2>Getting started with the Ansible API for ServiceNow ITSM</h2>
<p>To get started:</p>
<ul>
<li>Install the API for Red Hat Ansible Certified Content Collection for
    free from the <a href="https://store.servicenow.com/">ServiceNow store </a>and
    consult the "Application Installation and Configuration Guide" for
    additional instructions. </li>
<li>Download the Ansible Content Collection for ServiceNow ITSM from
    Ansible automation hub on the <a href="https://console.redhat.com/">Red Hat Hybrid Cloud
    Console</a>. </li>
</ul>
<h2>Additional resources</h2>
<ul>
<li>
<strong>AnsibleFest Session:</strong> Watch the virtual session, <a href="https://events.experiences.redhat.com/widget/redhat/rhaf22/SessionCatalog2022/session/1655917075001001Lcld">Integrating automation into your ServiceNow ITSM</a> with Red Hat customer and long time ServiceNow ITSM user, <a href="https://www.redhat.com/rhdc/managed-files/ve-bcbs-nc-short-case-study-f31625-202205-en.pdf">Blue Cross Blue Shield of North Carolina</a>. </li>
<li>
<strong>Brief:</strong> <a href="https://www.redhat.com/en/resources/ansible-certified-content-collection-for-servicenow-overview">Take a closer look at what Ansible can automate in the ServiceNow ITSM</a>
</li>
<li>
<strong>Self-paced Lab:</strong> <a href="https://www.redhat.com/en/engage/redhat-ansible-automation-202108061218">Get hands on with the ServiceNow Content Collection</a>
</li>
</ul>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="let-ansible-keep-an-eye-on-your-aws-environment/" class="u-url">Let Ansible keep an eye on your AWS environment</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/gomathi-selvi-srinivasan/">Gomathi Selvi Srinivasan</a>
              </span>
            </p>
            <p class="dateline">
              <a href="let-ansible-keep-an-eye-on-your-aws-environment/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-31T00:00:00Z" itemprop="datePublished" title="2022-10-31 00:00">2022-10-31 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Let Ansible keep an eye on your AWS environment</h2>
<p>In a cloud model, the security of the environment and compliance becomes
the responsibility of both the end users and the cloud provider. This is
what we call the shared responsibility model in which every part of the
cloud, including the hardware, data, configurations, access rights, and
operating system, are protected. Depending on the local legislation and
the origin of the data that is handled (for instance laws like HIPAA,
the GDPR in Europe, or the Californian CCPA),  you may have to enforce
strict rules on your environment and log events for audit purposes. AWS
CloudTrail will help you to achieve this goal. The service can collect
and record any kind of information coming from your environment and
store or send the events to a destination for audit. In addition to
security and compliance, this service helps keep track of resource
consumption.</p>
<p>Ansible's CloudTrail module is used to leverage the various features of
the CloudTrail service to monitor and audit user activities and API
calls in the AWS environment. A trail is a configuration that lets us
describe an event filter and decide where the matching entries should be
sent. The recent 5.0.0 release of the Amazon.aws collection comes with a
new Cloudtrail module. This module helps create, configure, and delete a
trail. The final destination of a trail can be an S3 bucket or a
CloudWatch log. We have also paired the cloudtrail module with a
cloudtrail_info module, which helps collect the information of all or a
specific trail.</p>
<p>In this blog post, we are going to take a few configuration use cases
and show how Ansible's CloudTrail module can be used to automate the
same.</p>
<p>To download the amazon.aws collection, you can download it from</p>
<ul>
<li>
<a href="https://galaxy.ansible.com/amazon/aws">Ansible Galaxy</a> - Community</li>
<li>
<a href="https://console.redhat.com/ansible/automation-hub/repo/published/amazon/aws">Ansible automation hub</a> -
    Fully supported and signed with your Red Hat subscription</li>
</ul>
<h3>Use Case 1 - Get maximum visibility</h3>
<p>Unless a trail is used for a specific activity in a specific region, it
is the best practice to enable CloudTrail for all regions. By doing so,
we maximize the visibility of the AWS environment so there is no
weakness (unmonitored region) that can be exploited by an attacker. This
will also make sure that we receive the event history for any new region
that AWS will launch in the future. </p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nl">name:</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">multi</span><span class="o">-</span><span class="n">region</span><span class="w"> </span><span class="n">trail</span>
<span class="w">  </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">cloudtrail:</span>
<span class="w">    </span><span class="nl">state:</span><span class="w"> </span><span class="n">present</span>
<span class="w">    </span><span class="nl">name:</span><span class="w"> </span><span class="n">myCloudTrail</span>
<span class="w">    </span><span class="nl">s3_bucket_name:</span><span class="w"> </span><span class="n">mylogbucket</span>
<span class="w">    </span><span class="nl">region:</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span>
<span class="w">    </span><span class="nl">is_multi_region_trail:</span><span class="w"> </span><span class="n">true</span>
<span class="w">    </span><span class="nl">tags:</span>
<span class="w">      </span><span class="nl">environment:</span><span class="w"> </span><span class="n">dev</span>
</pre></div>

<p>The cloudtrail_info module can be used to get all the information about
a particular trail or all the trails present. If a trail name is not
provided as input to this module, this module will get the information
of all trails, including shadow trails, by default. The shadow trails
can be skipped by setting
[include_shadow_trails] to [False].</p>
<div class="code"><pre class="code literal-block"><span class="p">#</span><span class="w"> </span><span class="n">Gather</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">multi</span><span class="o">-</span><span class="n">region</span><span class="w"> </span><span class="n">trail</span>
<span class="o">-</span><span class="w"> </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">cloudtrail_info:</span>
<span class="w">    </span><span class="nl">trail_names:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">arn:aws:cloudtrail:</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">123456789012</span><span class="o">:</span><span class="n">trail</span><span class="o">/</span><span class="n">myCloudTrail</span>
<span class="w">    </span><span class="nl">include_shadow_trails:</span><span class="w"> </span><span class="n">False</span>
<span class="w">      </span><span class="nl">register:</span><span class="w"> </span><span class="n">trail_info</span>

<span class="n">trail_info</span><span class="w"> </span><span class="o">:</span>
<span class="s">"trail_list"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">"has_custom_event_selectors"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"has_insight_selectors"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"home_region"</span><span class="o">:</span><span class="w"> </span><span class="s">"us-east-1"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"include_global_service_events"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_logging"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_multi_region_trail"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_organization_trail"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_delivery_attempt_succeeded"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_delivery_attempt_time"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_notification_attempt_succeeded"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_notification_attempt_time"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"log_file_validation_enabled"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"name"</span><span class="o">:</span><span class="w"> </span><span class="s">"myCloudTrail"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"resource_id"</span><span class="o">:</span><span class="w"> </span><span class="s">"arn:aws:cloudtrail:us-east-1:123456789012:trail/myCloudTrail"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"s3_bucket_name"</span><span class="o">:</span><span class="w"> </span><span class="s">"mylogbucket"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"start_logging_time"</span><span class="o">:</span><span class="w"> </span><span class="s">"2022-09-29T11:41:41.752000-04:00"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"tags"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">"environment"</span><span class="o">:</span><span class="w"> </span><span class="s">"dev"</span><span class="p">},</span>
<span class="w">                </span><span class="s">"time_logging_started"</span><span class="o">:</span><span class="w"> </span><span class="s">"2022-09-29T15:41:41Z"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"time_logging_stopped"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"trail_arn"</span><span class="o">:</span><span class="w"> </span><span class="s">"arn:aws:cloudtrail:us-east-1:123456789012:trail/myCloudTrail"</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
</pre></div>

<h3>Use Case 2 - Manage access to S3 buckets</h3>
<p>For this use case, we will manage the access given to the S3 buckets
where the trail logs are stored. As mentioned earlier, shared
responsibility includes sharing the security of the resources as well. 
S3 buckets are prone to incorrect configurations and are the major
source of data leaks. S3 buckets configured with public access allow
anyone on the internet to access the data. Ansible's s3_bucket  module
can be used to set CloudTrail's S3 bucket permissions and policies. This
S3 bucket can be passed to the CloudTrail module, which will be used as
the destination for the trail-generated logs.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">s3_bucket:</span>
<span class="w">   </span><span class="nl">name:</span><span class="w"> </span><span class="n">mys3bucket</span>
<span class="w">   </span><span class="nl">state:</span><span class="w"> </span><span class="n">present</span>
<span class="w">   </span><span class="nl">public_access:</span>
<span class="w">       </span><span class="nl">block_public_acls:</span><span class="w"> </span><span class="n">true</span>
<span class="w">       </span><span class="nl">ignore_public_acls:</span><span class="w"> </span><span class="n">true</span>
<span class="w">       </span><span class="nl">block_public_policy:</span><span class="w"> </span><span class="n">false</span>
<span class="w">       </span><span class="nl">restrict_public_buckets:</span><span class="w"> </span><span class="n">false</span>

<span class="o">-</span><span class="w"> </span><span class="nl">name:</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">trail</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">secured</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="n">bucket</span>
<span class="w">  </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">cloudtrail:</span>
<span class="w">    </span><span class="nl">state:</span><span class="w"> </span><span class="n">present</span>
<span class="w">    </span><span class="nl">name:</span><span class="w"> </span><span class="n">myCloudTrail</span>
<span class="w">    </span><span class="nl">s3_bucket_name:</span><span class="w"> </span><span class="n">mys3bucket</span>
<span class="w">    </span><span class="nl">region:</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span>
<span class="w">    </span><span class="nl">tags:</span>
<span class="w">      </span><span class="nl">environment:</span><span class="w"> </span><span class="n">dev</span>
</pre></div>

<h3>Use Case 3 - Maintain CloudTrail logs integrity</h3>
<p>CloudTrail logs are collected to verify the compliance and security of
the AWS environment. It is always possible that an attacker can gain
access and tamper with these logs to obscure their presence. By enabling
log file validation, a digital signature of the log file is generated,
which is used to check if the log files are valid and not tampered with.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="nl">name:</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">trail</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">log</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">validation</span>
<span class="w">  </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">cloudtrail:</span>
<span class="w">    </span><span class="nl">state:</span><span class="w"> </span><span class="n">present</span>
<span class="w">    </span><span class="nl">name:</span><span class="w"> </span><span class="n">myCloudTrail</span>
<span class="w">    </span><span class="nl">s3_bucket_name:</span><span class="w"> </span><span class="n">mylogbucket</span>
<span class="w">    </span><span class="nl">region:</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span>
<span class="w">    </span><span class="nl">log_file_validation_enabled:</span><span class="w"> </span><span class="n">true</span>
<span class="w">    </span><span class="nl">tags:</span>
<span class="w">      </span><span class="nl">environment:</span><span class="w"> </span><span class="n">dev</span>

<span class="p">#</span><span class="w"> </span><span class="n">Gather</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">trail</span>
<span class="o">-</span><span class="w"> </span><span class="n">amazon</span><span class="p">.</span><span class="n">aws</span><span class="p">.</span><span class="nl">cloudtrail_info:</span>
<span class="w">    </span><span class="nl">trail_names:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="nl">arn:aws:cloudtrail:</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">123456789012</span><span class="o">:</span><span class="n">trail</span><span class="o">/</span><span class="n">myCloudTrail</span>
<span class="w">    </span><span class="nl">include_shadow_trails:</span><span class="w"> </span><span class="n">False</span>
<span class="w">      </span><span class="nl">register:</span><span class="w"> </span><span class="n">trail_info</span>

<span class="n">trail_info</span><span class="w"> </span><span class="o">:</span>
<span class="s">"trail_list"</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="s">"has_custom_event_selectors"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"has_insight_selectors"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"home_region"</span><span class="o">:</span><span class="w"> </span><span class="s">"us-east-1"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"include_global_service_events"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_logging"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_multi_region_trail"</span><span class="o">:</span><span class="w"> </span><span class="n">fail</span><span class="p">,</span>
<span class="w">                </span><span class="s">"is_organization_trail"</span><span class="o">:</span><span class="w"> </span><span class="n">false</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_delivery_attempt_succeeded"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_delivery_attempt_time"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_notification_attempt_succeeded"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"latest_notification_attempt_time"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"log_file_validation_enabled"</span><span class="o">:</span><span class="w"> </span><span class="n">true</span><span class="p">,</span>
<span class="w">                </span><span class="s">"name"</span><span class="o">:</span><span class="w"> </span><span class="s">"myCloudTrail"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"resource_id"</span><span class="o">:</span><span class="w"> </span><span class="s">"arn:aws:cloudtrail:us-east-1:123456789012:trail/myCloudTrail"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"s3_bucket_name"</span><span class="o">:</span><span class="w"> </span><span class="s">"mylogbucket"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"start_logging_time"</span><span class="o">:</span><span class="w"> </span><span class="s">"2022-09-29T11:41:41.752000-04:00"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"tags"</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="s">"environment"</span><span class="o">:</span><span class="w"> </span><span class="s">"dev"</span><span class="p">},</span>
<span class="w">                </span><span class="s">"time_logging_started"</span><span class="o">:</span><span class="w"> </span><span class="s">"2022-09-29T15:41:41Z"</span><span class="p">,</span>
<span class="w">                </span><span class="s">"time_logging_stopped"</span><span class="o">:</span><span class="w"> </span><span class="s">""</span><span class="p">,</span>
<span class="w">                </span><span class="s">"trail_arn"</span><span class="o">:</span><span class="w"> </span><span class="s">"arn:aws:cloudtrail:us-east-1:123456789012:trail/myCloudTrail"</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">]</span>
</pre></div>

<h3>Use Case 4 - Encrypt the logs</h3>
<p>By default, the S3 buckets are protected by an A[mazon server-side
encryption method and Amazon S3-managed encryption keys.
To add an extra layer of security, you can use
the AWS Key Management Service. This is directly manageable and helps
protect the log files from any attacker's survey of the environment.</p>
<div class="code"><pre class="code literal-block"><span class="x">- name: Create an LMS key using lookup for policy JSON</span>
<span class="x">  amazon.aws.kms_key:</span>
<span class="x">    alias: my-kms-key</span>
<span class="x">    policy: "</span><span class="cp">{{</span> <span class="nv">lookup</span><span class="o">(</span><span class="s1">'template'</span><span class="o">,</span> <span class="s1">'kms_iam_policy_template.json.j2'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"</span>
<span class="x">    state: present</span>
<span class="x">  register: kms_key_for_logs</span>

<span class="x">- name: Create a CloudTrail with kms_key for encryption</span>
<span class="x">  amazon.aws.cloudtrail:</span>
<span class="x">     state: present</span>
<span class="x">     name: myCloudTrail</span>
<span class="x">     s3_bucket_name: mylogbucket</span>
<span class="x">     kms_key_id: "</span><span class="cp">{{</span> <span class="nv">kms_key_for_logs.key_id</span> <span class="cp">}}</span><span class="x">"</span>
</pre></div>

<p>Similar to the use cases mentioned above, many parameters allow the
CloudTrail logs to be secure, compliant, and manageable. To get more
information on how to configure CloudTrail and get the configuration
information of an existing trail, please refer to
<a href="https://ansible-collections.github.io/amazon.aws/branch/main/collections/amazon/aws/cloudtrail_module.html#ansible-collections-amazon-aws-cloudtrail-module">amazon.aws.cloudtrail</a>
and
<a href="https://ansible-collections.github.io/amazon.aws/branch/main/collections/amazon/aws/cloudtrail_info_module.html#ansible-collections-amazon-aws-cloudtrail-info-module">amazon.aws.cloudtrail_info</a>.</p>
<p>Now you can see four awesome use cases for Red Hat Ansible Automation
Platform and CloudTrail and how they can easily and seamlessly work
together to accomplish cloud automation tasks. If you want more blogs on
Ansible and AWS, please let us know!</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-79/" class="u-url">Bullhorn #79</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-79/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-28T22:10:00Z" itemprop="datePublished" title="2022-10-28 22:10">2022-10-28 22:10</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #79, 2022-10-28 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="best-of-fest-2022/" class="u-url">Best of Fest 2022</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/elle-universal/">Elle Universal</a>
              </span>
            </p>
            <p class="dateline">
              <a href="best-of-fest-2022/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-24T00:00:00Z" itemprop="datePublished" title="2022-10-24 00:00">2022-10-24 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Best of Fest 2022</h2>
<p>At AnsibleFest 2022, the power of automation was on full display.
Through sessions, workshops, labs and more, we explored how to transform
enterprise and industry through automation. There were a lot of exciting
<a href="https://www.redhat.com/en/about/ansiblefest-newsroom">announcements</a>
made on both days, and in case you missed it, we are going to dive into
what is new!</p>
<h2>Ansible and AWS</h2>
<p>We are thrilled to also announce a new AWS Marketplace offering, Red Hat
Ansible Automation Platform. By offering Ansible Automation Platform as
a pre-integrated service that can be quickly deployed from cloud
marketplaces, we are meeting our customers where they are, while giving
them the flexibility to deliver any application, anywhere, without
additional overhead or complexity. Whether you are automating your
hybrid cloud or multi-cloud environments, Ansible Automation Platform
acts as a single platform. This platform provides consistency,
visibility, and control to help  you manage these environments at scale.
Ansible is the IT automation "glue" for bringing your cloud, network,
bare-metal and cloud-native infrastructure together. This  provides the
functionality to coordinate and manage across  hybrid cloud environments
in a simple and efficient way. Interested in learning more? Check out
the <a href="http://www.redhat.com/en/about/press-releases/red-hat-introduces-red-hat-ansible-automation-platform-aws-marketplace">press release</a>.</p>
<h2>Automation at the Edge</h2>
<p>Ansible Automation Platform provides a framework for building and
operating IT automation at scale. What this means for edge, much like
the data center, is that users across an entire organization can create,
share, and manage automation. They can develop and apply guidelines for 
using automation within individual groups. They can write tasks that use
existing knowledge so they can be leveraged by nonIT staff, allowing
end-to-end automation to be deployed. Ansible Automation Platform uses
containerization to package, distribute, and execute automation across
environments securely via automation execution environments. This
enables organizations to rapidly and consistently extend IT services to
the edge, while maintaining a focus on security. This helps
organizations to simplify capacity scaling, increase resiliency, and
improve consistency. Learn more about automation at the edge
<a href="http://ansible.com/use-cases/edge">here.</a></p>
<h2>Event-Driven Ansible</h2>
<p>Event-Driven Ansible is a new capability that we're making available to
the entire Ansible open source community in developer preview. With
Event-Driven Ansible, you can eliminate low-level tasks from the
day-to-day routine so you have more time to focus on innovations. This
means a happier, more productive, and more engaged team. It is fast,
accurate, and will free you (and your teams) to work on the things you
WANT to be doing, without being dragged down by all the things you HAVE
to do. Event--Driven Ansible will support a range of use cases, and here
are few good ones to get started with:</p>
<ul>
<li>Automating remediation of common problems, like resetting a network router that's out.</li>
<li>Gathering information to solve problems faster, like information about a server configuration or buffer pool size so when you get the service ticket, the information you need is already there.</li>
<li>Administering user requests ... like "I can't log in" or "I cannot access the application".</li>
</ul>
<p>We are excited about the future of automation and what is possible with
Event-Driven Ansible.</p>
<h2>Project Wisdom</h2>
<p><a href="http://www.redhat.com/en/about/press-releases/red-hat-and-ibm-research-advance-it-automation-ai-powered-capabilities-ansible">Project Wisdom</a>
is a Red Hat initiative, developed in close collaboration with IBM
Research, to give Ansible artificial intelligence superpowers. The first
goal is to bring together automation novices and Ansible experts while
enabling new automators to drastically reduce the challenge of learning
and mastering Ansible. The first capability we are using AI for is
content generation. The AI models we use underneath Project Wisdom are
able to generate Ansible Playbooks or roles that are both syntactically
correct and functional. You can also head to redhat.com/wisdom for more
information on how to get involved. </p>
<h2>Ansible Automation Platform 2</h2>
<p>Ansible Automation Platform 2 is built to enable a trusted automation
supply chain. In the upcoming  Ansible Automation Platform 2.3 release,
digital signing will be supported for containers, playbooks and
collections. We're also excited to introduce
Ansible validated content, which
complements the  existing  ecosystem of Red Hat Ansible Certified
Content Collections. Ansible validated content helps your teams to start
automating faster by following a trusted, expert-led, opinionated path
for performing operations and tasks on both Red Hat and third party
platforms. Initially, Ansible validated content will be pre-loaded into
private automation hub.</p>
<h3>Community</h3>
<p>We are so fortunate that we are a part of one of the largest, most
vibrant open source project communities in the world. So while the
landscape may be shifting around us, Ansible continues to push forward
and evolve with the times. Ansible is celebrating its 10th anniversary
this year! Within our expansive community, the new Working Groups focus
on expanding the Ansible ecosystem with the development of Ansible
Content Collections. First spun up by our team last year, Matrix has
made a huge difference in our ability to connect and engage with the
Ansible community. So far we've spun up 32 unique chat rooms, with 4200+
members and nearly 80k messages sent in the past 6 months. Matrix's
ability to bridge with IRC gave us a strong foundation upon which to
build. Join the Working Groups and become a part of the conversation:
<a href="https://matrix.to/#/#social:ansible.com">https://matrix.to/#/#social:ansible.com</a></p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="getting-started-with-event-driven-ansible/" class="u-url">Getting Started with Event-Driven Ansible</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/nuno-martins/">Nuno Martins</a>
              </span>
            </p>
            <p class="dateline">
              <a href="getting-started-with-event-driven-ansible/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-19T13:00:00Z" itemprop="datePublished" title="2022-10-19 13:00">2022-10-19 13:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Getting Started with Event-Driven Ansible</h2>
<p>As one technology advances, it expands the possibilities for other technologies and offers the solutions of tomorrow for the challenges we face today. AnsibleFest 2022 brings us new advances in Ansible automation that are as bright as they are innovative. I am talking about the Event-Driven Ansible developer preview.</p>
<p>Automation allows us to give our systems and technology speed and agility while minimizing human error. However, when it comes to trouble tickets and issues, we are often left to traditional and manual methods of troubleshooting and information gathering. We inherently slow things down and interrupt our businesses. We have to gather information, try our common troubleshooting steps, confirm with different teams, and eventually, we need to sleep.</p>
<p>The following image illustrates a support lifecycle with many manual steps and hand-offs:</p>
<p><img alt="support lifecycle diagram" src="../images/posts/archive/getting-started-eda-lifecycle-diagram.png"></p>
<p>One application of Event-Driven Ansible is to remediate technology issues before near real-time, or at least trigger troubleshooting and information collection in an attempt to find the root cause of an outage while your support teams handle other issues.</p>
<p>The following image illustrates how event-driven automation is used in the support lifecycle: fewer steps, faster Mean-Time-To-Resolution.</p>
<p><img alt="Event-Driven Ansible in the support lifecycle" src="../images/posts/archive/getting-started-eda-eda.png"></p>
<p>Event-Driven Ansible has the potential to change the way we respond to issues and illuminates many new automation possibilities. So, how do you take the next step with Event-Driven Ansible?</p>
<h2>Let’s get started!</h2>
<p>Event-Driven Ansible is currently in developer preview, however there is nothing stopping us from installing ansible-rulebook, which is the CLI component of Event-Driven Ansible, and building our first rulebook. Event-Driven Ansible contains a decision framework that was built using Drools. We need a rulebook to tell the system what events to flag and how to respond to them. These rulebooks are also created in YAML and are used like traditional Ansible Playbooks, so this makes it easier to understand and build the rulebooks we need. One key difference between playbooks and rulebooks is the If-this-then-that coding that is needed in a rulebook to make an event driven  automation approach work.</p>
<p>A rulebook is comprised of three main components:</p>
<ul>
<li>
<p><strong>Sources</strong> define which event source we will use. These sources come from source plugins which have been built to accommodate common use cases. With time, more and more sources will be available. There are some source plugins that are available already, including: webhooks, Kafka, Azure service bus, file changes, and alertmanager.</p>
</li>
<li>
<p><strong>Rules</strong> define conditionals we will try to match from the event source. Should the condition be met, then we can trigger an action.</p>
</li>
<li>
<p><strong>Actions</strong> trigger what you need to happen should a condition be met. Some of the current actions are: run_playbook, run_module, set_fact, post_event, and debug.</p>
</li>
</ul>
<p><img alt="getting-started-with-event-driven-ansible" src="../images/posts/archive/getting-started-eda-event-source.png"></p>
<p>Now, let's install ansible-rulebook and start with our very first event.</p>
<p>To install ansible-rulebook, we can install our Galaxy Collection, which has a playbook to install everything we need.</p>
<div class="code"><pre class="code literal-block">ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>ansible.eda
</pre></div>

<p>Once the Collection is installed, you can run the install-rulebook-cli.yml playbook. This will install everything you need to get started with ansible-rulebook on the command line. This is currently supported for Mac and Fedora.</p>
<p><strong>Note:</strong> Now, you could also skip this method above and install ansible-rulebook with pip, followed by installing the ansible.eda collection. Java 11+ is required if you use this method and we suggest using <a href="https://jdk.java.net/19/">openjdk</a>. (This step is not required if you used the previous install method.)</p>
<div class="code"><pre class="code literal-block">pip<span class="w"> </span>install<span class="w"> </span>ansible-rulebook

ansible-galaxy<span class="w"> </span>collection<span class="w"> </span>install<span class="w"> </span>ansible.eda
</pre></div>

<p>If you want to contribute to ansible-rulebook, you can also fork the following <a href="https://github.com/ansible/ansible-rulebook">GitHub repository</a>. This repository also contains instructions for setting up your development environment and how to build a test container.</p>
<p>Let's build an example rulebook that will trigger an action from a webhook. We will be looking for a specific payload from the webhook, and if that condition is met from the webhook event, then ansible-rulebook will trigger the desired action. Below is our example rulebook:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Listen for events on a webhook</span>
<span class="w w-Error"> </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>

<span class="w"> </span><span class="c1">## Define our source for events</span>

<span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ansible.eda.webhook</span><span class="p">:</span>
<span class="w">       </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0</span>
<span class="w">       </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>

<span class="w"> </span><span class="c1">## Define the conditions we are looking for</span>

<span class="w"> </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">   </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Say Hello</span>
<span class="w">     </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">event.payload.message == "Ansible is super cool!"</span>

<span class="w"> </span><span class="c1">## Define the action we should take should the condition be met</span>

<span class="w">     </span><span class="nt">action</span><span class="p">:</span>
<span class="w">       </span><span class="nt">run_playbook</span><span class="p">:</span>
<span class="w">         </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">say-what.yml</span>
</pre></div>

<p>If we look at this example, we can see the structure of the rulebook. Our sources, rules and actions are defined. We are using the webhook source plugin from our ansible.eda collection, and we are looking for a message payload from our webhook that contains "Ansible is super cool". Once this condition has been met, our defined action will trigger, which in this case is to trigger a playbook.</p>
<p>One important thing to take note of ansible-rulebook is that it is not like ansible-playbook which runs a playbook and once the playbook has been completed it will exit. With ansible-rulebook, it will continue to run waiting for events and matching those events. It will only exit upon a shutdown action or if there is an issue with the event source itself, for example if a website you are watching with the url-check plugin stops working.</p>
<p>With our rulebook built, we will simply tell ansible-rulebook to use it as a ruleset and wait for events:</p>
<div class="code"><pre class="code literal-block">root@ansible-rulebook:/root#<span class="w"> </span>ansible-rulebook<span class="w"> </span>--rules<span class="w"> </span>webhook-example.yml<span class="w"> </span>-i<span class="w"> </span>inventory.yml<span class="w"> </span>--verbose

INFO:ansible_events:Starting<span class="w"> </span>sources
INFO:ansible_events:Starting<span class="w"> </span>sources
INFO:ansible_events:Starting<span class="w"> </span>rules
INFO:root:run_ruleset
INFO:root:<span class="o">{</span><span class="s1">'all'</span>:<span class="w"> </span><span class="o">[{</span><span class="s1">'m'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'payload.message'</span>:<span class="w"> </span><span class="s1">'Ansible is super cool!'</span><span class="o">}}]</span>,<span class="w"> </span><span class="s1">'run'</span>:<span class="w"> </span>&lt;<span class="k">function</span><span class="w"> </span>make_fn.&lt;locals&gt;.fn<span class="w"> </span>at<span class="w"> </span>0x7ff962418040&gt;<span class="o">}</span>
INFO:root:Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>event
INFO:root:load<span class="w"> </span><span class="nb">source</span>
INFO:root:load<span class="w"> </span><span class="nb">source</span><span class="w"> </span>filters
INFO:root:Calling<span class="w"> </span>main<span class="w"> </span><span class="k">in</span><span class="w"> </span>ansible.eda.webhook
</pre></div>

<p>Now, ansible-rulebook is ready and it's waiting for an event to match. If a webhook is triggered but the payload does not match our condition in our rule, we can see it in the ansible-rulebook verbose output:</p>
<div class="code"><pre class="code literal-block">…
INFO:root:Calling<span class="w"> </span>main<span class="w"> </span><span class="k">in</span><span class="w"> </span>ansible.eda.webhook
INFO:aiohttp.access:127.0.0.1<span class="w"> </span><span class="o">[</span><span class="m">14</span>/Oct/2022:09:49:32<span class="w"> </span>+0000<span class="o">]</span><span class="w"> </span><span class="s2">"POST /endpoint HTTP/1.1"</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">158</span><span class="w"> </span><span class="s2">"-"</span><span class="w"> </span><span class="s2">"curl/7.61.1"</span>
INFO:root:Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>event
</pre></div>

<p>But once our payload matches what we are looking for, that’s when the magic happens, so we will simulate a webhook with the correct payload:</p>
<div class="code"><pre class="code literal-block">curl<span class="w"> </span>-H<span class="w"> </span><span class="s1">'Content-Type: application/json'</span><span class="w"> </span>-d<span class="w"> </span><span class="s2">"{\"message\": \"Ansible is super cool\"}"</span><span class="w"> </span><span class="m">127</span>.0.0.1:5000/endpoint

INFO:root:Calling<span class="w"> </span>main<span class="w"> </span><span class="k">in</span><span class="w"> </span>ansible.eda.webhook
INFO:aiohttp.access:127.0.0.1<span class="w"> </span><span class="o">[</span><span class="m">14</span>/Oct/2022:09:50:28<span class="w"> </span>+0000<span class="o">]</span><span class="w"> </span><span class="s2">"POST /endpoint HTTP/1.1"</span><span class="w"> </span><span class="m">200</span><span class="w"> </span><span class="m">158</span><span class="w"> </span><span class="s2">"-"</span><span class="w"> </span><span class="s2">"curl/7.61.1"</span>
INFO:root:calling<span class="w"> </span>Say<span class="w"> </span>Hello
INFO:root:call_action<span class="w"> </span>run_playbook
INFO:root:substitute_variables<span class="w"> </span><span class="o">[{</span><span class="s1">'name'</span>:<span class="w"> </span><span class="s1">'say-what.yml'</span><span class="o">}]</span><span class="w"> </span><span class="o">[{</span><span class="s1">'event'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'payload'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'message'</span>:<span class="w"> </span><span class="s1">'Ansible is super cool'</span><span class="o">}</span>,<span class="w"> </span><span class="s1">'meta'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'endpoint'</span>:<span class="w"> </span><span class="s1">'endpoint'</span>,<span class="w"> </span><span class="s1">'headers'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'Host'</span>:<span class="w"> </span><span class="s1">'127.0.0.1:5000'</span>,<span class="w"> </span><span class="s1">'User-Agent'</span>:<span class="w"> </span><span class="s1">'curl/7.61.1'</span>,<span class="w"> </span><span class="s1">'Accept'</span>:<span class="w"> </span><span class="s1">'*/*'</span>,<span class="w"> </span><span class="s1">'Content-Type'</span>:<span class="w"> </span><span class="s1">'application/json'</span>,<span class="w"> </span><span class="s1">'Content-Length'</span>:<span class="w"> </span><span class="s1">'36'</span><span class="o">}}}</span>,<span class="w"> </span><span class="s1">'fact'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'payload'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'message'</span>:<span class="w"> </span><span class="s1">'Ansible is super cool'</span><span class="o">}</span>,<span class="w"> </span><span class="s1">'meta'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'endpoint'</span>:<span class="w"> </span><span class="s1">'endpoint'</span>,<span class="w"> </span><span class="s1">'headers'</span>:<span class="w"> </span><span class="o">{</span><span class="s1">'Host'</span>:<span class="w"> </span><span class="s1">'127.0.0.1:5000'</span>,<span class="w"> </span><span class="s1">'User-Agent'</span>:<span class="w"> </span><span class="s1">'curl/7.61.1'</span>,<span class="w"> </span><span class="s1">'Accept'</span>:<span class="w"> </span><span class="s1">'*/*'</span>,<span class="w"> </span><span class="s1">'Content-Type'</span>:<span class="w"> </span><span class="s1">'application/json'</span>,<span class="w"> </span><span class="s1">'Content-Length'</span>:<span class="w"> </span><span class="s1">'36'</span><span class="o">}}}}]</span>
INFO:root:action<span class="w"> </span>args:<span class="w"> </span><span class="o">{</span><span class="s1">'name'</span>:<span class="w"> </span><span class="s1">'say-what.yml'</span><span class="o">}</span>
INFO:root:running<span class="w"> </span>Ansible<span class="w"> </span>playbook:<span class="w"> </span>say-what.yml
INFO:root:Calling<span class="w"> </span>Ansible<span class="w"> </span>runner

PLAY<span class="w"> </span><span class="o">[</span>say<span class="w"> </span>thanks<span class="o">]</span><span class="w"> </span>**************************************************************

TASK<span class="w"> </span><span class="o">[</span>debug<span class="o">]</span><span class="w"> </span>*******************************************************************
ok:<span class="w"> </span><span class="o">[</span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">"msg"</span>:<span class="w"> </span><span class="s2">"Thank you, my friend!"</span>
<span class="o">}</span>

PLAY<span class="w"> </span>RECAP<span class="w"> </span>*********************************************************************
localhost<span class="w">                  </span>:<span class="w"> </span><span class="nv">ok</span><span class="o">=</span><span class="m">1</span><span class="w">    </span><span class="nv">changed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">unreachable</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">failed</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">skipped</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">rescued</span><span class="o">=</span><span class="m">0</span><span class="w">    </span><span class="nv">ignored</span><span class="o">=</span><span class="m">0</span>

INFO:root:Waiting<span class="w"> </span><span class="k">for</span><span class="w"> </span>event
</pre></div>

<p>We can see from the output above, that the condition was met from the webhook and ansible-rulebook then triggered our action which was to run_playbook. The playbook we defined is then triggered and once it completes we can see we revert back to "Waiting for event".</p>
<p>Event-Driven Ansible opens up the possibilities of faster resolution and greater automated observation of our environments. It has the possibility of simplifying the lives of many technical and sleep-deprived engineers. The current ansible-rulebook is easy to learn and work with, and the graphical user interface EDA-Server will simplify this further.</p>
<h3>What can you do next?</h3>
<p>Whether you are beginning your automation journey or a seasoned veteran, there are a variety of resources to enhance your automation knowledge:</p>
<ul>
<li>
<a href="https://www.redhat.com/en/engage/redhat-ansible-automation-202108061218">Self-paced lab exercises</a> - We have interactive, in-browser exercises to help you get started with Event-Driven Ansible and ansible-rulebook.</li>
<li>
<a href="https://youtu.be/PtevBKX1SYI">Event-Driven Rulebooks</a> - Watch another example of Event-Driven Ansible on our YouTube channel.</li>
<li>
<a href="https://youtu.be/Bb51DftLbPE">Event-Driven Ansible and Gitops</a> - Watch another example of Event-Driven Ansible, but with GitOps, on our YouTube channel.</li>
</ul>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="introducing-event-driven-ansible/" class="u-url">Introducing the Event-Driven Ansible developer preview</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/joe-pisciotta/">Joe Pisciotta</a>
              </span>
            </p>
            <p class="dateline">
              <a href="introducing-event-driven-ansible/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-19T00:00:00Z" itemprop="datePublished" title="2022-10-19 00:00">2022-10-19 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Introducing the Event-Driven Ansible developer preview</h2>
<p>Today at AnsibleFest 2022, Red Hat announced an exciting new developer
preview for Event-Driven Ansible. Most customers are on a journey toward
full end-to-end automation and there are many paths you take along this
journey.  Event-Driven Ansible is a new way to enhance and expand
automation. It improves IT speed and agility, while enabling consistency
and resilience. </p>
<p>By fully automating necessary but routine tasks, you and your team will
have more time to focus on interesting engineering challenges and new
innovations. For example, what if you no longer needed to pause critical
work to manually add technical detail to  a service ticket?  Or address
a user password reset request? Or reset a router as a first
troubleshooting step? With Event-Driven Ansible, the friction in your
day can be dramatically reduced, leaving more time to work on important
projects, with some added work-life balance.  </p>
<h3>Why a developer preview?</h3>
<p>The Event-Driven Ansible technology was developed by Red Hat and is
available on <a href="https://github.com/ansible/event-driven-ansible">GitHub</a>
as a developer preview. Community input is essential. Since we are
building a solution to best meet your needs, we're providing an
opportunity for you to advocate for those needs. We ask that both
technology providers and end users give it a try and tell us what you
think. There are several ways you can give feedback - via comments in
GitHub, during our <a href="https://www.redhat.com/en/events/webinar/event-driven-ansible-office-hours-november">office hours on November 16,
2022</a>,
or via the
<a href="mailto:event-driven-automation@redhat.com">event-driven-automation@redhat.com</a>
email. </p>
<h3>Event-driven automation is part of an ecosystem</h3>
<p>Any event-driven solution must be able to work within multi-vendor
environments. So, we ask technology partners to not only try the
Event-Driven Ansible developer preview, but also begin building Ansible
Content Collections so that our solutions complement each other and make
it faster and easier for joint customers to use them.</p>
<h3>Designed for simplicity</h3>
<p>Event-Driven Ansible is designed for simplicity and flexibility, much
like we offer today in Red Hat Ansible Automation Platform.  What do we
mean by this for Event-Driven Ansible? </p>
<p>Until now, most event driven and "self-healing" automation projects have
been complex and time-consuming to deliver because much of the solution
is custom developed to meet a singular need. For example, automatically
shut down network firewalls when certain activity patterns occur, then
notify responsible teams.  This is a great and essential solution--for
this one need. </p>
<p>Event-Driven Ansible is designed to be more flexible with faster and
more cost-effective ways to stand up new automation projects across any
use case.  By writing an Ansible Rulebook (similar to Ansible Playbooks,
but more oriented to "if-then"  scenarios) and allowing Event-Driven
Ansible to subscribe to an event listening source, your teams can more
quickly and easily automate a variety of tasks across the organization.</p>
<p>Think of it like a crescent wrench: a single tool that is easy to adjust
to different size bolts.  Same idea here - a single automation tool that
addresses a broad variety of IT automation needs. </p>
<h3>What is Event-Driven Ansible?</h3>
<p>Event-Driven Ansible is a highly scalable, flexible automation
capability that works with event sources such as other software
vendors'  monitoring tools. In an automatic remediation use case, these
vendor tools watch your IT solutions and identify "events," such as an
outage. Event-Driven Ansible documents your team's technical information
on how you want to act on the identified event (an outage in our
example) as rules in Ansible Rulebooks. When this event (outage) occurs,
Event-Driven Ansible  matches the rule to the "event" (the outage), and
automatically implements the documented changes or response in the
rulebook to handle the event. In our outage example, this may be an
action such as resetting or rebooting the non-responding asset.</p>
<p><img alt="EDA diagram" src="../images/posts/archive/eda-rulebooks.png"></p>
<p>There are three major building blocks in the Event-Driven Ansible model,
sources, rules and actions that play key roles in completing the
workflow described above:</p>
<ul>
<li>
<strong>Sources</strong> are third party vendor tools that provide the events.
    They define and identify where events occur, then pass them to
    Event-Driven Ansible.  Current source support includes Prometheus,
    Sensu, Red Hat solutions, webhooks and Kafka, as well as custom
    "bring your own" sources.</li>
<li>
<strong>Rules</strong> document your desired handling of the event via Ansible
    Rulebooks. They use familiar YAML-like structures and follow an "if
    this then that" model.  Ansible Rulebooks may call Ansible Playbooks
    or have direct module execution functions.</li>
<li>
<strong>Actions</strong> are the result of executing the Ansible Rulebook's
    instructions when the event occurs.</li>
</ul>
<h3>More about integrations</h3>
<p>Event-Driven Ansible allows you to subscribe to sources, listen for
events and then act on those events. Currently we have a number of
source plugins that have been created and can be used. </p>
<p>We are enabling events from partner technologies by providing event
source plugins for webhooks and for Kafka. Many partner tools can
utilize Kafka and webhooks for integration into the Event-Driven Ansible
ecosystem. Once Event-Driven Ansible receives events from these sources,
it can allocate rules against them from the instructions you have
specified in Ansible Rulebooks. Technology providers can also develop
event source plugins, which more directly integrate their tools with
Event-Driven Ansible and distribute them via Content Collections.</p>
<p>Open source plugins are also supported. These plugins enable
Event-Driven Ansible to process a number of different events. They
include: </p>
<ul>
<li>Kafka for event streams</li>
<li>webhooks</li>
<li>watchdog, a file system watcher</li>
<li>url_check to check the status of a url </li>
<li>Range, an event generation plugin</li>
<li>File, which loads facts from YAML</li>
<li>Roadmap integrations support processing from the cloud service
    providers</li>
</ul>
<p>In addition to all these integrations that enable events to prompt
action, it is important to note that Red Hat Ansible Automation Platform
does not require an agent to be present on a target solution receiving
an automated action.  This is convenient and ideal for technologies that
cannot host an agent, such as an edge device or network router--- and it
makes Event-Driven Ansible a simpler solution to
deploy.</p>
<h3>Starting small, thinking big: recommended use cases</h3>
<p>Red Hat often recommends a "start small, think big" approach to growing
your automation maturity and Even-Driven Ansible is no exception. We
think IT service management is a great place to start and we suggest you
look for simple tasks that get repeated very often to see the most
benefit.  </p>
<p>You can use Event-Driven Ansible Rulebooks to enhance service tickets,
do basic remediation of tickets and issues and also manage the variety
of end-user requests that you receive everyday, like password resets.  </p>
<p>Additionally, you can automate use cases across all of the common areas
where you automate today -- infrastructure, network, cloud, security,
and edge -- for service management and other tasks.  Once you get the
basics down, growing the number, scope and sophistication of your
Ansible Rulebooks is easy.</p>
<h3>Getting started and sharing feedback</h3>
<p>Start by reviewing this <a href="http://ansible.com/event-driven">web page</a> where you will
find more details on Event-Driven Ansible and can access additional
resources such as a self-paced lab, how-to-video and more details about
this solution. You will also find a registration link to our first
Office Hours event, where you can ask questions and learn tips and
techniques.  </p>
<p>Once you have some familiarity, use the developer preview code found
<a href="https://github.com/ansible/event-driven-ansible">here</a>. In summary,
your basic steps will be to download and install Event-Driven Ansible
from the GitHub repository, configure sources of events so Event-Driven
Ansible is subscribed, write your Ansible Rulebook(s) and start
listening to events.</p>
<p>As a community project, we ask for your feedback through GitHub
comments, on our Office Hours, or via email at
<a href="mailto:event-driven-automation@redhat.com">event-driven-automation@redhat.com</a>. </p>
<h3>Looking ahead for Event-Driven Ansible</h3>
<p>While this technology is a community project, we have bigger ideas to
shape this capability to meet your needs.  In addition, we hope to
integrate Event-Driven Ansible as a component in Red Hat Ansible
Automation Platform in the future. With Red Hat Ansible Automation
Platform, you could gain access to all the platform has to offer,
including RBAC and other controls, and the ability to use a single
automation platform even more flexibly for both manually-initiated
automation via Ansible Playbooks and also for your fully automated
actions via Ansible Rulebooks.   </p>
<p>I hope this has provided a good overview of Event-Driven Ansible.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-78/" class="u-url">Bullhorn #78</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-78/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-14T00:11:00Z" itemprop="datePublished" title="2022-10-14 00:11">2022-10-14 00:11</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #78, 2022-10-13 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-77/" class="u-url">Bullhorn #77</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-77/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-07T23:00:00Z" itemprop="datePublished" title="2022-10-07 23:00">2022-10-07 23:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #77, 2022-10-07 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="ansible-and-packer-why-they-are-better-together/" class="u-url">Using Ansible and Packer, From Provisioning to Orchestration</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/sean-cavanaugh/">Sean Cavanaugh</a>
              </span>
            </p>
            <p class="dateline">
              <a href="ansible-and-packer-why-they-are-better-together/" rel="bookmark">
                <time class="published dt-published" datetime="2022-10-03T00:00:00Z" itemprop="datePublished" title="2022-10-03 00:00">2022-10-03 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Using Ansible and Packer, From Provisioning to Orchestration</h2>
<p>Red Hat Ansible Automation Platform can help you orchestrate,
operationalize and govern your hybrid cloud deployments.  In my last
public cloud blog, I talked about "Two Simple Ways Automation Can Save
You Money on Your AWS Bill"
and similarly to Ashton's blog "Bringing Order to the Cloud: Day 2
Operations in AWS with Ansible",
we both wanted to look outside the common public cloud use-case of
provisioning and deprovisioning resources and instead look at automating
common operational tasks.  For this blog post I want to cover how the
Technical Marketing team for Ansible orchestrates a pipeline for demos
and workshops with Ansible and how we integrate that with custom AMIs
(Amazon Machine Images) created with <a href="https://www.packer.io/">Packer</a>. 
Packer is an open source tool that allows IT operators to standardize
and automate the process of building system images.</p>
<p>For some of our <a href="https://red.ht/ansible_labs">self-paced interactive hands-on labs on Ansible.com</a>, we can quickly spin up images
in seconds.  In an example automation pipeline we will:</p>
<ol>
<li>Provision a virtual instance.</li>
<li>Use Ansible Automation Platform to install an application; in my
    case, I am literally installing our product Ansible Automation
    Platform (is that too meta?).</li>
<li>After the application install, set up the lab guides, pre-load
    automation controller with some job templates, create inventory and
    credentials and even set up SSL certificates.  </li>
</ol>
<p>While this is fast, it might take a few minutes to load, and web users
are unlikely to be patient.  The Netflix era means that people want
instant gratification!  Installing automation controller might take five
to 10 minutes, so I need a faster method to deploy.</p>
<p><img alt="cloud automation pipeline diagram" src="../images/posts/archive/ansible-packer-blog-one.png"></p>
<p>What I can do is combine our normal Ansible automation pipeline with
Packer and pre-build the cloud instances so they already have the
application installed, and are configured and ready to go as soon as it
boots.  Packer will provision a specific machine image on my public
cloud (Azure, AWS, GCP), run the commands and changes I need, and then
publish a new image with all the changes I made to the base image.  In
my case I use Ansible the same way.  In my packer
<a href="https://www.packer.io/docs/templates/hcl_templates">HCL</a> (HashiCorp
Configuration Language ) file I have an Ansible provisioner:</p>
<div class="code"><pre class="code literal-block"><span class="w"> </span><span class="err">provisio</span><span class="kc">ner</span><span class="w"> </span><span class="s2">"ansible"</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="err">comma</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">"ansible-playbook"</span>
<span class="w">      </span><span class="err">playbook_</span><span class="kc">f</span><span class="err">ile</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">"pre_build_controller.yml"</span>
<span class="w">      </span><span class="err">user</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">"ec2-user"</span>
<span class="w">      </span><span class="err">i</span><span class="kc">n</span><span class="err">ve</span><span class="kc">nt</span><span class="err">ory_</span><span class="kc">f</span><span class="err">ile_</span><span class="kc">te</span><span class="err">mpla</span><span class="kc">te</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">"controller ansible_host={{ .Host }} ansible_user={{ .User }} ansible_port={{ .Port }}"</span>
<span class="w">      </span><span class="err">ex</span><span class="kc">tra</span><span class="err">_argume</span><span class="kc">nts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">local.ex</span><span class="kc">tra</span><span class="err">_args</span>

<span class="w">    </span><span class="p">}</span>
</pre></div>

<p>Red Hat Ansible Tech Marketing Example can be found on
<a href="https://github.com/ansible/workshops/blob/devel/provisioner/packer/automation-controller.pkr.hcl">Github</a></p>
<p>This simple provisioner plugin is executing the Ansible Playbook
pre_build_controller.yml.  I can also use Ansible Automation Platform to
orchestrate the whole process by kicking off Packer and then continuing
on.  Anything that I can do ahead of time, I can pre-build into the
image.  This means there is less automation I need to do at boot time
(or what is sometimes referred to as "automation just in time").  The
new process looks like this diagram:</p>
<p><img alt="create pre-built image diagram" src="../images/posts/archive/ansible-packer-blog-two.png"></p>
<p>These two processes, building images and serving a demo environment, are
actually independent of each other.  Depending on how often a pre-built
image needs to be executed, we can schedule that in automation
controller, or even generate them on-demand via
<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/webhooks.html">webhooks</a>.
On-demand generation means as soon as someone changes an Ansible
Playbook relevant to anything pre_build, we can have Ansible Automation
Platform create the new image immediately, and even test it!</p>
<h2>Sharing and copying cloud instances</h2>
<p>Once we create a pre_built AMI, we need to make sure we can use it in
multiple regions, and on other accounts. With public marketplace
instances you can use cool automation tricks like using the
<a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/ec2_ami_info_module.html">ec2_ami_info module</a> for dynamic lookups,
but we have now essentially created private AMIs we can copy to other
regions, or share to other AWS accounts so they have access to these
pre_built images.  To solve this problem we can use automation, and I
have created an Ansible Content Collection for
<a href="https://galaxy.ansible.com/ansible_cloud/share_ami">ansible_cloud.share_ami</a>.  </p>
<p>This Collection currently has two roles available that will assist cloud
administrators, copy and share.</p>
<h3>Copy</h3>
<p>This role will copy an AMI from one region, to any other specified
regions.  This means you can use Packer to create it just once, and have
Ansible take care of copying it to any other regions and return you with
a list of new AMIs per region.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">copy</span><span class="w"> </span><span class="n">ami</span>
<span class="w">    </span><span class="n">include_role</span><span class="p">:</span>
<span class="w">      </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">ansible_cloud</span><span class="o">.</span><span class="n">share_ami</span><span class="o">.</span><span class="n">copy</span>
<span class="w">    </span><span class="n">vars</span><span class="p">:</span>
<span class="w">      </span><span class="n">ami_list</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ my_ami_list }}"</span>
<span class="w">      </span><span class="n">copy_to_regions</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ my_copy_to_regions }}"</span>
</pre></div>

<p>Where your variable file looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">my_ami_list</span><span class="o">:</span>
<span class="w">  </span><span class="n">ap</span><span class="o">-</span><span class="n">northeast</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">01334</span><span class="n">example</span>
<span class="w">  </span><span class="n">ap</span><span class="o">-</span><span class="n">southeast</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">0</span><span class="n">b3f3example</span>
<span class="w">  </span><span class="n">eu</span><span class="o">-</span><span class="n">central</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">03</span><span class="n">a5732example</span>
<span class="w">  </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">01</span><span class="n">da94de9cexample</span>
<span class="n">my_copy_to_regions</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span>
</pre></div>

<p>In this case, there will be four AMIs copied to us-west-1 and us-east-2
with a new AMI identifier returned to your terminal window or the
automation controller console.</p>
<h3>Share</h3>
<p>This role will share an AMI
from one account and region to another account (in the same region). 
This allows you to share your pre_built AMIs to as many accounts as you
want really quickly.</p>
<div class="code"><pre class="code literal-block"><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">share</span><span class="w"> </span><span class="n">ami</span>
<span class="w">  </span><span class="n">include_role</span><span class="p">:</span>
<span class="w">    </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">ansible_cloud</span><span class="o">.</span><span class="n">share_ami</span><span class="o">.</span><span class="n">share</span>
<span class="w">  </span><span class="n">vars</span><span class="p">:</span>
<span class="w">    </span><span class="n">user_id_list</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ account_list }}"</span>
<span class="w">    </span><span class="n">ami_list</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ my_ami_list }}"</span>
</pre></div>

<p>Where your variable file looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="n">my_ami_list</span><span class="o">:</span>
<span class="w">  </span><span class="n">ap</span><span class="o">-</span><span class="n">northeast</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">01334</span><span class="n">example</span>
<span class="w">  </span><span class="n">ap</span><span class="o">-</span><span class="n">southeast</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">0</span><span class="n">b3f3example</span>
<span class="w">  </span><span class="n">eu</span><span class="o">-</span><span class="n">central</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">03</span><span class="n">a5732example</span>
<span class="w">  </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">01</span><span class="n">da94de9cexample</span>
<span class="w">  </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">ami</span><span class="o">-</span><span class="mi">009</span><span class="n">f8b2c6dexample</span>
<span class="n">account_list</span><span class="o">:</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="s2">"11463example"</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="s2">"90073example"</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="s2">"71963example"</span>
<span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="s2">"07923example"</span>
</pre></div>

<p>This would share these five AMIs to the four accounts listed.  There are
also two optional variables for share AMI, new_ami_name and new_tag
which will name (e.g. add the tag name: "whatever you put") and add a
hard coded ansiblecloud tag (e.g. add the tag ansiblecloud: "whatever
you put").  This could be further customized to add as many tags as you
want to your AMIs to help keep track of them.</p>
<div class="code"><pre class="code literal-block">new_ami_name: "RHEL 8.6 with automation controller"
new_tag: "my test"
</pre></div>

<p>Now you can see one of the many ways that Ansible Automation Platform
and Packer can easily and seamlessly work together to accomplish cloud
automation tasks.  If you want more blogs on Ansible and Packer or
Ansible and Terraform, please let us know!</p>
          </div>
      </article><br><hr>
<br>
</div>
          <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-20.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-18.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/popper.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
