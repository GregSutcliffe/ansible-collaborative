<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Ansible Collaborative Website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ansible Collaborative (old posts, page 7) | Ansible Collaborative</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/index-7.html">
<link rel="prev" href="index-8.html" type="text/html">
<link rel="next" href="index-6.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../">
        <img src="../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
    
  <div class="postindex ansible-content">
      <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="customer-spotlights-at-ansiblefest-2020/" class="u-url">Customer Spotlights at AnsibleFest 2020</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/elle-universal/">Elle Universal</a>
              </span>
            </p>
            <p class="dateline">
              <a href="customer-spotlights-at-ansiblefest-2020/" rel="bookmark">
                <time class="published dt-published" datetime="2020-09-30T00:00:00Z" itemprop="datePublished" title="2020-09-30 00:00">2020-09-30 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Customer Spotlights at AnsibleFest 2020</h2>
<p>AnsibleFest 2020 will be here before we know it, and we cannot wait to
connect with everyone in October. We have some great content lined up
for this year's virtual experience and that includes some amazing
customer spotlights. This year you will get to hear from CarMax, Blue
Cross Blue Shield of NC, T-Mobile, and Cepsa. These customers are using
Ansible in a variety of ways, and we hope you connect to their
incredible stories of teamwork and transformative automation.</p>
<p><strong>Customer Spotlights</strong></p>
<p>Benjamin Blizard, a Network Engineer at T-Mobile, will explore how
T-Mobile transformed from a disparate organization with difficulty
enforcing standards to a collaborative group of engineers working from
repeatable templates and processes. T-Mobile, a major telecommunications
provider, uses Ansible Automation Platform to standardize processes
across their organization. Ben will show how automation supports
T-Mobile's compliance standards, data integrity, and produces speed and
efficiency for network teams. </p>
<p>Peter Bojovic, Director of Systems Engineering at Blue Cross Blue Shield
of North Carolina, will talk about how they used automation to drive
down costs in managed service costs while increasing productivity. Blue
Cross NC, a leading health insurance provider, recently implemented a
new tool to automate provisioning of their virtual machines for critical
on-premise applications.</p>
<p>Members of Blue Cross NC's deployment team will also speak on a panel
interview setup, featuring: Tobin Shay, Alex Devirgilis and Pavan
Mutyala. They will discuss their recent experiences using automation to
handle a large-scale migration and the future of automation at Blue
Cross NC. The interview will also touch on how a large organization
works to decrease a reliance on managed services, and the planning and
processes that lead to a projected 16-week project being completed in
just three business days.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="introducing-the-vmware-rest-ansible-content-collection/" class="u-url">Introducing the VMware REST Ansible Content Collection</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/goneri-le-bouder/">Gonéri Le Bouder</a>
              </span>
            </p>
            <p class="dateline">
              <a href="introducing-the-vmware-rest-ansible-content-collection/" rel="bookmark">
                <time class="published dt-published" datetime="2020-09-29T00:00:00Z" itemprop="datePublished" title="2020-09-29 00:00">2020-09-29 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Introducing the VMware REST Ansible Content Collection</h2>
<p>The VMware Ansible modules as part of the current <a href="https://galaxy.ansible.com/community/vmware">community.vmware Collection</a>
are extremely popular. According to GitHub, it's the second most forked Collection, just after
<a href="https://galaxy.ansible.com/community/general">community.general</a>.
The VMware modules and plugins for Ansible have benefited from a stream
of contributions from dozens of users. Many IT infrastructure engineers
rely on managing their VMware infrastructure by means of a simple
Ansible Playbook. The vast majority of the current VMware modules are
built on top of a dependent python library called
<a href="https://github.com/vmware/pyvmomi">pyVmomi</a>,
also known as vSphere Automation SDK for Python.</p>
<h3>Why a new VMware Ansible Content Collection?</h3>
<p>VMware has recently introduced the vSphere REST API for vSphere 6.0 and
later, which will likely replace the existing SOAP SDK used in the
<a href="https://galaxy.ansible.com/community/vmware">community.vmware</a>
Collection.</p>
<p>Since the REST API's initial release, vSphere support for the REST API
has only improved. Furthermore, there is no longer a need for any
dependent python packages. In order to maintain the existing VMware
modules in the
<a href="https://galaxy.ansible.com/community/vmware">community.vmware</a>
Collection, a set of modules specifically for interacting with the
VMware REST API is now available in the newly created
<a href="https://galaxy.ansible.com/vmware/vmware_rest">vmware.vmware_rest</a>
Collection.</p>
<p>If you compare modules used with the VMware vSphere API (SOAP) to the
ones using the REST API, you'll notice the REST API modules are not yet
feature complete, as this is an early release of the Collection. For
example, there currently is no way to create a cluster or a folder using
the modules in the
<a href="https://galaxy.ansible.com/vmware/vmware_rest" rel="noopener">vmware.vmware_rest</a>
Collection, but the API provides all you need for a VMware guest for
future Collection enablement and much more.</p>
<h3>Using the VMware REST API</h3>
<p>In order to understand how the new modules function against the new REST API, let's take a look at the REST API itself first.
For example, the <code>com.vmware.vcenter.vm.power</code> API endpoint changes the power state of a VM.
It's equivalent to the following sample URL:</p>
<div class="code"><pre class="code literal-block">https://vcenter.test/rest/vcenter/vm/<span class="se">\$</span>vm/power
</pre></div>

<p>With the vCenter 7.0 release, 723 total REST endpoints are exposed,
which can be discovered using the following <code>curl</code> command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>curl<span class="w"> </span>-k<span class="w"> </span>https://vcenter.test/rest/com/vmware/vapi/metadata/cli/command<span class="p">|</span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s2">".[][].path"</span><span class="p">|</span>uniq<span class="p">|</span>wc<span class="w"> </span>-l
<span class="m">723</span>
</pre></div>

<p>The VMware REST APIs are documented in the Swagger 2.0 format. You can
find the JSON files on your vCenter node in the following directory
path:</p>
<div class="code"><pre class="code literal-block">root@vcenter<span class="w"> </span><span class="o">[</span><span class="w"> </span>/etc/vmware-vapi/apiexplorer/json<span class="w"> </span><span class="o">]</span><span class="c1"># ls -lh</span>
total<span class="w"> </span><span class="m">3</span>.3M
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w">  </span><span class="m">145</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>api.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>396K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>appliance.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>153K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>cis.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>272K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>content.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>395K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>esx.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>153K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>stats.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span>176K<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:37<span class="w"> </span>vapi.json
-rw-r--r--<span class="w"> </span><span class="m">1</span><span class="w"> </span>vapiEndpoint<span class="w"> </span>users<span class="w"> </span><span class="m">1</span>.8M<span class="w"> </span>Aug<span class="w"> </span><span class="m">31</span><span class="w"> </span><span class="m">15</span>:36<span class="w"> </span>vcenter.json
</pre></div>

<p>To summarize, the
<a href="https://galaxy.ansible.com/vmware/vmware_rest">vmware.vmware_rest</a>
Collection has all these REST endpoints ready to be consumed with the
descriptions in a well documented format.</p>
<h3>Building the vmware_rest Collection</h3>
<p>The modules contained in this Collection are generated using a tool
called 
<a href="https://github.com/ansible-collections/vmware_rest_code_generator">vmware_rest_code_generator</a>,
which was developed and open sourced by the Ansible team. It loads the
Swagger files and then auto-generates a module per each resource,
generating more than 300 modules this way. You'll notice that not every
module has been released to the Collection. For purposes of starting
small, we are only generating modules against a subset of the endpoints
exposed, only those associated with guest management use cases. We may
expand and extend the number of modules over time.</p>
<h3>Using the vmware_rest Collection</h3>
<p>The following tasks retrieve a list of the VM, shuts them down, and then deletes them:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Collect the list of the existing VM</span>
<span class="w">  </span><span class="nt">vcenter_vm_info</span><span class="p">:</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">existing_vms</span>
<span class="w">  </span><span class="nt">until</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">existing_vms is not failed</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Turn off the VM</span>
<span class="w">  </span><span class="nt">vcenter_vm_power</span><span class="p">:</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stop</span>
<span class="w">    </span><span class="nt">vm</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">item.vm</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">existing_vms.value</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">  </span><span class="nt">ignore_errors</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete some VM</span>
<span class="w">  </span><span class="nt">vcenter_vm</span><span class="p">:</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="w">    </span><span class="nt">vm</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">item.vm</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">with_items</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">existing_vms.value</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Refer to the following gist file for more information:
<a href="https://gist.github.com/goneri/6afd05397390cf5a0976f3611814949a">https://gist.github.com/goneri/6afd05397390cf5a0976f3611814949a</a></p>
<h3>Downloading the vmware_rest Collection</h3>
<p>The goal of this early release is to get as much community feedback as
possible.</p>
<p>The Collection is available on Ansible Galaxy, and requires the
following:</p>
<ul>
<li>Ansible 2.9 or later </li>
<li>Python 3.6 or later</li>
<li>The <code>aiohttp</code> package</li>
</ul>
<p>Use the <code>ansible-galaxy</code> command to retrieve the Collection:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ansible-galaxy collection install vmware.vmware_rest</span>
</pre></div>

<p>If you use a virtualenv, you can install <code>aiohttp</code> with following command:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># pip install aiohttp</span>
</pre></div>

<p>Else, you will need to download and install the <code>python3-aiohttp</code> package.</p>
<p>To read the module documentation, use the <code>ansible-doc</code> command.
For example, to read documentation for the <code>vcenter_cluster_info</code> module, refer to the following command:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># ansible-doc -t module vmware.vmware_rest.vcenter_cluster_info</span>
</pre></div>

<h3>vCenter-Managed Object Reference ID</h3>
<p>If you are already using the community.vmware Collection, the main
difference is that the newer modules rely on the MORef ID to identify
the elements instead of the name of the object. For example, if the user
creates a datacenter called dc1, the MORef ID using the new modules will
be datacenter-2. The community.vmware Collection uses the name and the
folder instead.</p>
<p>By using the MORef ID directly, the module is able to interact with the
resource without any time consuming preliminary look up.</p>
<h3>How can I contribute?</h3>
<p>Because the modules are auto-generated, it GitHub pull requests should
be raised against the <a href="https://github.com/ansible-collections/vmware_rest_code_generator">code generator</a>
itself, and not the resulting Collection contents.</p>
<p>Don't hesitate to report any issues on the GitHub project at
<a href="https://github.com/ansible-collections/vmware_rest/issues">https://github.com/ansible-collections/vmware_rest/issues</a>.</p>
<p>Reference:</p>
<p>The forks per collection can be found programmatically by accessing the Github API:
<a href="https://api.github.com/orgs/ansible-collections/repos">https://api.github.com/orgs/ansible-collections/repos</a> </p>
<p>This can be sorted, for example:</p>
<div class="code"><pre class="code literal-block">method:<span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>https://api.github.com/orgs/ansible-collections/repos<span class="p">|</span>jq<span class="w"> </span>-r<span class="w"> </span>-c<span class="w"> </span>--sort-keys<span class="w"> </span><span class="s1">'.|sort_by(.forks)|reverse|.[]|[.name, .forks]'</span>
</pre></div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="developing-and-testing-ansible-roles-with-molecule-and-podman-part-2/" class="u-url">Developing and Testing Ansible Roles with Molecule and Podman - Part 2</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ricardo-gerardi/">Ricardo Gerardi</a>
              </span>
            </p>
            <p class="dateline">
              <a href="developing-and-testing-ansible-roles-with-molecule-and-podman-part-2/" rel="bookmark">
                <time class="published dt-published" datetime="2020-09-17T00:00:00Z" itemprop="datePublished" title="2020-09-17 00:00">2020-09-17 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Developing and Testing Ansible Roles with Molecule and Podman - Part 2</h2>
<p>Molecule is a complete testing framework that helps you develop and test
Ansible roles, which allows you to focus on role content instead of
focusing on managing testing infrastructure. In the first
part of this series, we've successfully installed, configured and used
Molecule to set up new testing instances.</p>
<p>Now that the instances are running, let's start developing the new role
and apply Molecule to ensure it runs according to the specifications.</p>
<p>This basic role deploys a web application supported by the Apache web
server. It must support Red Hat Enterprise Linux (RHEL) 8 and Ubuntu
20.04.</p>
<h3>Developing the Ansible Role with Molecule</h3>
<p>Molecule helps in the development stage by allowing you to "converge"
the instances with the role content. You can test each step without
worrying about managing the instances and test environment. It provides
quick feedback, allowing you to focus on the role content, ensuring it
works in all platforms.</p>
<p>In the first part of this series, we initialized a new role "mywebapp". If you're not
there yet, switch to the role directory "mywebapp" and add the first
task, installing the Apache package "httpd" using the "package" Ansible
module. Edit the file "tasks/main.yaml" and include this task:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi tasks/main.yml</span>
<span class="nn">---</span>
<span class="c1"># tasks file for mywebapp</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure httpd installed</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"httpd"</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>

<p>Save the file and "converge" the instances by running "molecule
converge". The "converge" command applies the current version of the
role to all the running container instances. Molecule "converge" does
not restart the instances if they are already running. It tries to
converge those instances by making their configuration match the desired
state described by the role currently testing.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>converge
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>mywebapp<span class="w"> </span>:<span class="w"> </span>Ensure<span class="w"> </span>httpd<span class="w"> </span>installed<span class="o">]</span><span class="w"> </span>***************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">08</span>:45:01<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.060<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:04.277<span class="w"> </span>*********
fatal:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span>:<span class="w"> </span>FAILED!<span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span><span class="s2">"changed"</span>:<span class="w"> </span>false,<span class="w"> </span><span class="s2">"msg"</span>:<span class="w"> </span><span class="s2">"No package matching 'httpd' is available"</span><span class="o">}</span>
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
</pre></div>

<p>Notice that the current version worked well on the RHEL8 instance, but
failed for the Ubuntu instance. By using Molecule, you can quickly
evaluate the result of your tasks in all platforms and verify if the
role works according to the requirements! In this example however, the
tasks failed because Ubuntu does not have a package named "httpd". For
that platform, the package name is "apache2".</p>
<p>So let's modify the role to include variables with the correct package
name for each platform. Start with RHEL8 by adding a file "RedHat.yaml"
under the "vars" sub-directory with this content:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/RedHat.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</pre></div>

<p>Save this file and add the corresponding file "vars/Debian.yaml" for
Ubuntu:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/Debian.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</pre></div>

<p>Save this file and modify the "tasks/main.yaml" file to include these
variable files according to the OS family identified by Ansible via the
<a href="https://docs.ansible.com/ansible/devel/user_guide/playbooks_vars_facts.html">system fact variable</a>
"ansible_os_family". We also have to include a task to update the
package cache for systems in the "Debian" family since their package
manager caches results otherwise. Last, we update the install task to
use the variable "httpd_package" that you defined in the variables
files:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi tasks/main.yml</span>
<span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include OS-specific variables.</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">include_vars</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ansible_os_family</span><span class="nv"> </span><span class="s">}}.yaml"</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure package cache up-to-date</span>
<span class="w">  </span><span class="nt">apt</span><span class="p">:</span>
<span class="w">    </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">cache_valid_time</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3600</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == "Debian"</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure httpd installed</span>
<span class="w">  </span><span class="nt">package</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">httpd_package</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</pre></div>

<p>Save this file, and "converge" the instances again to ensure it works
this time:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>converge
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>mywebapp<span class="w"> </span>:<span class="w"> </span>Ensure<span class="w"> </span>httpd<span class="w"> </span>installed<span class="o">]</span><span class="w"> </span>***************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">08</span>:59:13<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:07.338<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:12.925<span class="w"> </span>*********
<span class="w">    </span>ok:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span>
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
</pre></div>

<p>Because the package was already installed in the RHEL8 instance, Ansible
returned the status "OK" and it did not make any changes. It installed
the package correctly in the Ubuntu instance this time.</p>
<p>We have installed the package - but the naming problem also exists with
the service itself: they are named differently in RHEL and Ubuntu. So we
add service name variables to the playbooks and variable files. Start
with RHEL8:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/RedHat.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="nt">httpd_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
</pre></div>

<p>Save this file and then edit the file "vars/Debian.yaml" for Ubuntu:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/Debian.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
<span class="nt">httpd_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
</pre></div>

<p>Save the file and add the new task at the end of the "tasks/main.yml"
file:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi tasks/main.yml</span>
<span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure httpd svc started</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">httpd_service</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>

<p>Save the file and "converge" the instances again to start the Apache
httpd service:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>converge
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>mywebapp<span class="w"> </span>:<span class="w"> </span>Ensure<span class="w"> </span>httpd<span class="w"> </span>svc<span class="w"> </span>started<span class="o">]</span><span class="w"> </span>*************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">09</span>:34:38<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:06.776<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:17.233<span class="w"> </span>*********
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span>
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
</pre></div>

<p>Let's add a final task to create some content for the web application.
Each platform requires the HTML files owned by different groups. Add new
variables to each variable file to define the group name:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/RedHat.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="nt">httpd_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="nt">httpd_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache</span>
</pre></div>

<p>Save this file then edit the file "vars/Debian.yaml" for Ubuntu:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi vars/Debian.yaml</span>
<span class="nn">---</span>
<span class="nt">httpd_package</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
<span class="nt">httpd_service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apache2</span>
<span class="nt">httpd_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">www-data</span>
</pre></div>

<p>Save the file and add the new task at the end of the "tasks/main.yml"
file:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi tasks/main.yml</span>
<span class="l l-Scalar l-Scalar-Plain">- name</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure HTML Index</span>
<span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">copy</span><span class="p p-Indicator">:</span>
<span class="w">    </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/index.html</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0644</span>
<span class="w">    </span><span class="nt">owner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">root</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">httpd_group</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">web_content</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>This task allows the role user to specify the content by using the
variable "web_content" when calling the role. Add a default value to
this variable in case the user does not specify it:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi defaults/main.yml</span>
<span class="nn">---</span>
<span class="c1"># defaults file for mywebapp</span>
<span class="nt">web_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">There's a web server here</span>
</pre></div>

<p>Save this file and "converge" the instances one more time to add the
content:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>converge
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>mywebapp<span class="w"> </span>:<span class="w"> </span>Ensure<span class="w"> </span>HTML<span class="w"> </span>Index<span class="o">]</span><span class="w"> </span>********************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">09</span>:50:11<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:03.261<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:17.753<span class="w"> </span>*********
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span>
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
</pre></div>

<p>At this time, both instances are converged. Manually verify that the
role worked by using the molecule login command to log into one of the
instances and running the "curl" command to get the content:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>login<span class="w"> </span>-h<span class="w"> </span>rhel8
<span class="o">[</span>root@2ce0a0ea8692<span class="w"> </span>/<span class="o">]</span><span class="c1"># curl http://localhost</span>
There<span class="err">'</span>s<span class="w"> </span>a<span class="w"> </span>web<span class="w"> </span>server<span class="w"> </span>here
<span class="o">[</span>root@2ce0a0ea8692<span class="w"> </span>/<span class="o">]</span><span class="c1"># exit</span>
</pre></div>

<p>You used Molecule to aid with the role development by ensuring that it
is working properly across multiple platforms for each step of the way.</p>
<p>Next, let's automate the verification process.</p>
<h3>Verifying the Role with Molecule</h3>
<p>In addition to helping you converge the instance to aid with the role
development, Molecule can also automate the testing process by executing
a verification task. To verify the results of your playbook, Molecule
can use either the "testinfra" framework or it can use Ansible itself. </p>
<p>Let's use an Ansible Playbook to verify the results of this new role. By
default, Molecule provides a basic verifier playbook
"molecule/default/verify.yml" as a starting point. This playbook
contains the basic required structure but does not do any useful
verification. Update this playbook to test this role result by using the
Ansible's "uri" module to obtain the content from the running web server
and the "assert" module to ensure it's the correct content:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi molecule/default/verify.yml</span>
<span class="nn">---</span>
<span class="c1"># This is an example playbook to execute Ansible tests.</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">expected_content</span><span class="p">:</span><span class="w"> </span><span class="s">"There's</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">server</span><span class="nv"> </span><span class="s">here"</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Get index.html</span>
<span class="w">    </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://localhost</span>
<span class="w">      </span><span class="nt">return_content</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this</span>
<span class="w">    </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="s">"expected_content</span><span class="nv"> </span><span class="s">not</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">this.content"</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure content type is text/html</span>
<span class="w">    </span><span class="nt">assert</span><span class="p">:</span>
<span class="w">      </span><span class="nt">that</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"'text/html'</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">this.content_type"</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Debug results</span>
<span class="w">    </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">      </span><span class="nt">var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">this.content</span>
</pre></div>

<p>Save and close this file. Verify the results by running "molecule
verify":</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>verify
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>Ensure<span class="w"> </span>content<span class="w"> </span><span class="nb">type</span><span class="w"> </span>is<span class="w"> </span>text/html<span class="o">]</span><span class="w"> </span>****************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">10</span>:03:18<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:03.131<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:07.255<span class="w"> </span>*********
<span class="w">    </span>ok:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">"changed"</span>:<span class="w"> </span>false,
<span class="w">        </span><span class="s2">"msg"</span>:<span class="w"> </span><span class="s2">"All assertions passed"</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span>ok:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">"changed"</span>:<span class="w"> </span>false,
<span class="w">        </span><span class="s2">"msg"</span>:<span class="w"> </span><span class="s2">"All assertions passed"</span>
<span class="w">    </span><span class="o">}</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
Verifier<span class="w"> </span>completed<span class="w"> </span>successfully.
</pre></div>

<p>Molecule runs the verifier playbook against all instances ensuring the
results match the expected values.</p>
<p>You can change the default values for the test by editing the converge
playbook to update the "web_content" variable:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi molecule/default/converge.yml</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Converge</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"Include</span><span class="nv"> </span><span class="s">mywebapp"</span>
<span class="w">      </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"mywebapp"</span>
<span class="w">      </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">         </span><span class="nt">web_content</span><span class="p">:</span><span class="w"> </span><span class="s">"New</span><span class="nv"> </span><span class="s">content</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">testing</span><span class="nv"> </span><span class="s">only"</span>
</pre></div>

<p>Then, update the "expected_content" variable in the verifier playbook:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi molecule/default/verify.yml</span>
<span class="nn">---</span>
<span class="c1"># This is an example playbook to execute Ansible tests.</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Verify</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">all</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">expected_content</span><span class="p">:</span><span class="w"> </span><span class="s">"New</span><span class="nv"> </span><span class="s">content</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">testing</span><span class="nv"> </span><span class="s">only"</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
</pre></div>

<p>Converge the instances one more time to update the web server content,
then verify the results:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>converge
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>mywebapp<span class="w"> </span>:<span class="w"> </span>Ensure<span class="w"> </span>HTML<span class="w"> </span>Index<span class="o">]</span><span class="w"> </span>********************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">10</span>:09:34<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:03.331<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:19.607<span class="w"> </span>*********
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span>
<span class="w">    </span>changed:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
$<span class="w"> </span>molecule<span class="w"> </span>verify
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
<span class="w">   </span>TASK<span class="w"> </span><span class="o">[</span>Debug<span class="w"> </span>results<span class="o">]</span><span class="w"> </span>***********************************************************
<span class="w">    </span>Saturday<span class="w"> </span><span class="m">27</span><span class="w"> </span>June<span class="w"> </span><span class="m">2020</span><span class="w">  </span><span class="m">10</span>:10:15<span class="w"> </span>-0400<span class="w"> </span><span class="o">(</span><span class="m">0</span>:00:00.299<span class="o">)</span><span class="w">       </span><span class="m">0</span>:00:10.142<span class="w"> </span>*********
<span class="w">    </span>ok:<span class="w"> </span><span class="o">[</span>rhel8<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">"this.content"</span>:<span class="w"> </span><span class="s2">"New content for testing only"</span>
<span class="w">    </span><span class="o">}</span>
<span class="w">    </span>ok:<span class="w"> </span><span class="o">[</span>ubuntu<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="s2">"this.content"</span>:<span class="w"> </span><span class="s2">"New content for testing only"</span>
<span class="w">    </span><span class="o">}</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
Verifier<span class="w"> </span>completed<span class="w"> </span>successfully.
</pre></div>

<p>Using the verifier, you can define a playbook to execute checks and
ensure the role produces the required results.</p>
<p>In the final step, let's put it all together with automated tests.</p>
<h3>Automating the Complete Test Workflow</h3>
<p>Now that all of the pieces are together, automate the complete testing
process workflow using the command "molecule test".</p>
<p>Unlike the "molecule converge", which aided with role development, the
goal with "molecule test" is to provide an automated and repeatable
environment to ensure the role works according to its specifications.
Therefore, the test process destroys and re-creates the instances for
every test.</p>
<p>By default, "molecule test" executes these steps in order:</p>
<ol>
<li>Install required dependencies</li>
<li>Lint the project</li>
<li>Destroy existing instances</li>
<li>Run a syntax check</li>
<li>Create instances</li>
<li>Prepare instances (if required)</li>
<li>Converge instances by applying the role tasks</li>
<li>Check the role for idempotence</li>
<li>Verify the results using the defined verifier</li>
<li>Destroy the instances</li>
</ol>
<p>You can change these steps by adding the "test_sequence" dictionary with
the required steps to the Molecule configuration file. For additional
information, consult the official
<a href="https://molecule.readthedocs.io/en/latest/configuration.html#scenario">documentation</a>.</p>
<p>Execute the test scenario:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span><span class="nb">test</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
--&gt;<span class="w"> </span>Test<span class="w"> </span>matrix

└──<span class="w"> </span>default
<span class="w">    </span>├──<span class="w"> </span>dependency
<span class="w">    </span>├──<span class="w"> </span>lint
<span class="w">    </span>├──<span class="w"> </span>cleanup
<span class="w">    </span>├──<span class="w"> </span>destroy
<span class="w">    </span>├──<span class="w"> </span>syntax
<span class="w">    </span>├──<span class="w"> </span>create
<span class="w">    </span>├──<span class="w"> </span>prepare
<span class="w">    </span>├──<span class="w"> </span>converge
<span class="w">    </span>├──<span class="w"> </span>idempotence
<span class="w">    </span>├──<span class="w"> </span>side_effect
<span class="w">    </span>├──<span class="w"> </span>verify
<span class="w">    </span>├──<span class="w"> </span>cleanup
<span class="w">    </span>└──<span class="w"> </span>destroy

--&gt;<span class="w"> </span>Scenario:<span class="w"> </span><span class="s1">'default'</span>
...<span class="w"> </span>TRUNCATED<span class="w"> </span>OUTPUT<span class="w"> </span>...
</pre></div>

<p>If the test workflow fails at any point, the command returns a status
code different than zero. You can use that return code to automate the
process or integrate Molecule with CI/CD workflows.</p>
<h3>Conclusion</h3>
<p>Now that you've successfully applied Molecule to develop and test a role
that is well written and works reliably across different environments,
you can integrate it into your development cycle to produce high
standard roles consistently without worrying about the testing
infrastructure.</p>
<p>Molecule helps during the role development process by providing constant
feedback, which ensures your role works as designed each step of the
way.</p>
<p>For more advanced scenarios, Molecule supports additional drivers that
allow you to test roles with different platforms, virtualization and
cloud providers.</p>
<p>Finally, you can integrate Molecule with CI/CD workflows to automate the
complete testing process for your Ansible roles.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-10/" class="u-url">Bullhorn #10</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-10/" rel="bookmark">
                <time class="published dt-published" datetime="2020-09-16T15:00:00Z" itemprop="datePublished" title="2020-09-16 15:00">2020-09-16 15:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<tr>
<td class="mcnTextContent" style='padding: 0px 18px 9px;font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;color: #202020;font-size: 16px;line-height: 150%;text-align: left;' valign="top">

                            <h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">The Bullhorn</h2>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'><em>A Newsletter for the Ansible Developer Community<br>
Issue #10, 2020-09-16</em><br><br>
Welcome to <em>The Bullhorn</em>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, please reach out to us at the-bullhorn@redhat.com, or comment on this <a href="https://github.com/ansible/community/issues/546" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">GitHub issue</a>.<br>
 </p>

<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">KEY DATES</h3>

<ul dir="ltr">
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">2020-09-15: ansible-2.10.0 rc1 (moved from 10-Sep)</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">2020-09-17: <a href="https://github.com/ansible/community/issues/539" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">community IRC meeting</a> (any blockers for release should be proposed and discussed here)</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">2020-09-22: ansible-2.10 GA release date</li>
</ul>
 

<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE 2.10.0 RC1 NOW AVAILABLE</h3>
The Ansible Community team announced the availability of Ansible 2.10.0 release candidate 1 on September 15th. This new Ansible package should be a drop-in replacement for Ansible 2.9; the roles and playbooks that you currently use should work out of the box with ansible-2.10.0 rc1. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/#!topic/ansible-devel/hgXx7CEugt0" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Toshio Kuratomi’s announcement to the ansible-devel mailing list</a>.<br><br>
The ansible-2.10.0 prereleases continue to be updated for testing purposes. <a href="https://groups.google.com/forum/#!topic/ansible-devel/93ymbTaUwl4" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible 2.10.0 beta 2</a> was uploaded to pypi last week, and Ansible 2.10.0 rc1 is now available on pypi as mentioned above.<br><br>
For more release details, please take a look at:
<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://github.com/ansible/ansible/blob/devel/docs/docsite/rst/roadmap/COLLECTIONS_2_10.rst" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible 2.10 release schedule</a></li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://groups.google.com/forum/#!topic/ansible-devel/618bSHJ7K64" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Changes to the ansible-2.10.0 pre-release schedule</a></li>
</ul>
 

<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE-BASE 2.10.1 NOW GENERALLY AVAILABLE</h3>
The Ansible Base team announced the general release of Ansible 2.10.1 on September 14th. This ansible-base package consists of only the Ansible execution engine, related tools (e.g. ansible-galaxy, ansible-test), and a very small set of built-in plugins, and is also bundled with the larger Ansible distribution. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/#!topic/ansible-devel/rnkhV2gHZPo" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Rick Elrod’s announcement to the ansible-devel mailing list</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ROLE/COLLECTION PUBLISHERS: CHANGES TO ANSIBLE-GALAXY LOGIN</h3>
If you use the <span style="font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif"><span style="background-color:#D3D3D3">ansible-galaxy</span></span> CLI to publish roles or collections to Galaxy, you may care about this. The GitHub API that underlies the <span style="font-family:source sans pro,helvetica neue,helvetica,arial,sans-serif"><span style="background-color:#D3D3D3">ansible-galaxy login</span></span> command is being removed in November. Without it, users doing role or collection publishing operations via the Galaxy CLI will need to find their Galaxy token interactively in a browser and pass it using a config file (as the ability to generate a token from the CLI will no longer function). We're not sure what people do today or how much this option is used out in the world, so please read and weigh in <a href="https://github.com/ansible/ansible/pull/71628" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a> in the next few days if you have an opinion.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">NEW/UPDATED COMMUNITY COLLECTIONS</h3>
The <a href="https://github.com/containers/ansible-podman-collections" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Podman collection</a> has a new module <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/modules/podman_network.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">podman_network</a> for the management of Podman networking.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">THE ANSIBLE TEAM IS HIRING</h3>
The Ansible Community Team is hiring engineers to help with onboarding Ansible contributors. For more info, please see the following job descriptions:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://global-redhat.icims.com/jobs/80815/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - EU</a></li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://us-redhat.icims.com/jobs/80814/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - US</a></li>
</ul>
 

<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">CONTENT FROM THE ANSIBLE COMMUNITY</h3>

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://vincent.bernat.ch/en/blog/2020-custom-ansible-module" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Writing a custom Ansible module</a> by <a href="https://twitter.com/vince2_" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Vincent Bernat</a>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://willtham.es/2020/09/09/ansible-inventory-diff-github-action.html" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Inventory Diff Github Action</a> by <a href="https://twitter.com/willthames" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Will Thames</a>
</li>
</ul>
 

<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE CONTRIBUTOR SUMMIT - PART OF ANSIBLEFEST 2020</h3>
Due to overwhelming interest in the <a href="https://www.ansible.com/ansiblefest" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">AnsibleFest 2020</a> edition of the <strong>Ansible Contributor Summit</strong>, we are planning 2 days of program for you, depending on where you are in your contribution journey. These will be held on October 12 and 15, 2020.<br><br>
Take a look at the <a href="https://github.com/ansible/community/wiki/Contributor-Summit" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">wiki page</a> to find out how the two days will be structured, and register via the corresponding links. We look forward to your participation at the Contributor Summit!<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">OPEN SOURCE AUTOMATION DAYS</h3>
We will be a part of <a href="https://osad-munich.org/en/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Open Source Automation Days</a>, which will be an online event from October 19-21, 2020. Check out the <a href="https://osad-munich.org/en/featured-speakers-2020/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">speakers and topics</a>, as well as <a href="https://osad-munich.org/en/workshops/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">workshops</a>, and get tickets <a href="https://osad-munich.org/en/osad-2020-tickets/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a> if you’re interested.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE VIRTUAL MEETUPS</h3>
The following virtual meetups are being held in the Ansible community over the next month:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-Minneapolis/events/sbqkgrybcmbwb/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Minneapolis</a> - Multicloud Networking for DevOps

    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Thu, Sep 17 · 6:30 PM CDT<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-New-Zealand/events/273239620/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible New Zealand</a> - Infrastructure Automation with Ansible + HPE
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Thu, Sep 24 · 12:00 PM GMT+12<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-in-DevOps-Torun-Bydgoszcz/events/272980420/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible in DevOps Torun-Bydgoszcz</a> - #8 Meeting AiDO GCP Anthos
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Wed, Sep 30 · 5:00 PM GMT+2<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-Montreal/events/272979731/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Montréal</a> and <a href="https://www.meetup.com/Ansible-Quebec/events/272985049/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Québec</a> - Rencontre Septembre 2020
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Wed, Sep 30 · 6:00 PM EDT</li>
    </ul>
</li>
</ul>
<em><strong>Note:</strong> For these virtual meetups, the links to participate will be visible once you RSVP to attend. If you’re interested in the topics presented, you can join from anywhere in the world as long as the time zone and language works for you!</em><br>
 
<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">FEEDBACK</h3>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'>Have any questions you’d like to ask, or issues you’d like to see covered? Please send us an email at the-bullhorn@redhat.com.</p>
 

<h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;"> </h2>

                        </td>
                    </tr>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-9/" class="u-url">Bullhorn #9</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-9/" rel="bookmark">
                <time class="published dt-published" datetime="2020-09-02T15:00:00Z" itemprop="datePublished" title="2020-09-02 15:00">2020-09-02 15:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<tr>
<td class="mcnTextContent" style='padding: 0px 18px 9px;font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;color: #202020;font-size: 16px;line-height: 150%;text-align: left;' valign="top">

                            <h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">The Bullhorn</h2>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'><em>A Newsletter for the Ansible Developer Community</em><br><br>
Welcome to <em>The Bullhorn</em>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, please reach out to us at the-bullhorn@redhat.com, or comment on this <a href="https://github.com/ansible/community/issues/546" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">GitHub issue</a>.<br>
 </p>

<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE 2.10.0 BETA 1 NOW AVAILABLE</h3>
The Ansible Community team announced the availability of Ansible 2.10.0 beta 1 on September 1st. This new Ansible package should be a drop-in replacement for Ansible 2.9; the roles and playbooks that you currently use should work out of the box with ansible-2.10.0 beta1. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/?oldui=1#!topic/ansible-devel/du7Qm7Zbd9A" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Toshio Kuratomi’s announcement to the ansible-devel mailing list</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE-BASE 2.10.1 RC2 NOW AVAILABLE</h3>
The Ansible Base team announced a release candidate of Ansible 2.10.1 on August 31st. This ansible-base package consists of only the Ansible execution engine, related tools (e.g. ansible-galaxy, ansible-test), and a very small set of built-in plugins, and is also bundled with the larger Ansible distribution. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/#!topic/ansible-devel/LiGejTx8OH4" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Rick Elrod’s announcement to the ansible-devel mailing list</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE 2.9.13 AND 2.8.15 RELEASED</h3>
The Ansible Core team announced the availability of Ansible 2.9.13 and Ansible 2.8.15 on August 31st, both of which are maintenance releases. Follow <a href="https://groups.google.com/forum/#!topic/ansible-devel/_dOAjvYlkpU" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">this link</a> for Rick Elrod’s email to the ansible-devel mailing list, to obtain details on what’s new, installation instructions, and links to the full changelogs.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">COLLECTION OWNERS: CHANGELOGS FOR ANSIBLE 2.10</h3>
Reminder for collection owners: please update your collections with appropriate changelogs by <strong>Monday, September 7</strong>. See <a href="https://docs.ansible.com/ansible/devel/dev_guide/developing_collections.html#generating-changelogs-for-a-collection" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Generating Changelogs for a collection</a> for details on using the Ansible-provided tool. You can also link directly to your own changelogs or release notes by adding the link to an issue <a href="https://github.com/ansible-community/ansible-build-data/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a> by that same date.<br>
 
<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">NEW/UPDATED COMMUNITY COLLECTIONS</h3>
<a href="https://galaxy.ansible.com/vmware/vmware_rest" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">vmware.vmware_rest</a> collection 0.1.0 has been released. It's a new VMware collection that is built on top of the vSphere REST API. The modules focus on guest management and can be mixed with the modules from <a href="https://galaxy.ansible.com/community/vmware" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">community.vmware</a> collection.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">THE ANSIBLE TEAM IS HIRING</h3>
The Ansible Community Team is hiring engineers to help with onboarding Ansible contributors. For more info, please see the following job descriptions:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://global-redhat.icims.com/jobs/80815/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - EU</a></li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://us-redhat.icims.com/jobs/80814/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - US</a></li>
</ul>
The Ansible Documentation Team is hiring a technical writer. The job is listed in Raleigh, NC, but we will consider remote applicants. If you're interested or have any questions, reach out to us on the #ansible-docs channel on freenode IRC. We've had a lot of applicants already, so act fast!

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://us-redhat.icims.com/jobs/77049/technical-writer/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Technical Writer - Ansible Project - US</a></li>
</ul>
 

<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">CONTENT FROM THE ANSIBLE COMMUNITY</h3>

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://pulpproject.org/2020/08/19/pulp-ansible-0.2.0-is-generally-available/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Pulp Ansible 0.2.0 is Generally Available</a> by <a href="https://twitter.com/CorrMelanie" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Melanie Corr</a> (<a href="https://twitter.com/pulpproj" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Pulp project</a>)</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://goneri.lebouder.net/2020/08/21/vmware-ci-of-ansible-modules-a-retrospective/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">CI of the Ansible modules for VMware: a retrospective</a> by <a href="https://github.com/goneri" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Gonéri Le Bouder</a>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://github.com/ansible-community/ara/issues/103" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">User survey: Are you using ARA with Ansible? What is your use case?</a> Please comment on the survey issue!</li>
</ul>
 

<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLEFEST VIRTUAL EXPERIENCE 2020</h3>
This year’s AnsibleFest will be a virtual experience! Find out the latest details about the event in <a href="https://www.ansible.com/blog/ansiblefest-2020-the-biggest-ansiblefest-ever" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">this blog post</a>, and register <a href="https://www.ansible.com/ansiblefest" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a>. We are also having our <a href="https://github.com/ansible/community/wiki/Contributor-Summit" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Contributor Summit</a> alongside AnsibleFest. More details will be shared soon!<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE VIRTUAL MEETUPS</h3>
The following virtual meetups are being held in the Ansible community over the next month:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-Buenos-Aires/events/272872902/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Buenos Aires</a> - Code4ndreani: Ansible 101

    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Wed, Sep 2 · 6:00 PM GMT-3<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Melbourne-Ansible-User-Group/events/zlgpzqybcmbmb/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Melbourne</a> September Meetup: Ansible and REST API's
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Wed, Sep 9 · 1:00 AM GMT+10<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-London/events/272502539/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible London</a> [virtual] meetup – 10th Sept
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Thu, Sep 10 · 5:45 PM GMT+1</li>
    </ul>
</li>
</ul>
<em><strong>Note:</strong> For these virtual meetups, the links to participate will be visible once you RSVP to attend. If you’re interested in the topics presented, you can join from anywhere in the world as long as the time zone and language works for you!</em><br>
 
<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">FEEDBACK</h3>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'>Have any questions you’d like to ask, or issues you’d like to see covered? Please send us an email at the-bullhorn@redhat.com.</p>
 

<h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;"> </h2>

                        </td>
                    </tr>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="getting-started-with-ospfv2-resource-modules/" class="u-url">Getting Started With OSPFV2 Resource Modules</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/rohit-thakur/">Rohit Thakur</a>
              </span>
            </p>
            <p class="dateline">
              <a href="getting-started-with-ospfv2-resource-modules/" rel="bookmark">
                <time class="published dt-published" datetime="2020-08-27T00:00:00Z" itemprop="datePublished" title="2020-08-27 00:00">2020-08-27 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Getting Started With OSPFV2 Resource Modules</h2>
<p>With the increasing size and complexity of modern enterprise networks,
the demand on simplifying the networks management becomes more intense.
The introduction of resources modules with Ansible 2.9
provide a path to users to ease the network management, especially
across multiple different product vendors.</p>
<p>In the past, we've already covered resource modules for
VLAN management and for <code>ACLs</code>.
However, simplifying network management is not limited to rather local
network setups: Open Shortest Path First (OSPFv2) is a
protocol used to distribute IP routing information throughout a single
Autonomous System (AS). It is used in larger network setups, as the
<a href="https://en.wikipedia.org/w/index.php?title=Open_Shortest_Path_First&amp;oldid=967345042">Wikipedia page so aptly observes</a></p>
<p><em>OSPF is a widely used IGP in large enterprise networks. IS-IS, another LSR-based protocol, is more common in large service provider networks.</em></p>
<p>Managing OSPFv2 manually for a network device can be a very difficult
and tedious task, and more often this needs to be performed carefully,
as the manual process is more prone to human error.</p>
<p>This blog post goes through the OSPFV2 resource module for the VyOS
network platform. We will walk through several examples and describe the
use cases for each state parameter and how we envision these being used
in real world scenarios.</p>
<h3>OSPFv2 resource modules example: Vyos</h3>
<p>The goal of OSPFv2 resource modules is to make sure configurations are
consistently applied across the infrastructure with less effort. It
simplifies management and makes it faster and easier to scale without
worrying about the actual implementation details of the network
platforms working under the hood.</p>
<p>In October of 2019, as part of Red Hat Ansible Engine 2.9, the Ansible
Network Automation team introduced the
concept of resource modules to make network automation easier and
more consistent for those automating various network platforms in
production.</p>
<p>Ansible Content refers to Ansible Playbooks, modules, module utilities
and plugins. Basically all of the Ansible tools that users utilize to
create their Ansible and the OSPFv2 resource module is part of Ansible
Content Collections.</p>
<p>Let's have a closer look at how the OSPFv2 resource modules work. As an
example, we pick the <a href="https://docs.ansible.com/ansible/latest/modules/eos_vlans_module.html">vyos_</a> ospfv2 resource module. In this blog, we'll be using a VyOS router with version
1.1.8 (helium) for all the configuration management specific operations.
Also, to better showcase the effect of the modules, we will start with
some <a href="https://gist.github.com/rohitthakur2590/4446ba7c274659395381495e28229943">OSPF version 2 specific attributes</a>
already configured. Check out the linked listing for further details.</p>
<h4>Accessing and using the VyOS Collection</h4>
<p>To download the VyOS Collection, refer to Automation Hub (fully
supported, requires a Red Hat Ansible Automation Platform subscription)
or Ansible Galaxy (upstream community
supported):</p>
<ul>
<li>
<a href="https://cloud.redhat.com/ansible/automation-hub/vyos/vyos">Automation Hub Collection</a>: <code>vyos.vyos</code>
</li>
<li>
<a href="https://galaxy.ansible.com/vyos/vyos">Ansible Galaxy Collection</a>: <code>vyos.vyos</code>
</li>
</ul>
<p>Before we get started, let's quickly explain the rationale behind
naming the network resource modules. Notice for resource modules that
configure OSPFV2 routes, the newly added modules will be named based on
the IP address type. This was done so that those using existing network
modules would not have their Ansible Playbooks stop working and have
sufficient time to migrate to the new network automation modules.</p>
<p>A module to configure OSPFv2 is also available for the following
supported platforms:</p>
<ul>
<li><a href="https://galaxy.ansible.com/arista/eos">Arista EOS (arista.eos.eos_ospfv2)</a></li>
<li>
<a href="https://galaxy.ansible.com/cisco/ios">Cisco IOS (cisco.ios.ios_ospfv2)</a> </li>
<li><a href="https://galaxy.ansible.com/cisco/iosxr">Cisco IOSXR (cisco.ios.iosxr_ospfv2)</a></li>
<li><a href="https://galaxy.ansible.com/cisco/nxos">Cisco NXOS (cisco.nxos.nxos_ospfv2)</a></li>
<li><a href="https://galaxy.ansible.com/junipernetworks/junos">Juniper junos (junipernetwork.junos.junos_ospfv2)</a></li>
<li><a href="https://galaxy.ansible.com/vyos/vyos">Vyos (vyos.vyos.vyos_ospfv2)</a></li>
</ul>
<p>The OSPFV2 resource module provides the same level functionality that a
user can achieve when configuring manually on to the VyOS device with
all advantages of Ansible, plus with an added edge of
Ansible facts gathering and resource
module approach, which is more closely aligned with network professionals day
to day working.</p>
<h3>Use Case: OSPFv2 configuration changes</h3>
<h4>Using state gathered - Building an Ansible inventory</h4>
<p>Resource modules allow the user to read in existing network
configuration and convert that into a structured data model. The
<strong>state: gathered</strong> is the equivalent for gathering
Ansible Facts for this specific resource. This example will read in the
existing network configuration and store it as a
flat-file.</p>
<p>Here is an Ansible Playbook example of using
<strong>state: gathered</strong> and storing the result as YAML into
host_vars. If you are new to Ansible Inventory and want to learn about
group_vars and host_vars, please refer to the
<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html">documentation here.</a></p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">convert configured OSPFV2 resource to structured data</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inventory_dir</span><span class="p">:</span><span class="w"> </span><span class="s">"lab_inventory"</span>
<span class="w">    </span><span class="nt">inventory_hostname</span><span class="p">:</span><span class="w"> </span><span class="s">"vyos"</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use the OSPFV2 resource module to gather the current config</span>
<span class="w">    </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gathered</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ospfv2</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create inventory directory</span>
<span class="w">    </span><span class="nt">file</span><span class="p">:</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">inventory_dir</span><span class="nv"> </span><span class="s">}}/host_vars/{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">directory</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Write the OSPFV2 configuration to a file</span>
<span class="w">    </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">      </span><span class="nt">content</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">{'ospfv2':</span><span class="nv"> </span><span class="s">ospfv2['gathered']}</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">to_nice_yaml</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">inventory_dir</span><span class="nv"> </span><span class="s">}}/host_vars/{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}/ospfv2.yaml"</span>
</pre></div>

<p>Execute the Ansible Playbook with the ansible-playbook command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>ansible-playbook<span class="w"> </span>example.yml
</pre></div>

<p>Here is the data structure that was created from reading/gathered
operation  in a brown-field configuration:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ cat nw_inventory/host_vars/vyos/ospfv2.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">ospfv2</span><span class="p p-Indicator">:</span>
<span class="w">  </span><span class="nt">areas</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'2'</span>
<span class="w">    </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">      </span><span class="nt">normal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plaintext-password</span>
<span class="w">    </span><span class="nt">shortcut</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">enable</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'4'</span>
<span class="w">    </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">      </span><span class="nt">stub</span><span class="p">:</span>
<span class="w">        </span><span class="nt">default_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">        </span><span class="nt">set</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>You can check out the full detailed listing of the output of this
example in the <a href="https://gist.github.com/rohitthakur2590/0e18173ee73a07a050d5b02ec6777c3d">state: gathered reference gist</a>.</p>
<h4>Using state merged - Pushing configuration changes</h4>
<p>The state merged will take your Ansible configuration data (i.e.
Ansible variables) and merges them into the network device's running
configuration. This will not affect existing configuration not specified
in your Ansible configuration data. Let's walk through an
example.</p>
<p>We will modify the flat-file created in the first example with a
<a href="https://gist.github.com/rohitthakur2590/31cf81adff5ff538ee201eae8f66fc7a">configuration to be merged</a>.</p>
<p>Here are the most important pieces:</p>
<div class="code"><pre class="code literal-block"><span class="nt">areas</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'2'</span>
<span class="w">   </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">     </span><span class="nt">normal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">   </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="s">"plaintext-password"</span>
<span class="w">   </span><span class="nt">shortcut</span><span class="p">:</span><span class="w"> </span><span class="s">'enable'</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'3'</span>
<span class="w">   </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">     </span><span class="nt">nssa</span><span class="p">:</span>
<span class="w">       </span><span class="nt">set</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>Now let's create an Ansible Playbook to merge this new configuration
into the network device's running configuration:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Merged state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Merge OSPFV2 config with device existing OSPFV2 config</span>
<span class="w">      </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">merged</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ospfv2</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Execute the Ansible Playbook with the ansible-playbook command:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>ansible-playbook<span class="w"> </span>merged.yml
</pre></div>

<p>And, once we run the respective Merge play, all of the provided
parameters will be configured on the VyOS router with Ansible
<strong>changed=True.</strong></p>
<p>Note the network configuration after the merge operation:</p>
<div class="code"><pre class="code literal-block">vyos@vyos:~$<span class="w"> </span>show<span class="w"> </span>configuration<span class="w"> </span>commands<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ospf
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>area-type<span class="w"> </span><span class="s1">'normal'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>authentication<span class="w"> </span><span class="s1">'plaintext-password'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>shortcut<span class="w"> </span><span class="s1">'enable'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">3</span><span class="w"> </span>area-type<span class="w"> </span><span class="s1">'nssa'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">4</span><span class="w"> </span>area-type<span class="w"> </span>stub<span class="w"> </span>default-cost<span class="w"> </span><span class="s1">'20'</span>
</pre></div>

<p>Note that this listing only shows a few highlights; the full listing is
available in the <a href="https://gist.github.com/rohitthakur2590/9d59ca2b4e2b396bea1af32eefcc2d9d">merged gist</a>.</p>
<p>Let's take a look at what has changed through this operation: if we go
through the device output, there are a few
observations:</p>
<ul>
<li>Attribute area with area_id '3' got added to the OSPF areas list. </li>
<li>The redistribute and parameter attribute got configured for OSPF.</li>
<li>If there was an already configured OSPF with AREA and the user
    wanted to update any parameter for that particular AREA, then the
    user can also use the Merged state to update the AREA under OSPFV2.</li>
</ul>
<p>With the second run, the respective Merge Play runs again and Ansible
charm of Idempotency comes to picture. If nothing's changed, play run
results into changed=False, which confirms to the user that all of
the provided configurations in the play are already configured on the IOS device.</p>
<h4>Using state replaced - Replacing configuration</h4>
<p>If the user wants to re-configure the VyOS device entirely
pre-configured OSPFV2 with the provided OSPFV2 configuration, then the
resource module <em>replaced</em> state comes into picture.</p>
<p>The scope of the replaced operation is up to the individual processes.
In the case of VyOS only a single process is supported. As a result, the
replaced state acts similar to the overridden state. For that reason a
dedicated overridden state is not required with the VyOS modules. Other
network platforms that support multiple OSPFV2 processes do have the
overridden state operation.</p>
<p>Using the overridden state, a user can override all OSPFV2 resource
attributes with user-provided OSPFV2 configuration. Since this resource
module state overrides all pre-existing attributes of the resource
module, the overridden state should be used cautiously, as OSPFV2
configurations are very important; if all the configurations are
mistakenly replaced with the play input configuration, it might create
unnecessary issues for the network administrators. </p>
<p>In this scenario, OSPF with 'n' number AREAs are already configured on
the VyOS device, and now the user wants to update the AREA list with a
new set of AREAs and discard all the already configured OSPF AREAs.
Here, the resource module replaced state will be an ideal choice and, as
the name suggests, the replaced state will replace OSPF existing AREA
list with a new set of AREAs given as input by the user.</p>
<p>If a user tries to configure any new OSPFV2 AREA/attribute that's not
already pre-configured on the device, it'll act as a merged state and
the vyos_ospfv2 module will try to configure the OSPF AREAs given as
input by the user inside the replace play.</p>
<p>We will modify the flat-file created in the first example:</p>
<div class="code"><pre class="code literal-block"><span class="nt">areas</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'2'</span>
<span class="w">   </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">     </span><span class="nt">normal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">   </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="s">"plaintext-password"</span>
<span class="w">   </span><span class="nt">shortcut</span><span class="p">:</span><span class="w"> </span><span class="s">'enable'</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'4'</span>
<span class="w">   </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">     </span><span class="nt">stub</span><span class="p">:</span>
<span class="w">      </span><span class="nt">default_cost</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
</pre></div>

<p>Check out the
<a href="https://gist.github.com/rohitthakur2590/31b2cce1f5157382025ae6a9d89add04">full input config structure</a>
if you want to learn more details.</p>
<p>Again, we create an Ansible Playbook to merge this new configuration
into the network device's running configuration:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Replaced state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Replace OSPFV2 config with device existing OSPFV2 config</span>
<span class="w">      </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replaced</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ospfv2</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>Once we run the respective Replaced play, all of the provided
parameters will override all the existing OSPFv2 resource specific
config on the VyOS router with Ansible
<strong>changed=True</strong>.</p>
<p>The network device configuration after the Replaced
operation:</p>
<div class="code"><pre class="code literal-block">vyos@vyos:~$<span class="w"> </span>show<span class="w"> </span>configuration<span class="w"> </span>commands<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ospf
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>area-type<span class="w"> </span><span class="s1">'normal'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>authentication<span class="w"> </span><span class="s1">'plaintext-password'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">2</span><span class="w"> </span>shortcut<span class="w"> </span><span class="s1">'enable'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">4</span><span class="w"> </span>area-type<span class="w"> </span>stub<span class="w"> </span>default-cost<span class="w"> </span><span class="s1">'20'</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>ospf<span class="w"> </span>area<span class="w"> </span><span class="m">4</span><span class="w"> </span>network<span class="w"> </span><span class="s1">'192.0.2.0/24'</span>
</pre></div>

<p>Check out the <a href="https://gist.github.com/rohitthakur2590/57bf71dbe2c8417426e7ddcb4f8fd7c0">corresponding gist</a> for more details.</p>
<p>If we dig into the above output, we note the following
changes:</p>
<ul>
<li>Replaced negates all of the pre-existing OSPFV2 resource-specific
    attributes and deletes those configurations, which are not present
    inside the replaced play. In the above example, ospfv2 area-id 3 got
    deleted.</li>
<li>For the OSPFV2 configurations that are pre-existing and also in the
    play, vyos_ospfv2 replaced state will try to delete/negate all the
    pre-existing OSPFV2 config and then configure the new OSPFV2 config
    as mentioned in the play.</li>
<li>For any non-existing OSPFV2 specific attribute, the replaced state
    will configure the OSPFV2 in the same manner as the Merged state. In
    the above example, a new network address configured for OSPFv2
    area-id 4.</li>
</ul>
<p>With the second run of the above play, there
are no changes reported which satisfies the Ansible
idempotency.</p>
<h4>Using state deleted - Delete configuration</h4>
<p>Now that we've talked about how we can configure OSPFV2 specific
attributes on the VyOS device by using vyos_ospfv2 resource module
merged and replaced state, it's time we talk about how we can delete the
pre-configured OSPFV2 attributes and what level of granularity is
available with the deleted operational state for the
user.</p>
<p>Deleting <strong>ALL OSPFV2</strong> config in one go leads to deleting all the pre-configured
<strong>OSPFV2 specific attributes from the VyOS</strong> device. But that said, this is a very critical delete operation and if not used judiciously, it has the power to delete all pre-configured
<strong>OSPFV2</strong> and can result in the production environment with the router having
<strong>no</strong> pre-configured <strong>OSPFV2 attributes</strong>.</p>
<p>Let's create an Ansible Playbook to merge this new configuration into the network device's running configuration:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deleted state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Delete ALL OSPFV2 config</span>
<span class="w">      </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deleted</span>
</pre></div>

<p>After we execute the playbook, the network device configuration changed:</p>
<div class="code"><pre class="code literal-block">vyos@vyos:~$<span class="w"> </span>show<span class="w"> </span>configuration<span class="w"> </span>commands<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ospf
vyos@vyos:~$
</pre></div>

<p>Make sure to look at the <a href="https://gist.github.com/rohitthakur2590/bb93302da90fe9f0865313b112998602">full listing of the changed values</a>.
If we dig into the above output briefly, we can see that all the ospfv2
resource-specific config has been removed from the network
configuration.</p>
<h4>Using state rendered - Development and working offline</h4>
<p>Ansible renders the provided configuration in the task in the
device-native format (for example, VyOS CLI). Ansible returns this
rendered configuration in the rendered key in the result. Note this
state does not communicate with the network device and can be used
offline.</p>
<p>To have a config to be rendered, modify the YAML file created in the
first scenario.  For example, if this is the vyos_ospfv2 module, you can
just add a few more attributes to show we change the data model yet
again.</p>
<div class="code"><pre class="code literal-block"><span class="nt">areas</span><span class="p">:</span>
<span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">area_id</span><span class="p">:</span><span class="w"> </span><span class="s">'2'</span>
<span class="w">   </span><span class="nt">area_type</span><span class="p">:</span>
<span class="w">     </span><span class="nt">normal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">   </span><span class="nt">authentication</span><span class="p">:</span><span class="w"> </span><span class="s">"plaintext-password"</span>
</pre></div>

<p>See the full listing in the <a href="https://gist.github.com/rohitthakur2590/d6f6cd599c3e2fecb51dfe628d640a8f">corresponding rendered gist</a>.</p>
<p>We create a playbook to execute this:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Rendered state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Render the provided configuration</span>
<span class="w">      </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ospfv2</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rendered</span>
</pre></div>

<p>This produces the following output:</p>
<div class="code"><pre class="code literal-block"><span class="s">"rendered"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">       </span><span class="s">"set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">log-adjacency-changes</span><span class="nv"> </span><span class="s">'detail'"</span><span class="p p-Indicator">,</span>
<span class="w">       </span><span class="s">"set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">max-metric</span><span class="nv"> </span><span class="s">router-lsa</span><span class="nv"> </span><span class="s">administrative"</span><span class="p p-Indicator">,</span>
<span class="w">       </span><span class="s">"set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">max-metric</span><span class="nv"> </span><span class="s">router-lsa</span><span class="nv"> </span><span class="s">on-shutdown</span><span class="nv"> </span><span class="s">10"</span><span class="p p-Indicator">,</span>
</pre></div>

<p>Check out the <a href="https://gist.github.com/rohitthakur2590/862b2321283aafb7c41af342f227d1e8">corresponding gist</a> for more details.</p>
<p>If we dig into the above output, we can see that nothing has changed at
all; rendered doesn't even require the connection establishment with an
actual network device.</p>
<h4>Using state parsed - Development and working offline</h4>
<p>Ansible parses the configuration from the running_configuration option
into Ansible structured data in the parsed key in the result. Note this
does not gather the configuration from the network device, so this state
can be used offline.</p>
<p>As the config to be parsed we take device-native format configuration:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 2 area-type 'normal'</span>
<span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 2 authentication 'plaintext-password'</span>
<span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 2 shortcut 'enable'</span>
<span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 4 area-type stub default-cost '20'</span>
<span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 4 network '192.0.2.0/24'</span>
<span class="l l-Scalar l-Scalar-Plain">set protocols ospf area 4 range 192.0.3.0/24 cost '10'</span>
</pre></div>

<p>The playbook to apply this configuration is:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parsed state play</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vyos</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Parse the provided OSPFV2 configuration</span>
<span class="w">      </span><span class="nt">vyos.vyos.vyos_ospfv2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">running_config</span><span class="p">:</span>
<span class="w">           </span><span class="s">"set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">area</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">area-type</span><span class="nv"> </span><span class="s">'normal'</span>
<span class="w">            </span><span class="s">set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">area</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">authentication</span><span class="nv"> </span><span class="s">'plaintext-password'</span>
<span class="w">            </span><span class="s">set</span><span class="nv"> </span><span class="s">protocols</span><span class="nv"> </span><span class="s">ospf</span><span class="nv"> </span><span class="s">area</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">shortcut</span><span class="nv"> </span><span class="s">'enable'</span>
<span class="w">        </span><span class="s">state:</span><span class="nv"> </span><span class="s">parsed</span>
</pre></div>

<p>Execute the playbook generates the following output:</p>
<div class="code"><pre class="code literal-block"><span class="s">"parsed"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">        </span><span class="s">"areas"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">            </span><span class="p p-Indicator">{</span>
<span class="w">                </span><span class="s">"area_id"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"2"</span><span class="p p-Indicator">,</span>
<span class="w">                </span><span class="s">"area_type"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">                    </span><span class="s">"normal"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">true</span>
<span class="w">                </span><span class="p p-Indicator">},</span>
<span class="w">                </span><span class="s">"authentication"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"plaintext-password"</span><span class="p p-Indicator">,</span>
<span class="w">                </span><span class="s">"shortcut"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"enable"</span>
<span class="w">             </span><span class="p p-Indicator">}</span>

<span class="w">                </span><span class="p p-Indicator">]</span>
<span class="w">            </span><span class="p p-Indicator">}</span>
<span class="nn">...</span>
</pre></div>

<p>If we dig into the above output, we can see that nothing has changed at
all, parsed operation doesn't even require the connection establishment
with an actual network device.</p>
<p>Note: parsed input to be provided as value to running_config key.</p>
<h3>Takeaways &amp; Next Steps</h3>
<p>As shown above, with the help of the resource modules management of
OSPFV2, resource-specific configurations can be greatly simplified.
Users don't need to bother much about OSPFV2 implementation details for
each platform, they can just enter the actual data. By using the merged,
replaced and overridden parameters, we allow much more flexibility for
network engineers to adopt automation in incremental steps. The other
operations like gathered, rendered and parsed allow a better, user
friendly handling of the facts and the data managed within these
tasks.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="ansible-certified-content-collection-for-chocolatey/" class="u-url">Ansible Certified Content Collection for Chocolatey</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/paul-broadwith/">Paul Broadwith</a>
              </span>
            </p>
            <p class="dateline">
              <a href="ansible-certified-content-collection-for-chocolatey/" rel="bookmark">
                <time class="published dt-published" datetime="2020-08-26T00:00:00Z" itemprop="datePublished" title="2020-08-26 00:00">2020-08-26 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Ansible Certified Content Collection for Chocolatey</h2>
<p>It's a constant battle to keep your Windows estate updated and secure.
Using Red Hat Ansible Automation Platform and Chocolatey, you can easily
keep your software up-to-date and react quickly to bug fixes, security
issues and 0-days on dozens, hundreds or thousands of nodes.</p>
<p>We're going to take you through three simple steps to show you how
simple it is to deploy and update software using Chocolatey and Ansible.</p>
<h3>Before We Start: Windows Prerequisites</h3>
<p>Ansible  uses Winrm by default to communicate with Windows machines.
Therefore, we need to ensure we have that enabled by running
<code>Enable-PSRemoting</code> on the remote Windows computer.</p>
<p>For production use, we recommend enabling
<a href="https://support.microsoft.com/en-gb/help/2019527/how-to-configure-winrm-for-https">HTTPS for WinRM</a>. </p>
<p>The code examples shown below are all using the user 'ansible' as the
default. If you are using a different username, make sure you change it!</p>
<p><strong>Step 1: Configure Ansible to use Chocolatey.</strong></p>
<p>We need to install the Chocolatey module so that Ansible can use. The 
Chocolatey Ansible Content Collection is called
<a href="https://galaxy.ansible.com/chocolatey/chocolatey">chocolatey:chocolatey</a>
and is maintained by the
<a href="https://github.com/chocolatey/chocolatey-ansible">Chocolatey</a>
Team. To install the Collection, and therefore the win_chocolatey
modules, on your Ansible server, run:</p>
<div class="code"><pre class="code literal-block">ansible-galaxy collection install chocolatey.chocolatey
</pre></div>

<p>That's all there is to it! Ansible can now work with Chocolatey using
the modules in the Collection.</p>
<p><strong>Step 2: Install software on a remote computer</strong></p>
<p>Now that we have the win_chocolatey module installed, we can go ahead
and install or manage software on our remote computers.</p>
<p>Let's create a file called <code>install_notepadplusplus.yml</code> with the
following contents:</p>
<div class="code"><pre class="code literal-block"><span class="o">---</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">all</span>
<span class="w">  </span><span class="n">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span>

<span class="w">  </span><span class="n">vars_prompt</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">password</span>
<span class="w">      </span><span class="n">prompt</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the password for the node"</span>

<span class="w">  </span><span class="n">vars</span><span class="p">:</span>
<span class="w">      </span><span class="n">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="n">ansible</span>
<span class="w">      </span><span class="n">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ password }}"</span>
<span class="w">      </span><span class="n">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="n">winrm</span>
<span class="w">      </span><span class="n">ansible_winrm_transport</span><span class="p">:</span><span class="w"> </span><span class="n">ntlm</span>
<span class="w">      </span><span class="n">ansible_winrm_server_cert_validation</span><span class="p">:</span><span class="w"> </span><span class="n">ignore</span>

<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">Notepad</span><span class="o">++</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">7.8</span>
<span class="w">        </span><span class="n">win_chocolatey</span><span class="p">:</span>
<span class="w">          </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">notepadplusplus</span>
<span class="w">          </span><span class="n">version</span><span class="p">:</span><span class="w"> </span><span class="err">‘</span><span class="mf">7.8</span><span class="err">’</span>
</pre></div>

<p>Run <code>ansible-playbook install_notepadplusplus.yaml -i &lt;ip address&gt;,</code>
(note the comma after the IP address) to install Notepad++ on your
remote computer. Note that we are not installing the latest version in
this example as we will update to that in the next step.</p>
<p>Once installed, open Notepad++ and press <code>F1</code> to ensure we have
installed the requested version. </p>
<p><strong>Step 3: Update software on a remote computer</strong></p>
<p>To ensure you always have the latest version of software installed on
your computers, you can use Chocolatey to upgrade them. We'll upgrade to
the latest version of Notepad++.</p>
<p>Create a file called <code>upgrade_notepadplusplus.yml</code> with the following
contents:</p>
<div class="code"><pre class="code literal-block"><span class="o">---</span>
<span class="o">-</span><span class="w"> </span><span class="n">hosts</span><span class="p">:</span><span class="w"> </span><span class="n">all</span>
<span class="w">  </span><span class="n">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="bp">false</span>

<span class="w">  </span><span class="n">vars_prompt</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">password</span>
<span class="w">      </span><span class="n">prompt</span><span class="p">:</span><span class="w"> </span><span class="s2">"Enter the password for the node"</span>

<span class="w">  </span><span class="n">vars</span><span class="p">:</span>
<span class="w">    </span><span class="n">ansible_user</span><span class="p">:</span><span class="w"> </span><span class="n">ansible</span>
<span class="w">    </span><span class="n">ansible_password</span><span class="p">:</span><span class="w"> </span><span class="s2">"{{ password }}"</span>
<span class="w">    </span><span class="n">ansible_connection</span><span class="p">:</span><span class="w"> </span><span class="n">winrm</span>
<span class="w">    </span><span class="n">ansible_winrm_transport</span><span class="p">:</span><span class="w"> </span><span class="n">ntlm</span>
<span class="w">    </span><span class="n">ansible_winrm_server_cert_validation</span><span class="p">:</span><span class="w"> </span><span class="n">ignore</span>

<span class="w">  </span><span class="n">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">Install</span><span class="w"> </span><span class="n">latest</span><span class="w"> </span><span class="n">Notepad</span><span class="o">++</span>
<span class="w">      </span><span class="n">win_chocolatey</span><span class="p">:</span>
<span class="w">        </span><span class="n">name</span><span class="p">:</span><span class="w"> </span><span class="n">notepadplusplus</span>
<span class="w">        </span><span class="n">state</span><span class="p">:</span><span class="w"> </span><span class="n">latest</span>
</pre></div>

<p>Run <code>ansible-playbook upgrade_notepadplusplus.yaml -i &lt;ip address&gt;,</code>
(note the comma after the IP address) to update, or install, the latest
Notepad++ on your remote computer. Once installed, open Notepad++ and
press <code>F1</code> to ensure we have installed the latest version. </p>
<h3>Next Steps</h3>
<p>While we have only worked with one remote computer in this blog post,
Ansible allows you to replicate this across dozens, hundreds and
thousands of remote computers.</p>
<p>Now that you have the Ansible Chocolatey modules installed, you can
install, uninstall, update and manage packages on your computers. Other
modules in the Chocolatey Ansible  Content Collection give you the
ability to manage the configuration, features and sources for Chocolatey
itself. You can find more information on the
<a href="https://galaxy.ansible.com/chocolatey/chocolatey">Ansible Galaxy Chocolatey collection page</a>.</p>
<p>Chocolatey has a <a href="https://chocolatey.org/docs/how-to-setup-internal-package-repository">recommended architecture</a>
for organizations, which includes setting up an internal repository. To
speed up that process, there is a <a href="https://chocolatey.org/docs/quick-deployment-environment">Quick Deployment Environment</a> that
allows you to be up and running with an internal repository with useful
packages already loaded, Jenkins for automation and Chocolatey Central
Management for reporting in around two hours.</p>
<p>For package management on Windows, Chocolatey is the package manager of
choice. Working in harmony with Ansible, you can use it to update and
manage your Windows computers in a similar way as you would with Linux.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="developing-and-testing-ansible-roles-with-molecule-and-podman-part-1/" class="u-url">Developing and Testing Ansible Roles with Molecule and Podman - Part 1</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ricardo-gerardi/">Ricardo Gerardi</a>
              </span>
            </p>
            <p class="dateline">
              <a href="developing-and-testing-ansible-roles-with-molecule-and-podman-part-1/" rel="bookmark">
                <time class="published dt-published" datetime="2020-08-25T00:00:00Z" itemprop="datePublished" title="2020-08-25 00:00">2020-08-25 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Developing and Testing Ansible Roles with Molecule and Podman - Part 1</h2>
<p>One of the beauties of the Red Hat Ansible Automation Platform is that
the language to describe automation is readable not only by a few
dedicated experts, but by almost anyone across the IT ecosystem. That
means all IT professionals can take part in the automation, enabling
cross team collaboration and really drive automation as a culture inside
an organization. With so many people contributing to the automation, it
is crucial to test the automation content in-depth. So when you're
developing new Ansible Content like playbooks, roles and collections,
it's a good idea to test the content in a test environment before using
it to automate production infrastructure. Testing ensures the automation
works as designed and avoids unpleasant surprises down the road. </p>
<p>Testing automation content is often a challenge, since it requires the
deployment of specific testing infrastructure as well as setting up the
testing conditions to ensure the tests are relevant. Molecule is a
complete testing framework that helps you develop and test Ansible
roles, which allows you to focus on the content instead of focusing on
managing testing infrastructure.</p>
<p>According to its official
<a href="https://molecule.readthedocs.io/en/latest/index.html#">documentation</a>,
Molecule is a project:</p>
<p>"designed to aid in the development and testing of Ansible roles. It
encourages an approach that results in consistently developed roles that
are well-written, easily understood and maintained."</p>
<p>Molecule allows you to test your role with many instances, ensuring it
works properly across different combinations of operating systems and
virtualization environments. Without it, you would have to provision and
maintain a testing environment separately. You would also have to
configure connectivity to those instances and ensure they are clean and
ready before every test. Molecule manages those aspects for you in an
automated and repeatable manner.</p>
<p>In this two part series, we will use Molecule to develop and test a new
Ansible role. The first article will guide you through installing and
configuring Molecule. In Part 2, we will use Molecule to aid with the
role development.</p>
<p>If this role is part of a Collection, use this approach to develop and
"unit" test the role. In a future article, we'll see how to use Molecule
to run integrated tests in a Collection.</p>
<p>Molecule uses drivers to provision testing instances using different
technologies, including Linux containers, virtual machines and cloud
providers. By default, it comes with three drivers pre-installed: Docker
and Podman drivers to manage containers, and Delegated that allows you
to customize your integration. Drivers for other providers are available
through the open source community.</p>
<p>In this article, we will use the <a href="https://podman.io/">Podman</a> driver to
develop and test a new role using Linux containers. Podman is a
lightweight container engine for Linux that does not require a running
daemon, and allows execution of containers in "rootless" mode for
increased security. </p>
<p>By using Molecule with the Podman driver, we will develop and test a new
Ansible role from scratch. This basic role deploys a web application
supported by the Apache web server. It must run on Red Hat Enterprise
Linux (RHEL) 8 or Ubuntu 20.04 operating systems.</p>
<p>This example shows a common scenario where a role is expected to work on
different versions of operating systems. Using Podman and Linux
containers allows us to create many instances to test the role with the
specific required versions. Since containers are lightweight, they also
allow us to quickly iterate over the role functionality while developing
it. Using containers for testing roles is applicable in this situation
because the role is configuring the running Linux instances only. To
test other provisioning scenarios or cloud infrastructure, we can use
the delegated driver or another appropriate driver provided by the
community.</p>
<h3>What do you need?</h3>
<p>To follow this tutorial, use a physical or virtual machine running Linux
with Python 3 and Podman installed. For these examples, we're running
RHEL 8.2. You also need Podman configured to run rootless containers.
The installation of Podman is out of the scope of this blog, so please
refer to the official
<a href="https://podman.io/getting-started/installation">documentation</a> for more
information. To install Podman on RHEL 8, you can also check the RHEL 8
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/building_running_and_managing_containers/index#getting-container-tools_building-running-and-managing-containers">container
documentation</a>.</p>
<h3>Getting Started</h3>
<p>Molecule is available as a Python package and thus can be installed via
pip. As a first step, we create a dedicated Python environment for our
Molecule installation, and install it there:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>mkdir<span class="w"> </span>molecule-blog
$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>molecule-blog
$<span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>venv<span class="w"> </span>molecule-venv
$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>molecule-venv/bin/activate
<span class="o">(</span>molecule-venv<span class="o">)</span><span class="w"> </span>$<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span><span class="s2">"molecule[lint]"</span>
</pre></div>

<p>Note that we installed Molecule with the "lint" option. By using this
option, pip also installed the "yamllint" and "ansible-lint" tools that
allow you to use Molecule to  perform static code analysis of your role,
ensuring it complies with Ansible coding standards.</p>
<p>The installation downloads all of the dependencies from the Internet,
including Ansible. Verify the installed version:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>--version
molecule<span class="w"> </span><span class="m">3</span>.0.4
<span class="w">   </span><span class="nv">ansible</span><span class="o">==</span><span class="m">2</span>.9.10<span class="w"> </span><span class="nv">python</span><span class="o">==</span><span class="m">3</span>.6
</pre></div>

<p>Next, let's use the "molecule" command to initialize a new Ansible role.</p>
<h3>Initializing a New Ansible Role</h3>
<p>Generally speaking, when developing a new Ansible role, you initialize
it by running the "ansible-galaxy role init" command. In this case,
instead use "molecule" to initialize the new role. By doing this, you'll
have the same role structure provided by the "ansible-galaxy" command
and the basic boilerplate code required to run Molecule tests.</p>
<p>By default, Molecule uses the Docker driver to execute tests. Since we
want to execute tests using "podman", we need to specify the driver name
using the option <code>--driver-name=podman</code> when initializing the role with
"molecule". </p>
<p>Switch back to the "molecule-blog" directory and initialize the new role
"mywebapp" with this command: </p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>init<span class="w"> </span>role<span class="w"> </span>mywebapp<span class="w"> </span>--driver-name<span class="o">=</span>podman
--&gt;<span class="w"> </span>Initializing<span class="w"> </span>new<span class="w"> </span>role<span class="w"> </span>mywebapp...
Initialized<span class="w"> </span>role<span class="w"> </span><span class="k">in</span><span class="w"> </span>/home/ricardo/molecule-blog/mywebapp<span class="w"> </span>successfully.
</pre></div>

<p>Molecule created the structure for your new role in a directory named
"mywebapp". Switch into this directory and check the content created by
Molecule:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>mywebapp
$<span class="w"> </span>tree
.
├──<span class="w"> </span>defaults
│<span class="w">   </span>└──<span class="w"> </span>main.yml
├──<span class="w"> </span>files
├──<span class="w"> </span>handlers
│<span class="w">   </span>└──<span class="w"> </span>main.yml
├──<span class="w"> </span>meta
│<span class="w">   </span>└──<span class="w"> </span>main.yml
├──<span class="w"> </span>molecule
│<span class="w">   </span>└──<span class="w"> </span>default
│<span class="w">       </span>├──<span class="w"> </span>converge.yml
│<span class="w">       </span>├──<span class="w"> </span>INSTALL.rst
│<span class="w">       </span>├──<span class="w"> </span>molecule.yml
│<span class="w">       </span>└──<span class="w"> </span>verify.yml
├──<span class="w"> </span>README.md
├──<span class="w"> </span>tasks
│<span class="w">   </span>└──<span class="w"> </span>main.yml
├──<span class="w"> </span>templates
├──<span class="w"> </span>tests
│<span class="w">   </span>├──<span class="w"> </span>inventory
│<span class="w">   </span>└──<span class="w"> </span>test.yml
└──<span class="w"> </span>vars
<span class="w">    </span>└──<span class="w"> </span>main.yml

<span class="m">10</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">12</span><span class="w"> </span>files
</pre></div>

<p>Molecule includes its configuration files under the "molecule"
subdirectory. When initializing a new role, Molecule adds a single
scenario named "default". Later, you can add more scenarios to test
different conditions. For this tutorial, we'll use the "default"
scenario.</p>
<p>Verify the basic configuration in the file <code>molecule/default/molecule.yml</code>:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>cat<span class="w"> </span>molecule/default/molecule.yml
---
dependency:
<span class="w">  </span>name:<span class="w"> </span>galaxy
driver:
<span class="w">  </span>name:<span class="w"> </span>podman
platforms:
<span class="w">  </span>-<span class="w"> </span>name:<span class="w"> </span>instance
<span class="w">    </span>image:<span class="w"> </span>docker.io/pycontribs/centos:7
<span class="w">    </span>pre_build_image:<span class="w"> </span><span class="nb">true</span>
provisioner:
<span class="w">  </span>name:<span class="w"> </span>ansible
verifier:
<span class="w">  </span>name:<span class="w"> </span>ansible
</pre></div>

<p>As per our requirements, this file specifies the Podman driver for
tests. It also defines a default platform "instance" using the container
image <code>docker.io/pycontribs/centos:7</code> that you'll change later.</p>
<p>Unlike Molecule v2, Molecule v3 does not specify a linter by default.
Open the configuration file <code>molecule/default/molecule.yml</code> using your
favorite editor to include the lint configuration at the end:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>vi<span class="w"> </span>molecule/default/molecule.yml
...
verifier:
<span class="w">  </span>name:<span class="w"> </span>ansible
lint:<span class="w"> </span><span class="p">|</span>
<span class="w">  </span><span class="nb">set</span><span class="w"> </span>-e
<span class="w">  </span>yamllint<span class="w"> </span>.
<span class="w">  </span>ansible-lint<span class="w"> </span>.
</pre></div>

<p>Save and close the configuration file. Run "molecule lint" from the
project root to lint the entire project:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>lint
</pre></div>

<p>This command returns a few errors because the file "meta/main.yml" is
missing some required values. Fix these issues by editing the file
"meta/main.yml" and adding "author", "company", "license", "platforms",
and removing the blank line at the end. Without comments - for brevity -
the "meta/main.yaml" looks like this:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">$ vi meta/main.yml</span>
<span class="l l-Scalar l-Scalar-Plain">galaxy_info</span><span class="p p-Indicator">:</span>
<span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ricardo Gerardi</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Mywebapp role deploys a sample web app</span>
<span class="w">  </span><span class="nt">company</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Red Hat</span>

<span class="w">  </span><span class="nt">license</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MIT</span>

<span class="w">  </span><span class="nt">min_ansible_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.9</span>

<span class="w">  </span><span class="nt">platforms</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rhel</span>
<span class="w">    </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu</span>
<span class="w">    </span><span class="nt">versions</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20.04</span>

<span class="w">  </span><span class="nt">galaxy_tags</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>

<span class="nt">dependencies</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
</pre></div>

<p>Now re-lint the project and verify that there are no errors this time.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>lint
--&gt;<span class="w"> </span>Test<span class="w"> </span>matrix

└──<span class="w"> </span>default
<span class="w">    </span>├──<span class="w"> </span>dependency
<span class="w">    </span>└──<span class="w"> </span>lint

--&gt;<span class="w"> </span>Scenario:<span class="w"> </span><span class="s1">'default'</span>
--&gt;<span class="w"> </span>Action:<span class="w"> </span><span class="s1">'dependency'</span>
Skipping,<span class="w"> </span>missing<span class="w"> </span>the<span class="w"> </span>requirements<span class="w"> </span>file.
Skipping,<span class="w"> </span>missing<span class="w"> </span>the<span class="w"> </span>requirements<span class="w"> </span>file.
--&gt;<span class="w"> </span>Scenario:<span class="w"> </span><span class="s1">'default'</span>
--&gt;<span class="w"> </span>Action:<span class="w"> </span><span class="s1">'lint'</span>
--&gt;<span class="w"> </span>Executing:<span class="w"> </span><span class="nb">set</span><span class="w"> </span>-e
yamllint<span class="w"> </span>.
ansible-lint<span class="w"> </span>.
</pre></div>

<p>The role is initialized and the basic molecule configuration is in place.
Let's set up the test instances next.</p>
<h3>Setting up Instances</h3>
<p>By default, Molecule defines a single instance named "instance" using
the "Centos:7" image. According to our requirements, we want to ensure
our role works with RHEL 8 and Ubuntu 20.04. In addition, because this
role starts the Apache web server as a system service, we need to use
container images that enable "systemd".</p>
<p>Red Hat provides an official <a href="https://www.redhat.com/en/blog/introducing-red-hat-universal-base-image">Universal Base Image</a>
for RHEL 8, which enables "systemd": </p>
<ul>
<li><code>registry.access.redhat.com/ubi8/ubi-init</code></li>
</ul>
<p>For Ubuntu, there's no official "systemd" enabled images so we'll use an
image maintained by Jeff Geerling from the Ansible open-source
community:</p>
<ul>
<li><code>geerlingguy/docker-ubuntu2004-ansible</code></li>
</ul>
<p>To enable the "systemd" instances, modify the
"molecule/default/molecule.yml" configuration file, remove the
"centos:7" instance and add the two new instances.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>vi<span class="w"> </span>molecule/default/molecule.yml
---
dependency:
<span class="w">  </span>name:<span class="w"> </span>galaxy
driver:
<span class="w">  </span>name:<span class="w"> </span>podman
platforms:
<span class="w">  </span>-<span class="w"> </span>name:<span class="w"> </span>rhel8
<span class="w">    </span>image:<span class="w"> </span>registry.access.redhat.com/ubi8/ubi-init
<span class="w">    </span>tmpfs:
<span class="w">      </span>-<span class="w"> </span>/run
<span class="w">      </span>-<span class="w"> </span>/tmp
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span>/sys/fs/cgroup:/sys/fs/cgroup:ro
<span class="w">    </span>capabilities:
<span class="w">      </span>-<span class="w"> </span>SYS_ADMIN
<span class="w">    </span>command:<span class="w"> </span><span class="s2">"/usr/sbin/init"</span>
<span class="w">    </span>pre_build_image:<span class="w"> </span><span class="nb">true</span>
<span class="w">  </span>-<span class="w"> </span>name:<span class="w"> </span>ubuntu
<span class="w">    </span>image:<span class="w"> </span>geerlingguy/docker-ubuntu2004-ansible
<span class="w">    </span>tmpfs:
<span class="w">      </span>-<span class="w"> </span>/run
<span class="w">      </span>-<span class="w"> </span>/tmp
<span class="w">    </span>volumes:
<span class="w">      </span>-<span class="w"> </span>/sys/fs/cgroup:/sys/fs/cgroup:ro
<span class="w">    </span>capabilities:
<span class="w">      </span>-<span class="w"> </span>SYS_ADMIN
<span class="w">    </span>command:<span class="w"> </span><span class="s2">"/lib/systemd/systemd"</span>
<span class="w">    </span>pre_build_image:<span class="w"> </span><span class="nb">true</span>
provisioner:
<span class="w">  </span>name:<span class="w"> </span>ansible
verifier:
<span class="w">  </span>name:<span class="w"> </span>ansible
lint:<span class="w"> </span><span class="p">|</span>
<span class="w">  </span><span class="nb">set</span><span class="w"> </span>-e
<span class="w">  </span>yamllint<span class="w"> </span>.
<span class="w">  </span>ansible-lint<span class="w"> </span>.
</pre></div>

<p>With these parameters, we're mounting the temporary filesystem "/run"
and "/tmp", as well as the "cgroup" volume for each instance. We're also
enabling the "SYS_ADMIN" capability, as they are required to run a
container with Systemd.</p>
<p>Also, if you're following this tutorial on a RHEL 8 machine with SELinux
enabled - as it should - you need to set the "container_manage_cgroup"
boolean to true to allow containers to run Systemd. See the RHEL 8
<a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/building_running_and_managing_containers/index#starting_services_within_a_container_using_systemd">documentation</a>
for more details:</p>
<div class="code"><pre class="code literal-block">sudo<span class="w"> </span>setsebool<span class="w"> </span>-P<span class="w"> </span>container_manage_cgroup<span class="w"> </span><span class="m">1</span>
</pre></div>

<p>Molecule uses an Ansible Playbook to provision these instances. Modify
and add parameters for provisioning by modifying the "provisioner"
dictionary in the "molecule/default/molecule.yml" configuration file. It
accepts the same configuration options provided in an Ansible
configuration file "ansible.cfg". For example, update the provisioner
configuration by adding a "defaults" section. Set the Python interpreter
to "auto_silent" to prevent warnings. Enable the "profile_tasks",
"timer", and "yaml" callback plugins to output profiling information
with the playbook output. Then, add the "ssh_connection" section and
disable SSH pipelining because it does not work with Podman:</p>
<div class="code"><pre class="code literal-block"><span class="nt">provisioner</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible</span>
<span class="w">  </span><span class="nt">config_options</span><span class="p">:</span>
<span class="w">    </span><span class="nt">defaults</span><span class="p">:</span>
<span class="w">      </span><span class="nt">interpreter_python</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">auto_silent</span>
<span class="w">      </span><span class="nt">callback_whitelist</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">profile_tasks, timer, yaml</span>
<span class="w">    </span><span class="nt">ssh_connection</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pipelining</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>

<p>Save the configuration file and create the instances by running
"molecule create" from the role root directory:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>create
</pre></div>

<p>Molecule runs the provisioning playbook and creates both instances. You
can check the instances by running "molecule list":</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>molecule<span class="w"> </span>list
Instance<span class="w"> </span>Name<span class="w">    </span>Driver<span class="w"> </span>Name<span class="w">    </span>Provisioner<span class="w"> </span>Name<span class="w">    </span>Scenario<span class="w"> </span>Name<span class="w">    </span>Created<span class="w">    </span>Converged
---------------<span class="w">  </span>-------------<span class="w">  </span>------------------<span class="w">  </span>---------------<span class="w">  </span>---------<span class="w">  </span>-----------
rhel8<span class="w">            </span>podman<span class="w">         </span>ansible<span class="w">             </span>default<span class="w">          </span><span class="nb">true</span><span class="w">       </span><span class="nb">false</span>
ubuntu<span class="w">           </span>podman<span class="w">         </span>ansible<span class="w">             </span>default<span class="w">          </span><span class="nb">true</span><span class="w">       </span><span class="nb">false</span>
</pre></div>

<p>You can also verify that both containers are running in Podman:</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>podman<span class="w"> </span>ps
CONTAINER<span class="w"> </span>ID<span class="w">  </span>IMAGE<span class="w">                                                   </span>COMMAND<span class="w">               </span>CREATED<span class="w">             </span>STATUS<span class="w">                 </span>PORTS<span class="w">  </span>NAMES
2e2f14eaa37b<span class="w">  </span>docker.io/geerlingguy/docker-ubuntu2004-ansible:latest<span class="w">  </span>/lib/systemd/syst...<span class="w">  </span>About<span class="w"> </span>a<span class="w"> </span>minute<span class="w"> </span>ago<span class="w">  </span>Up<span class="w"> </span>About<span class="w"> </span>a<span class="w"> </span>minute<span class="w"> </span>ago<span class="w">         </span>ubuntu
2ce0a0ea8692<span class="w">  </span>registry.access.redhat.com/ubi8/ubi-init:latest<span class="w">         </span>/usr/sbin/init<span class="w">        </span>About<span class="w"> </span>a<span class="w"> </span>minute<span class="w"> </span>ago<span class="w">  </span>Up<span class="w"> </span>About<span class="w"> </span>a<span class="w"> </span>minute<span class="w"> </span>ago<span class="w">         </span>rhel8
</pre></div>

<p>While developing the role, Molecule uses the running instances to test
it. In case a test fails, or an error causes an irreversible change that
requires you to start over, delete these instances by running "molecule
destroy" and recreate them with "molecule create" at any time.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-8/" class="u-url">Bullhorn #8</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-8/" rel="bookmark">
                <time class="published dt-published" datetime="2020-08-19T15:00:00Z" itemprop="datePublished" title="2020-08-19 15:00">2020-08-19 15:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<tr>
<td class="mcnTextContent" style='padding: 0px 18px 9px;font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;word-break: break-word;color: #202020;font-size: 16px;line-height: 150%;text-align: left;' valign="top">

                            <h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">The Bullhorn</h2>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'><em>A Newsletter for the Ansible Developer Community</em><br><br>
Welcome to <em>The Bullhorn</em>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, please reach out to us at the-bullhorn@redhat.com, or comment on this <a href="https://github.com/ansible/community/issues/546" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">GitHub issue</a>.<br>
 </p>

<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE 2.10.0 ALPHA 9 NOW AVAILABLE</h3>
The Ansible Community team announced the availability of Ansible 2.10.0 Alpha 9 on August 14th. This new Ansible package should be a drop-in replacement for Ansible 2.9; the roles and playbooks that you currently use should work out of the box with ansible-2.10.0 alpha9. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/#!topic/ansible-devel/iZRpeNl0JNQ" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Toshio Kuratomi’s announcement to the ansible-devel mailing list</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE-BASE 2.10.0 NOW GENERALLY AVAILABLE</h3>
The Ansible Base team announced the general availability of ansible-base 2.10.0 on August 13th. This ansible-base package consists of only the Ansible execution engine, related tools (e.g. ansible-galaxy, ansible-test), and a very small set of built-in plugins, and is also bundled with the larger Ansible distribution. For more information on how to download, test, and report issues, read <a href="https://groups.google.com/forum/#!topic/ansible-devel/T6sZnzAPDZA" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Rick Elrod’s announcement to the ansible-devel mailing list</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE 2.9.12 AND 2.8.14 RELEASED</h3>
The Ansible Core team announced the availability of Ansible 2.9.12 and Ansible 2.8.14 on August 10th, both of which are maintenance releases. Follow <a href="https://groups.google.com/forum/#!topic/ansible-devel/YWwDsuo1Vs4" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">this link</a> for Rick Elrod’s email to the ansible-devel mailing list, to obtain details on what’s new, installation instructions, and links to the full changelogs.<br>
 
<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">NEW/UPDATED COMMUNITY COLLECTIONS</h3>
<a href="https://github.com/containers/ansible-podman-collections" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Podman collection</a> has been updated recently with new Podman modules: <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/modules/podman_volume.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">podman_volume</a> to manage Podman container volumes on the host, <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/modules/podman_pod.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">podman_pod</a> and <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/modules/podman_pod_info.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">podman_pod_info</a> - for managing Podman pods. <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/connection/podman.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Podman</a> and <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/connection/buildah.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Buildah</a> connection plugins now support non-root users connections. All modules and plugins support Podman both versions v1 and v2. A few bugs of idempotency for <a href="https://github.com/containers/ansible-podman-collections/blob/master/plugins/modules/podman_container.py" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">podman_container</a> module have been fixed. You can find updated documentation <a href="https://docs.ansible.com/ansible/2.10/collections/containers/podman/index.html#plugins-in-containers-podman" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a>.<br><br>
The Red Hat Automation Community of Practice has created a Galaxy Collection for <a href="https://galaxy.ansible.com/redhat_cop/tower_configuration" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">AWX and Tower Configuration</a>. The goal is to allow users to define all AWX/Tower Objects as Code. If you manage large scale, complex AWX or Tower instances it is worth checking out.<br><br><a href="https://community.ibm.com/community/user/ibmz-and-linuxone/blogs/eric-su1/2020/08/07/ibm-zos-core-collection-v1-2-0-beta1-release" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Here's an update</a> on the latest beta release of the <a href="https://galaxy.ansible.com/ibm/ibm_zos_core" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">IBM z/OS core collection</a>, including three new z/OS core modules in Ansible Galaxy: <a href="https://ansible-collections.github.io/ibm_zos_core/modules/zos_mvs_raw.html" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">zos_mvs_raw</a>, <a href="https://ansible-collections.github.io/ibm_zos_core/modules/zos_lineinfile.html" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">zos_lineinfile</a>, and <a href="https://ansible-collections.github.io/ibm_zos_core/modules/zos_copy.html" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">zos_copy</a>.<br><br>
The collections for Zabbix and Grafana are now both at version 1.0.0, freshly released by the community over the weekend on August 16th! They are available on Ansible Galaxy: <a href="https://galaxy.ansible.com/community/grafana" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Grafana collection</a> and <a href="https://galaxy.ansible.com/community/zabbix" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Zabbix collection</a>.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">COLLECTION PROPOSALS</h3>
YANG and NETCONF are vendor agnostic IETF standards that are used mainly for network device management. The proposal <a href="https://github.com/ansible-collections/community.yang/issues/3" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">linked here</a> outlines how Ansible plugins in <a href="https://github.com/ansible-collections/community.yang" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">community.yang</a> collection will ease managing YANG and NETCONF enabled devices using structured data. The plugins will provide maximum flexibility (YANG variant independent) and provide a simple-to-use approach. Review comments/suggestions/feedback are welcomed from the community.<br>
 
<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE-LINT 4.3.0 RELEASED WITH ANSIBLE 2.10 SUPPORT</h3>
The ansible-lint community is happy to <a href="https://www.reddit.com/r/ansible/comments/ibzaw7/ansiblelint_430_was_released_with_ansible_210/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">announce the release</a> of ansible-lint 4.3.0. This release includes more than 330 commits since v4.2.0.1, made over the past 6 months.<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE COMMUNITY STATS UPDATE</h3>
With two Virtual Contributor Summits under our belt (and thus two surveys) we can start to look at the data they provide. <a href="https://twitter.com/Gwmngilfen" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Greg</a> plans to do a longer post after the next Summit, looking at trends and so forth, but for now, here’s how people felt about the July Summit - pretty positive!<br><br><a href="https://mcusercontent.com/56d874e027110e35dea0e03c1/images/e5c10386-1f0d-4c4c-ba34-d651c4e42359.png" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;"><img data-file-id="5382545" src="https://mcusercontent.com/56d874e027110e35dea0e03c1/images/e5c10386-1f0d-4c4c-ba34-d651c4e42359.png" style="border: 0px initial;width: 600px;height: 333px;margin: 0px;outline: none;text-decoration: none;-ms-interpolation-mode: bicubic;" width="600" height="333"></a><br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">CONTENT FROM THE ANSIBLE COMMUNITY</h3>

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://dev.to/imjoseangel/release-and-deploy-ansible-collection-with-github-actions-4a62" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Release and Deploy Ansible Collection with GitHub Actions</a> by <a href="https://dev.to/imjoseangel" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Jose Angel Munoz</a>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://medium.com/@AbhijeetKasurde/ansible-generating-password-with-constraints-f475bb77d023" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible: Generating password with constraints</a> by <a href="https://akasurde.github.io/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Abhijeet Kasurde</a>
</li>
</ul>
 

<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">THE ANSIBLE COMMUNITY TEAM IS HIRING</h3>
The Ansible Community team is hiring engineers to help with onboarding Ansible contributors. For more info, please see the following job descriptions:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://global-redhat.icims.com/jobs/80815/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - EU</a></li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://us-redhat.icims.com/jobs/80814/senior-software-community-engineer---ansible-project/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Senior Software Community Engineer - Ansible Project - US</a></li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;"><a href="https://us-redhat.icims.com/jobs/77049/technical-writer/job?hub=7" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Technical Writer - Ansible Project - US</a></li>
</ul>
 

<h3 class="mc-toc-title" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLEFEST VIRTUAL EXPERIENCE 2020</h3>
This year’s AnsibleFest will be a virtual experience! Find out the latest details about the event in <a href="https://www.ansible.com/blog/ansiblefest-2020-the-biggest-ansiblefest-ever" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">this blog post</a>, and register <a href="https://www.ansible.com/ansiblefest" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">here</a>. We are also having our <a href="https://github.com/ansible/community/wiki/Contributor-Summit" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Contributor Summit</a> alongside AnsibleFest. More details will be shared soon!<br>
 
<h3 class="null" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">ANSIBLE VIRTUAL MEETUPS</h3>
The following virtual meetups are being held in the Ansible community over the next month:

<ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-Minneapolis/events/sbqkgrybclbbc/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Minneapolis</a>: Enhancing Cisco ACI Automation with Ansible Tower and Collections

    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Thu, Aug 20 · 6:30 PM CDT<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-Toronto/events/272634401/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible Toronto</a> August 2020 (virtual)
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Tue, Aug 25 · 12:00 PM EDT<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-NYC/events/272498156/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible NYC</a>: Multicloud Networking Leveraging Ansible and Pureport
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Tue, Aug 25 · 6:00 PM EDT<br>
         </li>
    </ul>
</li>
    <li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">
<a href="https://www.meetup.com/Ansible-London/events/272502539/" target="_blank" style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #007C89;font-weight: normal;text-decoration: underline;">Ansible London</a> [virtual] meetup – 10th Sept
    <ul>
<li style="mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;">Thu, Sep 10 · 5:45 PM GMT+1</li>
    </ul>
</li>
</ul>
 <br><em><strong>Note:</strong> For these virtual meetups, the links to participate will be visible once you RSVP to attend. If you’re interested in the topics presented, you can join from anywhere in the world as long as the time zone and language works for you!</em><br>
 
<h3 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 22px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;">FEEDBACK</h3>

<p dir="ltr" style='font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;margin: 10px 0;padding: 0;mso-line-height-rule: exactly;-ms-text-size-adjust: 100%;-webkit-text-size-adjust: 100%;color: #202020;font-size: 16px;line-height: 150%;text-align: left;'>Have any questions you’d like to ask, or issues you’d like to see covered? Please send us an email at the-bullhorn@redhat.com.</p>
 

<h2 class="null" dir="ltr" style="display: block;margin: 0;padding: 0;color: #202020;font-family: Helvetica;font-size: 26px;font-style: normal;font-weight: bold;line-height: 125%;letter-spacing: normal;text-align: left;"> </h2>

                        </td>
                    </tr>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="using-an-inventory-plugin-from-a-collection-in-ansible-tower/" class="u-url">Using an Inventory Plugin from a Collection in Ansible Tower</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/patrick-harrison/">Patrick Harrison</a>
              </span>
            </p>
            <p class="dateline">
              <a href="using-an-inventory-plugin-from-a-collection-in-ansible-tower/" rel="bookmark">
                <time class="published dt-published" datetime="2020-08-04T00:00:00Z" itemprop="datePublished" title="2020-08-04 00:00">2020-08-04 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Using an Inventory Plugin from a Collection in Ansible Tower</h2>
<p>Many IT environments grow more and more complex. It is more important
than ever that an automation solution always has the most up to date
information about what nodes are present and need to be automated. To
answer this challenge, the Red Hat Ansible Automation Platform uses
<a href="https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#intro-inventory">inventories</a>:
lists of managed nodes.</p>
<p>In its simplest form, inventories can be static files. This is ideal
when getting started with Ansible, but as the automation is scaled, a
static inventory file is not enough anymore:</p>
<ol>
<li>How do we update and maintain a list of all of our managed nodes if
    something changes, if workloads are spun up or teared down?</li>
<li>How do we classify our infrastructure so that we can be more
    selective in what managed nodes we automate against?</li>
</ol>
<p>The answer to both of these questions is to use a <a href="https://docs.ansible.com/ansible/latest/user_guide/intro_dynamic_inventory.html">dynamic inventory</a>:
a script or a plugin that will go to a source of truth and discover the
nodes that need to be managed. It will also automatically classify the
nodes by putting them into groups, which can be used to more selectively
target devices when automating with Ansible.</p>
<p><a href="https://docs.ansible.com/ansible/latest/plugins/inventory.html#plugin-list">Inventory plugins</a>
allow Ansible users to use external platforms to dynamically discover
target hosts and use those platforms as a Source of Truth for their
Ansible inventory. Common sources of truth include AWS EC2, Google GCP
and Microsoft Azure , but there are a number of other inventory plugins
available with Ansible.</p>
<p>Ansible Tower ships with <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/inventories.html#inventory-plugins">a number of inventory plugins</a>
that work out of the box. These include the cloud examples mentioned
earlier as well as VMware vCenter, Red Hat OpenStack Platform and  Red
Hat Satellite. To use these inventory plugins, credentials need to be
added that can query the source platform. Afterwards, the inventory
plugins can be used as a source for an inventory in Ansible Tower. </p>
<p>There are additional inventory plugins available, which are not shipped
with Ansible Tower, but which are written by the Ansible community. With
the move to Red Hat Ansible Content Collections
these inventory plugins are being packaged as part of the corresponding
Collections.</p>
<p>In this example, we are having a look at the ServiceNow inventory
plugin. ServiceNow is a very popular IT Service Management platform and
customers often use the ServiceNow CMDB to store details of all of their
devices. A CMDB can provide additional context to automation. For
example, server owner, service level (production/non-production) and
patch &amp; maintenance windows. Their Ansible Inventory plugin can be used
to query the ServiceNow CMDB and is delivered as part of the
<a href="https://galaxy.ansible.com/servicenow/servicenow">servicenow.servicenow collection available on galaxy</a>. </p>
<h2>Git Repository</h2>
<p>To use an inventory plugin from a Collection in Ansible Tower, we need
to source it from a Project. A Project within Ansible Tower is the
integration of a source control repository like a git repository. In
Ansible Tower, projects are used to pull Ansible Playbooks but also
variables and inventories. </p>
<p>The contents of my source control repository are very simple:</p>
<div class="code"><pre class="code literal-block">├──<span class="w"> </span>collections
│<span class="w">   </span>└──<span class="w"> </span>requirements.yml
└──<span class="w"> </span>servicenow.yml
</pre></div>

<p>The servicenow.yml file contains the details for the inventory plugin.
In our case, we  specify the correct table in the ServiceNow CMDB that
we want to use. We also select the fields we want to add as host_vars
and some information on the groups that we want it to create.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>cat<span class="w"> </span>servicenow.yml
plugin:<span class="w"> </span>servicenow.servicenow.now
table:<span class="w"> </span>cmdb_ci_linux_server
fields:<span class="w"> </span><span class="o">[</span>ip_address,fqdn,host_name,sys_class_name,name,os<span class="o">]</span>
keyed_groups:
<span class="w">  </span>-<span class="w"> </span>key:<span class="w"> </span>sn_sys_class_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>lower
<span class="w">    </span>prefix:<span class="w"> </span><span class="s1">''</span>
<span class="w">    </span>separator:<span class="w"> </span><span class="s1">''</span>
<span class="w">  </span>-<span class="w"> </span>key:<span class="w"> </span>sn_os<span class="w"> </span><span class="p">|</span><span class="w"> </span>lower
<span class="w">    </span>prefix:<span class="w"> </span><span class="s1">''</span>
<span class="w">    </span>separator:<span class="w"> </span><span class="s1">''</span>
</pre></div>

<p>Note that no details of the ServiceNow instance that we want to connect
to or any credentials are defined here. Those will be configured within
Ansible Tower later on.</p>
<p>The <a href="https://docs.ansible.com/ansible/latest/galaxy/user_guide.html#install-multiple-collections-with-a-requirements-file">collections/requirements.yml file</a>
is needed so that Ansible Tower can download the Collection and
therefore the inventory plugin. Otherwise, we would have to install and
maintain the Collection on all of our Ansible Tower nodes manually.</p>
<div class="code"><pre class="code literal-block">$<span class="w"> </span>cat<span class="w"> </span>collections/requirements.yml
---
collections:

-<span class="w"> </span>name:<span class="w"> </span>servicenow.servicenow
</pre></div>

<p>Once we have pushed this configuration into the source control
repository, we can create a project in Ansible Tower referencing the
repository. Below is an example that links Ansible Tower to my github
repository. Note the SCM URL. We can optionally specify a credential if
the repository is private and also specify a specific branch, tag or
commit to pull from.</p>
<p><img alt="plugin blog image one" src="../images/posts/archive/plugin-blog-one.png"></p>
<h2>Create the ServiceNow Credential</h2>
<p>As mentioned, the configuration in our repository does not include
credentials to use with ServiceNow, or the definition of the ServiceNow
instance to speak to. Thus we will create a credential in Ansible Tower
to define those values. Looking at the
<a href="https://github.com/ServiceNowITOM/servicenow-ansible/blob/devel/docs/inventory.md">documentation for the ServiceNow inventory plugin</a>,
we can see that there are a number of environment variables that we can
set to define the connection details. For example:</p>
<div class="code"><pre class="code literal-block"><span class="l l-Scalar l-Scalar-Plain">= username</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">The ServiceNow user account, it should have rights to read cmdb_ci_server (default), or table specified by SN_TABLE</span>

<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">set_via</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_USERNAME</span>
</pre></div>

<p>In this case, if the SN_USERNAME environment variable is set then the
inventory plugin will use it as the user account to connect to
ServiceNow.</p>
<p>The other variables we need to set are - <code>SN_INSTANCE</code> and <code>SN_PASSWORD</code></p>
<p>However, in Ansible Tower, there is no credential type for ServiceNow
where we can enter these details. Luckily for such use cases, Ansible
Tower allows us to define <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/credential_types.html">custom credential
types</a>.</p>
<p>In our case, the input configuration for a custom credential for
ServiceNow is as follows:</p>
<div class="code"><pre class="code literal-block"><span class="nt">fields</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_USERNAME</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Username</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_PASSWORD</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Password</span>
<span class="w">    </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_INSTANCE</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class="w">    </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Snow Instance</span>
<span class="nt">required</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_USERNAME</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_PASSWORD</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SN_INSTANCE</span>
</pre></div>

<p>The credentials will be exposed as environment variables of the same
name. This is described in the injector configuration:</p>
<div class="code"><pre class="code literal-block"><span class="nt">env</span><span class="p">:</span>
<span class="w">  </span><span class="nt">SN_INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">SN_INSTANCE</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">SN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">SN_PASSWORD</span><span class="nv"> </span><span class="s">}}'</span>
<span class="w">  </span><span class="nt">SN_USERNAME</span><span class="p">:</span><span class="w"> </span><span class="s">'{{</span><span class="nv"> </span><span class="s">SN_USERNAME</span><span class="nv"> </span><span class="s">}}'</span>
</pre></div>

<p>With the custom credential type defined, we can now add a ServiceNow
credential and set the instance, username and password as shown:</p>
<p><img alt="plugin blog image two" src="../images/posts/archive/plugin-blog-two.png"></p>
<h2>Create the Inventory</h2>
<p>The final step is to create the inventory within Ansible Tower. We need
a name - here ServiceNow: </p>
<p><img alt="plugin blog image three" src="../images/posts/archive/plugin-blog-three.png"></p>
<p>With the inventory created, we can now attach a source to it. Here we
specify the Project that we created earlier and enter the path to our
inventory YAML file in the source control repository- in this case, that
is servicenow.yml in the root of the project. We also need to associate
our ServiceNow credential.</p>
<p><img alt="plugin blog image four" src="../images/posts/archive/plugin-blog-four.png"></p>
<p>To test the setup, we can try syncing with the source. Pressing the
button "<strong>Sync all</strong>" does just that. If everything was configured
correctly, the hosts should be imported into the inventory:</p>
<p><img alt="plugin blog image 5" src="../images/posts/archive/plugin-blog-five.png"></p>
<p>Note the groups that we requested were also created.</p>
<h2>Summary</h2>
<p>In this example, we have shown how to use inventory plugins from
Collections within  Ansible Tower using the ServiceNow inventory plugin.
We have also securely defined the credentials to authenticate to our
ServiceNow instance. Sourcing an inventory plugin from a Project is not
exclusive to third party or custom plugins either: this is a valid
method for modifying the behaviour of some of the built-in inventory
plugins as well. These capabilities enable the Ansible Automation
Platform to seamlessly integrate with existing tools while automating IT
environments of growing complexity. </p>
          </div>
      </article><br><hr>
<br>
</div>
          <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-8.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-6.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/popper.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
