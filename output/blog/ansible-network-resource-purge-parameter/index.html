<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="This blog will cover the purged parameter and show use-cases through a practical example.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ansible Network Resource Purge parameter | Ansible Collaborative</title>
<link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../../assets/css/main.css">
<link rel="stylesheet" href="../../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/ansible-network-resource-purge-parameter/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Sean Cavanaugh">
<link rel="prev" href="../monitoring-as-code-with-sensu-ansible/" title="Monitoring as code with Sensu and Ansible" type="text/html">
<link rel="next" href="../bullhorn-26/" title="Bullhorn #26" type="text/html">
<meta property="og:site_name" content="Ansible Collaborative">
<meta property="og:title" content="Ansible Network Resource Purge parameter">
<meta property="og:url" content="https://ansible.com/blog/ansible-network-resource-purge-parameter/">
<meta property="og:description" content="This blog will cover the purged parameter and show use-cases through a practical example.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-05-10T00:00:00Z">
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../../">
        <img src="../../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="../archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
  <article class="post-text h-entry hentry postpage ansible-content" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Ansible Network Resource Purge parameter</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../authors/sean-cavanaugh/">Sean Cavanaugh</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-05-10T00:00:00Z" itemprop="datePublished" title="2021-05-10 00:00">2021-05-10 00:00</time></a>
            </p>
                    <p class="sourceline"><a href="index.md" class="sourcelink">Source</a></p>

        </div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
<h2>Ansible Network Resource Purge parameter</h2>
<p>Red Hat Ansible Network Automation continues to be a popular domain for
Red Hat Ansible Automation Platform. We have continually developed
additional <a href="https://docs.ansible.com/ansible/latest/network/user_guide/network_resource_modules.html">resource modules</a>
to make automating network appliances easier, and more approachable, for
novices and experts alike. These resource modules provide a consistent
experience across multiple network vendors. There are seven
main state parameters for resource modules: merged, replaced,
overridden, deleted, gathered, rendered and parsed. The Ansible network
team is adding one more parameter, purged, to this tool chest for
resource modules. This blog will cover the purged parameter and show
use-cases through a practical example.</p>
<p><img alt="network purge blog one" src="../../images/posts/archive/network-purge-blog-one.png"></p>
<p>For this example, we will be using two BGP resource modules to configure
a Cisco network device. We will be using the <code>bgp_global</code> module
and the <code>bgp_address_family</code> module. The BGP configuration is split
between these two separate modules to simplify configuration and data
models associated with them.</p>
<p>Let's start with a data model:</p>
<div class="code"><pre class="code literal-block"><span class="nt">bgp_global</span><span class="p">:</span>
<span class="w">    </span><span class="nt">as_number</span><span class="p">:</span><span class="w"> </span><span class="s">'65000'</span>
<span class="w">    </span><span class="nt">bgp</span><span class="p">:</span>
<span class="w">        </span><span class="nt">log_neighbor_changes</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">router_id</span><span class="p">:</span>
<span class="w">            </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
<span class="w">    </span><span class="nt">neighbor</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">activate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span>
<span class="w">        </span><span class="nt">remote_as</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65001</span>
<span class="nt">bgp_address_family</span><span class="p">:</span>
<span class="w">    </span><span class="nt">address_family</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">afi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ipv4</span>
<span class="w">        </span><span class="nt">neighbor</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">activate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">            </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.2</span>
<span class="w">        </span><span class="nt">network</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.25.25.0</span>
<span class="w">            </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.25.26.0</span>
<span class="w">            </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.100.100.0</span>
<span class="w">            </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.200.200.0</span>
<span class="w">            </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.16.0.0</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.1</span>
<span class="w">            </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">255.255.255.255</span>
<span class="w">    </span><span class="nt">as_number</span><span class="p">:</span><span class="w"> </span><span class="s">'65000’</span>
</pre></div>

<p><strong>NOTE</strong>: If you are new to resource modules, you can quickly create
these data models by using the <a href="https://github.com/network-automation/purge_blog_post/blob/main/playbooks/gather_ios_bgp.yaml">state: gathered</a>
parameter to read in a brown-field (already configured) network devices
and save that configuration to structured data (e.g. YAML) </p>
<p>We can push this data model configuration to our Cisco network device
very easily with a simple Ansible Playbook:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configure BGP for blog</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cisco</span>
<span class="w">  </span><span class="nt">gather_facts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use the bgp_global resource module</span>
<span class="w">    </span><span class="nt">cisco.ios.ios_bgp_global</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">bgp_global</span><span class="nv"> </span><span class="s">}}"</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use the bgp_address_family</span>
<span class="w">    </span><span class="nt">cisco.ios.ios_bgp_address_family</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">bgp_address_family</span><span class="nv"> </span><span class="s">}}</span>
</pre></div>

<p>You can copy this playbook directly from
<a href="https://github.com/network-automation/purge_blog_post/blob/main/playbooks/merge_ios_bgp.yaml">Github</a> </p>
<p>To execute the playbook:</p>
<div class="code"><pre class="code literal-block">ansible-playbook<span class="w"> </span>merge_ios_bgp.yaml
</pre></div>

<p>The output will look similar to the following:</p>
<p><img alt="network purge blog two" src="../../images/posts/archive/network-purge-blog-two.png"></p>
<p>Finally let's look at the generated configuration on our Cisco IOS network device:</p>
<div class="code"><pre class="code literal-block">rtr1#sh<span class="w"> </span>run<span class="w"> </span><span class="p">|</span><span class="w"> </span>s<span class="w"> </span>router<span class="w"> </span>bgp
router<span class="w"> </span>bgp<span class="w"> </span><span class="m">65000</span>
<span class="w"> </span>bgp<span class="w"> </span>router-id<span class="w"> </span><span class="m">192</span>.168.1.1
<span class="w"> </span>bgp<span class="w"> </span>log-neighbor-changes
<span class="w"> </span>neighbor<span class="w"> </span><span class="m">10</span>.200.200.2<span class="w"> </span>remote-as<span class="w"> </span><span class="m">65001</span>
<span class="w"> </span>!
<span class="w"> </span>address-family<span class="w"> </span>ipv4
<span class="w">  </span>network<span class="w"> </span><span class="m">10</span>.25.25.0<span class="w"> </span>mask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="w">  </span>network<span class="w"> </span><span class="m">10</span>.25.26.0<span class="w"> </span>mask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="w">  </span>network<span class="w"> </span><span class="m">10</span>.100.100.0<span class="w"> </span>mask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="w">  </span>network<span class="w"> </span><span class="m">10</span>.200.200.0<span class="w"> </span>mask<span class="w"> </span><span class="m">255</span>.255.255.0
<span class="w">  </span>network<span class="w"> </span><span class="m">172</span>.16.0.0
<span class="w">  </span>network<span class="w"> </span><span class="m">192</span>.168.1.1<span class="w"> </span>mask<span class="w"> </span><span class="m">255</span>.255.255.255
<span class="w">  </span>neighbor<span class="w"> </span><span class="m">10</span>.200.200.2<span class="w"> </span>activate
<span class="w"> </span>exit-address-family
</pre></div>

<p>So finally here is the easy part, using our new <code>state: purged</code> parameter:
you can delete the entire bgp configuration on a device using one task.
This might be often relevant on lab networks or when you want to start
with a clean-state configuration.</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Use the bgp_global resource module</span>
<span class="w">  </span><span class="nt">cisco.ios.ios_bgp_global</span><span class="p">:</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">purged</span>
</pre></div>

<h3>Difference between purged and deleted</h3>
<p>The <code>state: deleted</code> parameter is very similar, however it has two primary
purposes different than purged. Deleted has the ability to remove the
specified configuration with the config parameter. If no configuration
is specified it will delete that entire resource (e.g. all address
family configuration if using the bgp_address_family module). However,
there are multiple resource modules that make up BGP configuration. This
means you would need multiple modules running <code>state: deleted</code> to remove
all the BGP configuration. The <code>state: purged</code> parameter allows you to
use <code>bgp_global</code> resource module to remove all BGP configuration
simplifying your Ansible Playbooks.</p>
<p>Now we can execute the playbook and manually check the configuration to
see what it did:</p>
<p><img alt="network purge blog three" src="../../images/posts/archive/network-purge-blog-three.png"></p>
<p>In the above screenshot (from the Ansible Automation Platform Web UI)
you can see that the playbook ran successfully and the BGP configuration
is now removed.</p>
<p>Checking the running configuration on the Cisco router will reflect the change:</p>
<div class="code"><pre class="code literal-block">rtr1#sh<span class="w"> </span>run<span class="w"> </span><span class="p">|</span><span class="w"> </span>s<span class="w"> </span>router<span class="w"> </span>bgp
rtr1#
</pre></div>

<h3>Why would I use one over the other?</h3>
<p>Many people are automating brownfield networks, or even networks where a
mix of manual changes and automated changes are taking place. You might
want to remove all BGP configuration from multiple devices where you
have no SoT (Source of Truth) setup. This allows a playbook writer to
use one task to destroy just BGP configuration versus a multiple-module
method. This is just another tool in your resource module toolbelt!</p>
<h3>Where do I go next?</h3>
<p>All the examples in this blog post are on
<a href="https://github.com/network-automation/purge_blog_post">Github here</a>.</p>
</div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../monitoring-as-code-with-sensu-ansible/" rel="prev" title="Monitoring as code with Sensu and Ansible">Previous post</a>
            </li>
            <li class="next">
                <a href="../bullhorn-26/" rel="next" title="Bullhorn #26">Next post</a>
            </li>
        </ul></nav></aside></article><!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../../assets/js/jquery.min.js"></script><script src="../../assets/js/popper.min.js"></script><script src="../../assets/js/bootstrap.min.js"></script><script src="../../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
