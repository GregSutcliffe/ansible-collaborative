<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Ansible Collaborative Website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ansible Collaborative (old posts, page 14) | Ansible Collaborative</title>
<link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/baguetteBox.min.css" rel="stylesheet" type="text/css">
<link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
<link href="../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
<!-- Red Hat fonts --><link rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2.0.0/webfonts/red-hat-font.css">
<!-- Font Awesome --><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
<!-- Fork Awesome --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
<!-- Sass compiled css  --><link rel="stylesheet" href="../assets/css/main.css">
<link rel="stylesheet" href="../assets/css/redhat-footer.css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../rss.xml">
<link rel="canonical" href="https://ansible.com/blog/index-14.html">
<link rel="prev" href="index-15.html" type="text/html">
<link rel="next" href="index-13.html" type="text/html">
<!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->
</head>
<body id="top">

<div class="global-container" id="content" role="main">
<!-- Start menubar -->
<nav class="navbar navbar-expand-lg static-top mb-4 navbar-padding full-width-bg   navbar-dark   bg-pool   "><div class="masthead">
    <!-- This keeps the margins nice -->
    <a class="navbar-brand" href="../">
        <img src="../images/ansible_logo-small-15.png" alt="Ansible community logo" id="logo" class="d-inline-block align-top" width="50" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon nav-toggle-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="bs-navbar">
      <ul class="navbar-nav mr-auto"></ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Documentation
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="https://docs.ansible.com/" class="dropdown-item">
		        <i class=""></i> Project documentation
                    </a>
                    <a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/" class="dropdown-item">
		        <i class=""></i> Ansible Automation Platform documentation
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://galaxy.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Galaxy
		     </a>
		 </li>
                 <li class="nav-item">
		     <a href="https://forum.ansible.com/" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Forum
		     </a>
		 </li>
            <li class="nav-item dropdown">
	        <a href="#" class="nav-link nav-link-color dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		    <i class=""></i> Resources
                </a>
		<div class="dropdown-menu dropdown-menu-border">
	    
                    <a href="../how-ansible-works/" class="dropdown-item">
		        <i class=""></i> How Ansible works
                    </a>
                    <a href="../ecosystem/" class="dropdown-item">
		        <i class=""></i> Ansible ecosystem
                    </a>
                    <a href="archive.html" class="dropdown-item">
		        <i class=""></i> Blog
                    </a>
                    <a href="../faq/" class="dropdown-item">
		        <i class=""></i> Frequently asked questions
                    </a>
                    <a href="../ansible-community-training/" class="dropdown-item">
		        <i class=""></i> Ansible community training
                    </a>
                    <a href="../contact-us/" class="dropdown-item">
		        <i class=""></i> Contact us
                    </a>
            </div>
                 </li>
<li class="nav-item">
		     <a href="https://www.redhat.com/en/technologies/management/ansible?sc_cid=7015Y000003szaKQAQ" target="_blank" class="nav-link nav-link-color">
		         <i class=""></i> Ansible Automation Platform
		     </a>
		 </li>

        
      </ul>
</div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav><!-- End default Menubar --><div class="body-content center-band">
        <!--Body content-->
        
    
  <div class="postindex ansible-content">
      <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="two-simple-ways-automation-can-save-money-on-aws/" class="u-url">Two Simple Ways Automation Can Save You Money on Your AWS Bill</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/sean-cavanaugh/">Sean Cavanaugh</a>
              </span>
            </p>
            <p class="dateline">
              <a href="two-simple-ways-automation-can-save-money-on-aws/" rel="bookmark">
                <time class="published dt-published" datetime="2022-03-14T00:00:00Z" itemprop="datePublished" title="2022-03-14 00:00">2022-03-14 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Two Simple Ways Automation Can Save You Money on Your AWS Bill</h2>
<p>Red Hat Ansible Automation Platform is an excellent automation and
orchestration tool for public clouds. For this post, I am going to walk
through two common scenarios where Ansible Automation Platform can help
out. I want to look outside the common public cloud use-case of
provisioning and deprovisioning resources and instead look at automating
common operational tasks.</p>
<p><img alt="cloud engineer diagram" src="../images/posts/archive/cloud-engineer-diagram.png"></p>
<p>What is an operational task? It is simply anything that an administrator
has to do outside of creating and deleting cloud resources (e.g.
instances, networks, keys, etc.) to help maintain their company's
public cloud account. One of the problems I've encountered is instances
being left on, running up our public cloud bill in the background while
we were focusing our attention elsewhere. The more users you have, the
more likely problems are to occur; automation can help address these
issues and maintain control of your account. There are two common
scenarios I want to address here:</p>
<ol>
<li>Bespoke AWS instances were manually created for a one-off
    initiative, usually to test something, then instances were forgotten
    about and left running.</li>
<li>Continuous Integration (CI) instances were spun up to test changes
    programmatically every time a Pull Request (PR) went into our
    project, and would sometimes hit a corner case where not everything
    was deprovisioned correctly (turned off).</li>
</ol>
<p>In both cases, orphaned instances can be left on for a long time.
Imagine you spun up a couple dozen instances to test something on a
public cloud, then you got busy, lost track of time and forgot to
terminate the instances before stopping work for the day. That might be
16 hours (at minimum) of time when you were charged and received no
value out of the public cloud that your company was financing. Now
multiply this by dozens of users and that bill can end up in tens of
thousands of dollars really quickly.</p>
<h3>Use-case one: dealing with bespoke orphaned instances</h3>
<p>So let's tackle each of these issues and use Ansible Automation
Platform to automate a solution for the first scenario above where
instances are being spun up outside any automation guard rails (i.e.
they are not using any automation tools, including Ansible, to spin up
cloud resources). We require everyone on my team who has access to the
public cloud account to tag their instances. They must create a key,
pair tag that says: <code>owner: person</code></p>
<p><img alt="inventory tags screenshot" src="../images/posts/archive/inventory-tags.png"></p>
<p>This creates a really easy way to audit and see who (which person,
organization, or team) is accountable for billing, which is half the
battle. I am going to write a very simple Ansible Playbook that will
enforce this. I will use the fully supported amazon.aws collection to
demonstrate this.  </p>
<ul>
<li><strong>amazon.aws</strong></li>
<li>downstream content fully supported on <a href="https://cloud.redhat.com/ansible/automation-hub/repo/published/amazon/aws">Ansible automation hub</a>
</li>
<li>upstream code found on <a href="https://galaxy.ansible.com/amazon/aws">Ansible Galaxy</a>
</li>
</ul>
<p>The primary difference between the community and supported Collections
here is support with your Red Hat subscription. There is also
significant integration testing, code auditing and Python 3 / boto3
support with the fully supported amazon.aws collection that is included
as part of your Red Hat subscription.</p>
<h3>Dealing with untagged instances</h3>
<p>In my first Ansible Playbook, I want to get a list of all instances that
have no tags. First, let's retrieve all instances in a particular
region that are running:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grab info for un-tagged instances</span>
<span class="w">  </span><span class="nt">amazon.aws.ec2_instance_info</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">instance-state-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">running</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ec2_node_info</span>
</pre></div>

<p>I am using the ec2_instance_info module found in the AWS Collection,
part of the Amazon namespace. This task retrieves all instances
(regardless of tags). I found the easiest way was to grab everything
then filter out for empty tags:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set the untagged to a var</span>
<span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nt">untagged_instances</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_node_info.instances</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">selectattr('tags',</span><span class="nv"> </span><span class="s">'equalto',</span><span class="nv"> </span><span class="s">{})</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='instance_id')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>This
<a href="https://docs.ansible.com/ansible/latest/user_guide/complex_data_manipulation.html#data-manipulation">selectattr</a>
filter is simply matching any instance that has no tags with the
<code>['tags', 'equalto', {} ]</code></p>
<p>I can then simply terminate these since my colleague didn't follow my
well establish guidelines:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Terminate every un-tagged running instance in a region.</span>
<span class="w">  </span><span class="nt">amazon.aws.ec2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="w">    </span><span class="nt">instance_ids</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">untagged_instances</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">untagged_instances | length  &gt; 0</span>
</pre></div>

<p>However, since you might be more forgiving than me, you could use
<code>state: stopped</code> versus
absent which will turn them off versus terminate them.</p>
<h3>Retrieving any instances with missing tags</h3>
<p>To expand on the above, we don't just care about instances that are
untagged entirely (meaning there are no tags at all), but we are
specifically looking for the owner tag. I now want to retrieve any
instance that is missing the owner tag. I can use the exact same logic
as above but instead use the selectattr filter to look for undefined. </p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">set the missing tag to a var</span>
<span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nt">missing_tag</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_node_info.instances</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">selectattr('tags.owner',</span><span class="nv"> </span><span class="s">'undefined')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">map(attribute='instance_id')</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">list</span><span class="nv"> </span><span class="s">}}"</span>
</pre></div>

<p>I wanted to show both examples above to give a path to
operationalization. Implementing the above using Ansible Automation
Platform, your organization can now understand that they need to use
tags, or their instances will be turned off (or worse!). Going further,
the organization could use automation to enforce a particular tag to
assign ownership, or action on the instance will be taken. You could use
one or both of these previous examples.</p>
<h3>Use-case two: Dealing with automated instances</h3>
<p>For my particular use-case I have a code repository that is
automatically tested. Our code is tested nightly, and everytime there is
a Pull Request (PR) into the code repository. The CI testing will
provision instances on AWS, configure the instances, run through
automated tests, then deprovision them. Sometimes the deprovisioning
step will not complete successfully, leaving orphaned hosts. One of the
common things I have noticed is that the instances are often found
partially turned off, where their tags are completely missing (removed)
but the instances are not actually off, so we are still getting billed.
The above Ansible Playbook in the previous example can catch that.</p>
<p>However another great test is to use a new uptime parameter.</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grab info</span>
<span class="w">  </span><span class="nt">amazon.aws.ec2_instance_info</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">uptime</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">121</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="nt">instance-state-name</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="s">"running"</span><span class="w"> </span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="s">"tag:ansible-workshops"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ec2_node_info</span>
</pre></div>

<p>In this task there are two parameters I want to call out. First is the
uptime parameter (added in the 1.4.0 of amazon.aws), which will only
return instances that have run for more than that integer in minutes.
For this example it has to run for more than 121 minutes, or more than
two hours. I know that my CI testing should never take more than two
hours. Either the instance is stuck, my automated testing broke, or
deprovisioning didn't happen successfully.</p>
<p>The other tag here is simply a filter so that I only return instances
that are part of my automated testing (versus other initiatives). In
this example, it has to be a
<a href="https://github.com/ansible/workshops">workshop</a>. Now it should click
why I need the "no tagged" example at the beginning! This entire
operational task will fail if there is no tag at all. So the no tags
use-case overlaps with every other use case because of how important
tags can be in public cloud infrastructure. </p>
<h3>Automating the automation</h3>
<p>So this automation is great and all, but manually running playbooks only
saves you so much time. I went ahead and used the <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/workflows.html">Ansible workflows</a>
feature to hit multiple regions at once, and then schedule it so that my
automation jobs run every hour.</p>
<p><img alt="ansible workflow diagrams" src="../images/posts/archive/automating-automation.png"></p>
<p>Each rectangle on the right represents an automation
<a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html">job</a>.
Each job in the same column is run in parallel on my Ansible Automation
Platform cluster. Each job template is set to a different region. I also
used the <a href="https://docs.ansible.com/ansible-tower/latest/html/userguide/job_templates.html#surveys">survey feature</a>
to make this easy to configure from the Web UI.</p>
<p><img alt="screenshot" src="../images/posts/archive/aws-untagged-instances.png"></p>
<p>In my particular scenario I was running automated testing in four AWS
regions (us-east-1, ap-northeast-1, ap-southeast-1 and eu-central-1).
Now that my workflow is complete, it is trivial to schedule my workflow
to run every hour.</p>
<p><img alt="screenshot" src="../images/posts/archive/schedule-details-ui.png"></p>
<p>Voila! Now I have automated testing behind the scenes to make sure that
no orphaned instances are running. For my particular use case this will
save a lot of money, and force a culture of accountability around public
cloud use so that costs are clear and transparent between team
members.  </p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-49/" class="u-url">Bullhorn #49</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-49/" rel="bookmark">
                <time class="published dt-published" datetime="2022-03-10T22:00:00Z" itemprop="datePublished" title="2022-03-10 22:00">2022-03-10 22:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #49, 2022-03-10 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="how-to-migrate-your-ansible-playbooks-to-support-aws-boto3/" class="u-url">How to Migrate your Ansible Playbooks to Support AWS boto3</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/sean-cavanaugh/">Sean Cavanaugh</a>
              </span>
            </p>
            <p class="dateline">
              <a href="how-to-migrate-your-ansible-playbooks-to-support-aws-boto3/" rel="bookmark">
                <time class="published dt-published" datetime="2022-03-07T00:00:00Z" itemprop="datePublished" title="2022-03-07 00:00">2022-03-07 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>How to Migrate your Ansible Playbooks to Support AWS boto3</h2>
<p>Red Hat Ansible Automation Platform is known for automating Linux,
Windows and networking infrastructure. While both the community version
of Ansible and our enterprise offering, Red Hat Ansible Automation
Platform, are prominently known for configuration management, this is
just a small piece of what you can really achieve with Ansible's
automation. There are many other use-cases that Ansible Automation
Platform is great at automating, such as your AWS, Azure or Google
public cloud </p>
<p><img alt="diagram of Ansible on public clouds" src="../images/posts/archive/ansible-public-clouds.png"></p>
<p>Ansible Automation Platform can automate deployments, migrations and
operational tasks for your public cloud. This is extremely powerful
because you can orchestrate your entire infrastructure
<a href="https://docs.ansible.com/automation-controller/latest/html/userguide/workflows.html">workflow</a>,
from cloud deployment, to instance configuration, to retirement, rather
than requiring a point tool for each separate use-case. This also allows
IT administrators to concentrate on automating business outcomes rather
than individual technology silos.</p>
<p>Specifically for this blog, I wanted to cover converting your Ansible
Playbooks for provisioning an instance on AWS from the unsupported ec2
module to the fully supported ec2_instance module. Amazon has deprecated
their Software Development Kit (SDK) Boto in favor of the newer fully
supported SDK Boto3. Alina Buzachis announced "What's New: The Ansible
AWS Collection 2.0 Release" back in October 2021, which includes full
support in our Red Hat Ansible Certified Content Collection for the
amazon.aws.ec2_instance module, which uses Python 3 and Boto3.</p>
<p>The supported ec2_instance module has existed for some time, but I had
not adopted it for my use-case yet because we needed one last feature
for parity with the older ec2 module.  Specifically, for demos and
workshops, I required the exact_count parameter. This allows me to boot
as many identical instances as I specify. For example, if I specify
exact_count: 50, it will spin up 50 identical Red Hat Enterprise Linux 8
instances.  </p>
<p>Using exact_count can save hours of time versus using a loop, and I
don't need a massive declarative file to represent my 50 servers; it's
just a tweak of a single parameter to make identical copies. <a href="https://github.com/ansible-collections/amazon.aws/pull/539">Luckily we
know that we have
parameter</a>,
so I started converting all workshops and demos that the technical
marketing team uses to Boto3.</p>
<p>Let's look at an older version of a task file from our technical
workshops so I can show you how to convert from ec2 to
<a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/ec2_instance_module.html#ansible-collections-amazon-aws-ec2-instance-module">ec2_instance</a>:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create EC2 instances for RHEL8</span>
<span class="w">  </span><span class="nt">ec2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">assign_public_ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-key"</span>
<span class="w">    </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_security_group</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">instance_type</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_info[rhel8].size</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">node_ami_rhel.image_id</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">exact_count</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">student_total</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">count_tag</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">Workshop_node1"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">    </span><span class="nt">instance_tags</span><span class="p">:</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">Workshop_node1"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">      </span><span class="nt">Workshop</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">Workshop_type</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">workshop_type</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">wait</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_wait</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">vpc_subnet_id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_id</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">device_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/sda1</span>
<span class="w">        </span><span class="nt">volume_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gp2</span>
<span class="w">        </span><span class="nt">volume_size</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_info[control_type].disk_space</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">        </span><span class="nt">delete_on_termination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">control_output</span>
</pre></div>

<p>For booting an instance into AWS, there are only six required
parameters. You need to specify a key (i.e. the SSH key to access the
image), security group (virtual firewall for your ec2 instances),
instance_type (e.g. t2.medium), a region (i.e. us-east-1), image (e.g.
an AMI for RHEL8) and a network interface or VPC subnet id
(vpc_subnet_id). </p>
<p>The rest of the parameters in my task above are for:</p>
<ul>
<li>tweaking the instance</li>
<li>adding a public IP address, increasing storage</li>
<li>changing the module behavior<ul>
<li>wait refers to waiting for the instance to reach running state,</li>
<li>exact_count refers to provisioning multiple instances in
    parallel</li>
</ul>
</li>
<li>tagging, which is just adding key value tags to the instance so we
    can filter on them in subsequent automation, or just sort easily in
    the AWS web console.</li>
</ul>
<p>To convert this to ec2_instance, there are only a few small tweaks you
need to make!</p>
<table>
<tr>
<th>ec2:</th>
    <th>ec2_instance:</th>
  </tr>
<tr>
<td>
      <pre><code>assign_public_ip: true</code></pre>
    </td>
    <td>
      <pre><code>network:
          assign_public_ip: true</code></pre>
    </td>
  </tr>
<tr>
<td>
      <pre><code>group: "{{ ec2_security_group }}"</code></pre>
    </td>
    <td>
      <pre><code>security_group: "{{ ec2_security_group }}"</code></pre>
    </td>
  </tr>
<tr>
<td>
      <pre><code>image: "{{ node_ami_rhel.image_id }}"</code></pre>
    </td>
    <td>
      <pre><code>image_id: "{{ node_ami_rhel.image_id }}"</code></pre>
    </td>
  </tr>
<tr>
<td>
      <pre><code>count_tag:
  Workshop_node1": "{{ ec2_name_prefix }}-node1"</code></pre>
    </td>
    <td>
      <pre><code>filters:
  "tag:Workshop_node1": "{{ ec2_name_prefix }}-node1"
</code></pre>
    </td>
  </tr>
<tr>
<td>
      <pre><code>instance_tags:</code></pre>
    </td>
    <td>
      <pre><code>tags:</code></pre>
    </td>
  </tr>
<tr>
<td>
      <pre><code>volumes:
  - device_name: /dev/sda1
  volume_type: gp2
  volume_size: "{{ ec2_info[control_type].disk_space }}"
  delete_on_termination: true</code></pre>
    </td>
    <td>
      <pre><code>volumes:
- device_name: /dev/sda1
  ebs:
  volume_type: gp2
  volume_size: "{{ ec2_info[rhel].disk_space }}"
  delete_on_termination: true</code></pre>
    </td>
  </tr>
</table>
<p>The entire modified task looks like the following:</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Create EC2 instances for node1</span>
<span class="w">  </span><span class="nt">ec2_instance</span><span class="p">:</span>
<span class="w">    </span><span class="nt">key_name</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-key"</span>
<span class="w">    </span><span class="nt">security_group</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_security_group</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">instance_type</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_info[rhel].size</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">image_id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">node_ami_rhel.image_id</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">exact_count</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">student_total</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">network</span><span class="p">:</span>
<span class="w">      </span><span class="nt">assign_public_ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="s">"tag:Workshop_node1"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">      </span><span class="nt">Workshop_node1</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">      </span><span class="nt">Workshop</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">uuid</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">guid</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">Workshop_type</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">workshop_type</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">wait</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_wait</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">vpc_subnet_id</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_vpc_subnet_id</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">device_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/dev/sda1</span>
<span class="w">        </span><span class="nt">ebs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">volume_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gp2</span>
<span class="w">          </span><span class="nt">volume_size</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_info[rhel].disk_space</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">          </span><span class="nt">delete_on_termination</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>While the task may look long, realize that optional tags are taking up
seven lines... which is OK, and I am displaying many default values.
Remember that there is no additional cost to add tags to cloud
resources, and they help with subsequent automation and filtering. I
once heard a colleague exclaim that you can never have too many tags!</p>
<p>Looking at the task above, you will see that anything with the tag
Workshop_node1: "-node1" will be used to verify whether existing
instances match. It will make sure that exact_count of instances exist
with the tag Workshop_node1. This can also be used in subsequent
automation to filter and retrieve just the instances you want.</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grab instance ids to tag rtr1</span>
<span class="w">  </span><span class="nt">ec2_instance_info</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">filters</span><span class="p">:</span>
<span class="w">      </span><span class="s">"tag:Workshop_node1"</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1_output</span>
</pre></div>

<p>This will retrieve all instances with their common tag. You will also
probably require unique tags for each instance. In that case, I
recommend the ec2_tag module, where
<a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html">looping</a>
is less time intensive (versus looping with the ec2_instance module):</p>
<div class="code"><pre class="code literal-block"><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ensure tags are present for node1</span>
<span class="w">  </span><span class="nt">ec2_tag</span><span class="p">:</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_region</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">item.1.instance_id</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">    </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
<span class="w">    </span><span class="nt">tags</span><span class="p">:</span>
<span class="w">      </span><span class="nt">Name</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">ec2_name_prefix</span><span class="nv"> </span><span class="s">}}-student{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">}}-node1"</span>
<span class="w">      </span><span class="nt">Index</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">item[0]</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">Student</span><span class="p">:</span><span class="w"> </span><span class="s">"student{{</span><span class="nv"> </span><span class="s">item.0</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">      </span><span class="nt">launch_time</span><span class="p">:</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">item.1.launch_time</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">  </span><span class="nt">with_indexed_items</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"{{</span><span class="nv"> </span><span class="s">node1_output.instances</span><span class="nv"> </span><span class="s">}}"</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node1_output.instances|length &gt; 0</span>
</pre></div>

<p>The ec2_tag module is great for when you need unique tags for a
particular cloud resource. In the example above, the name, index,
student identifier and launch time are unique for that resource. Again
there is no time punishment or cost to additional tags, so tag as much
as you want. So the workflow for provisioning a bunch of instances on
AWS would look like the following:</p>
<ol>
<li>provisioning in bulk <code>exact_count</code> amount of instances</li>
<li>register the output to a variable with either <code>ec2_instance</code> or <code>ec2_instance_info</code>
</li>
<li>for unique tags, loop over the instances with the <code>ec2_tag</code> module</li>
</ol>
<p>Thank you for reading through my blog and I hope this helped you on your Ansible cloud automation journey.</p>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-48/" class="u-url">Bullhorn #48</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-48/" rel="bookmark">
                <time class="published dt-published" datetime="2022-03-04T01:30:00Z" itemprop="datePublished" title="2022-03-04 01:30">2022-03-04 01:30</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #48, 2022-03-03 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-47/" class="u-url">Bullhorn #47</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-47/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-24T23:00:00Z" itemprop="datePublished" title="2022-02-24 23:00">2022-02-24 23:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #47, 2022-02-24 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="five-ways-to-get-started-with-network-automation/" class="u-url">Five ways to get started with network automation</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/sean-cavanaugh/">Sean Cavanaugh</a>
              </span>
            </p>
            <p class="dateline">
              <a href="five-ways-to-get-started-with-network-automation/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-21T00:00:00Z" itemprop="datePublished" title="2022-02-21 00:00">2022-02-21 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Five ways to get started with network automation</h2>
<p>As many of you know, Red Hat Ansible Automation Platform is a highly
flexible IT automation platform that can automate your Linux and Windows
instances, your VMware private cloud, your AWS, Azure or Google public
cloud, and even your security infrastructure.  Today I want to write
about one of my favorite use-cases; using Ansible Automation Platform
for network automation. It provides easy, highly customizable automation
for your routers and switches so you can automate them just like any
other IT infrastructure.</p>
<p>However, even though network automation has become increasingly popular,
most organizations are still managing their network infrastructure
manually by a CLI or GUI. Why is this? This manual CLI work often means
that network engineers are reactive and constantly drowning with
break-fix network issues because of manual mis-configurations, or the
inability to implement change quickly and efficiently.</p>
<p>Because network engineers are so busy firefighting in their day job,
they don't have time to look at a new activity like automating, even
though automation will save them time and money in the long run. I
fundamentally believe that network automation is not an all or nothing
situation.  You need to adopt network automation in small increments so
you can earn yourself, and your team more time.  In other words, start
small and think big. I put together this
<a href="https://youtu.be/wXUgYfZKMHU">video to help network engineers brainstorm five great use cases for network automation</a>.
This list is not exhaustive; there are many more use-cases that you can do with network automation,
but this is meant to give network administrators an idea of what is possible.</p>
<p>If you're looking to learn more about a specific use-case, you can jump
right to it:</p>
<ol>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=176s">configuration backup and restore</a></li>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=534s">infrastructure awareness</a></li>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=1015s">scoped configuration management</a></li>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=1259s">operational state validation</a></li>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=1606s">automated netops</a></li>
<li><a href="https://www.youtube.com/watch?v=wXUgYfZKMHU&amp;t=1870s">wrap up and next steps</a></li>
</ol>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-46/" class="u-url">Bullhorn #46</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-46/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-17T21:00:00Z" itemprop="datePublished" title="2022-02-17 21:00">2022-02-17 21:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #46, 2022-02-17 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="migrating-from-python-virtual-environments-to-automation-execution-environments-in-ansible-automation-platform-2/" class="u-url">Migrating from Python virtual environments to automation execution environments in Ansible Automation Platform 2</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/anshul-behl/">Anshul Behl</a>
              </span>
            </p>
            <p class="dateline">
              <a href="migrating-from-python-virtual-environments-to-automation-execution-environments-in-ansible-automation-platform-2/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-16T00:00:00Z" itemprop="datePublished" title="2022-02-16 00:00">2022-02-16 00:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <h2>Migrating from Python virtual environments to automation execution environments in Ansible Automation Platform 2</h2>
<p>Red Hat Ansible Tower (included in Ansible Automation Platform 1.x)
used Python virtual environments to manage dependencies and implement
consistent automation execution across multiple Red Hat Ansible
Automation Platform instances. This method of managing dependencies came
with its own set of limitations:</p>
<ul>
<li>Managing Python virtual environments across multiple Ansible Tower instances. </li>
<li>Confirming custom dependencies across Ansible Tower instances grew in complexity as more end-users interacted with it.</li>
<li>Python virtual environments were tightly coupled to the control plane, resulting in Operations teams bearing the majority of the burden to maintain them.</li>
<li>There were no tools supported and maintained by Red Hat to manage custom dependencies across Ansible Automation Platform deployments.</li>
</ul>
<p>Ansible Automation Platform 2 introduced automation execution environments.
These are container images in which all automation is packaged and run,
which includes components such as Ansible Core, Ansible Content
Collections, a version of Python, Red Hat Enterprise Linux UBI 8, and any additional
package dependencies.</p>
<h2>Why should you upgrade?</h2>
<p>Ansible Automation Platform 2, <a href="https://www.redhat.com/en/about/press-releases/red-hat-ansible-automation-platform-2-drives-cloud-native-automation-and-helps-developers-become-automators">announced at AnsibleFest 2021</a>,
comes with a re-imagined architecture that fully decouples the
automation control plane and execution plane. The new capabilities
enable easier to scale automation across the globe and allow you to run
your automation as close to the source as possible without being bound
to running automation in a single data center. It's more dynamic,
scalable, resilient and secure compared to Ansible Automation Platform 1.2.</p>
<p>If you are an existing Red Hat customer using Ansible Automation
Platform 1.2 (Ansible Tower 3.8), an important migration recommendation
is to convert any custom Python virtual environments in your cluster to
automation execution environments. This one-time effort opens the door
to take advantage of the latest Ansible Automation Platform 2
capabilities and the ability to execute consistent automation across
multiple platforms with lower long-term maintenance.</p>
<p>We will now explain this specific migration consideration and provide
you with some best practices on how to migrate to automation execution
environments.</p>
<h2>The manual process of upgrading</h2>
<p>As outlined in this
<a href="https://docs.ansible.com/automation-controller/4.1.0/html/upgrade-migration-guide/upgrade_to_ees.html">document</a>,
the manual process of upgrading to automation execution environments
would go something like this:</p>
<ol>
<li>Prerequisite is a running Ansible Automation Platform 1.2 cluster
    where customers have configured one or more custom Python virtual
    environments in addition to the default one.</li>
<li>Use the
    <code>awx-manage</code>
    command line utility present on the Ansible Tower node to get the
    list of custom Python virtual environments using the
    <code>list_custom_venvs</code> subcommand.</li>
<li>Run the <code>awx-manage export_custom_venv</code>
    command on each virtual environment to get the list of Python
    packages installed in that virtual environment.</li>
<li>Check the association of a virtual environment using the
    <code>awx-manage custom_venv_associations</code>
    command. This list of associations/information will help customers
    make associations of new execution environments in the Ansible
    Automation Platform 2.x cluster.</li>
<li>Filtering the above information manually and feeding the list of
    requirements from step 3 above to the execution environment builder
    (ansible-builder) to create necessary custom execution
    environment(s).</li>
</ol>
<p>Looking at the above process there can be two enhancements to this flow,
which would help customers adopt automation execution environments
faster:</p>
<ol>
<li>Exported requirements from step 3 above can be compared with the
    list of Python packages already present in the automation execution
    environment that will serve as the base layer for the newly created
    ones. This will be helpful, because there are dependencies that will
    already be resolved by the base automation execution environment and
    it will help customers if they can focus on <strong>what's needed</strong> when
    they start creating automation execution environments for their
    clusters.</li>
<li>Since we love Ansible, why not just automate the above process,
    right? :)</li>
</ol>
<h2>The automated process of upgrading</h2>
<p>The intent of this section is to explain how you can automate this
process using Ansible. We have a few example Ansible Content Collections
and roles that can be used to achieve this automation. The playbook
would look something like this at a high level:</p>
<ol>
<li>Pull the list of packages from all the custom Python virtual
    environments present on the Ansible Tower node in Ansible Automation
    Platform 1.2.</li>
<li>Compare the package lists from step 1 with the package list in the
    automation execution environment you decide to use as basis
    (ansible-2.9 in our example), to find the packages that are not
    present in the base.</li>
<li>List from step 2 can be fed to an Ansible Role that can automate the
    execution environment creation, keeping the base  as the one we did
    the comparison with in step 2.</li>
</ol>
<p>Let's take an existing Ansible Automation Platform 1.2 setup that has
two custom virtual environments, called custom-venv1 and custom-venv2,
which both have their own list of Python packages:</p>
<div class="code"><pre class="code literal-block"><span class="c1"># awx-manage export_custom_venv /opt/my-envs/custom-venv1/ -q</span>
<span class="l l-Scalar l-Scalar-Plain">certifi==2021.10.8</span>
<span class="l l-Scalar l-Scalar-Plain">charset-normalizer==2.0.10</span>
<span class="l l-Scalar l-Scalar-Plain">enum34==1.1.10</span>
<span class="l l-Scalar l-Scalar-Plain">future==0.18.2</span>
<span class="l l-Scalar l-Scalar-Plain">idna==3.3</span>
<span class="l l-Scalar l-Scalar-Plain">requests==2.27.1</span>
<span class="l l-Scalar l-Scalar-Plain">solidfire-sdk-python==12.3.0.203</span>
<span class="l l-Scalar l-Scalar-Plain">urllib3==1.26.8</span>

<span class="l l-Scalar l-Scalar-Plain"># awx-manage export_custom_venv /opt/my-envs/custom-venv2/ -q</span>
<span class="l l-Scalar l-Scalar-Plain">zabbix-api==0.5.4</span>
</pre></div>

<p>We will use a role packaged in the <a href="https://galaxy.ansible.com/redhat_cop/ee_utilities">redhat_cop.ee_utilities Collection</a>
called <code>virtualenv_migrate</code>, that is designed for this specific purpose
and run that against the Ansible Tower node. Below is a sample playbook
and inventory file respectively:</p>
<div class="code"><pre class="code literal-block"><span class="nn">---</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Review custom virtualenvs and diff packages from base EE</span>
<span class="w">  </span><span class="nt">hosts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tower</span>
<span class="w">  </span><span class="nt">become</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">venv_migrate_ee_python_list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="w">  </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Include venv_migrate role</span>
<span class="w">      </span><span class="nt">include_role</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redhat_cop.ee_utilities.virtualenv_migrate</span>
</pre></div>

<div class="code"><pre class="code literal-block"><span class="k">[tower]</span>
<span class="na">ansibletower.demoredhat.com</span>

<span class="k">[local]</span>
<span class="na">localhost</span>

<span class="k">[all:vars]</span>
<span class="na">venv_migrate_default_ee_url</span><span class="o">=</span><span class="s">"registry.redhat.io/ansible-automation-platform-21/ee-29-rhel8:latest"</span>
<span class="na">registry_username</span><span class="o">=</span><span class="s">myRedHatID</span>
<span class="na">registry_password</span><span class="o">=</span><span class="s">mypassword</span>
</pre></div>

<p>The output of the playbook is shown below. It did the comparison as
expected and gave us the list of packages from custom Python virtual
environments that were not present in the base automation execution
environment.</p>
<p>NOTE: The version based comparison for PIP packages is not included at this moment.</p>
<div class="code"><pre class="code literal-block">TASK<span class="w"> </span><span class="o">[</span>redhat_cop.tower_utilities.virtualenv_migrate<span class="w"> </span>:<span class="w"> </span>diff<span class="w"> </span><span class="p">|</span><span class="w"> </span>Show<span class="w"> </span>the<span class="w"> </span>packages<span class="w"> </span>that<span class="w"> </span>are<span class="w"> </span>extra<span class="w"> </span>from<span class="w"> </span>default<span class="w"> </span>EEs<span class="w"> </span><span class="k">in</span><span class="w"> </span>custom<span class="w"> </span>venvs.<span class="o">]</span><span class="w"> </span>******************************************************************************
ok:<span class="w"> </span><span class="o">[</span><span class="m">3</span>.228.23.40<span class="w"> </span>-&gt;<span class="w"> </span>localhost<span class="o">]</span><span class="w"> </span><span class="o">=</span>&gt;<span class="w"> </span><span class="o">{</span>
<span class="w">    </span><span class="s2">"msg"</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="s2">"/opt/my-envs/custom-venv1/"</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="s2">"certifi"</span>,
<span class="w">                </span><span class="s2">"charset-normalizer"</span>,
<span class="w">                </span><span class="s2">"enum34"</span>,
<span class="w">                </span><span class="s2">"future"</span>,
<span class="w">                </span><span class="s2">"solidfire-sdk-python"</span>
<span class="w">            </span><span class="o">]</span>
<span class="w">        </span><span class="o">}</span>,
<span class="w">        </span><span class="o">{</span>
<span class="w">            </span><span class="s2">"/opt/my-envs/custom-venv2/"</span>:<span class="w"> </span><span class="o">[</span>
<span class="w">                </span><span class="s2">"zabbix-api"</span>
<span class="w">            </span><span class="o">]</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">    </span><span class="o">]</span>
<span class="o">}</span>
</pre></div>

<p>The above output can be directly passed to another Ansible Role in the
same <a href="https://galaxy.ansible.com/redhat_cop/ee_utilities">redhat_cop.ee_utilities Collection</a>
called
<a href="https://github.com/redhat-cop/ee_utilities/tree/main/roles/ee_builder">ee_builder</a>;
its use case is to automate the execution environment creation process.</p>
<p>Briefly summing things up:</p>
<ul>
<li>We ran a playbook against the Ansible Tower node to gather Python
    packages (from custom Python virtual environments) that are not in
    the base automation execution environment.</li>
<li>Output from above can help the creation of custom automation
    execution environments using the ee_builder role that automates
    execution environment creation.</li>
</ul>
<h2>Key takeaways</h2>
<ul>
<li>Using this new Ansible Role in combination with the ee_builder role
    can be used to automate the migration from custom virtual
    environments to automation execution environments.</li>
<li>These roles are currently part of a community project and not
    officially supported by Red Hat. However, they can provide details
    in the understanding of the migration process.</li>
</ul>
</div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-45/" class="u-url">Bullhorn #45</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-45/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-10T22:00:00Z" itemprop="datePublished" title="2022-02-10 22:00">2022-02-10 22:00</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #45, 2022-02-10 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title">
            <a href="bullhorn-44/" class="u-url">Bullhorn #44</a>
          </h1>
          <div class="metadata">
            <p class="byline author vcard">
              <span class="byline-name fn" itemprop="author">
                  <a href="../authors/ansible-collaborative-et-al/">Ansible Collaborative, et al</a>
              </span>
            </p>
            <p class="dateline">
              <a href="bullhorn-44/" rel="bookmark">
                <time class="published dt-published" datetime="2022-02-03T22:30:00Z" itemprop="datePublished" title="2022-02-03 22:30">2022-02-03 22:30</time></a>
            </p>
          </div>
        </header><div class="p-summary entry-summary">
            <div>
<p><img alt="Ansible Bullhorn banner" src="../images/bullhorn-banner-mango.png"></p>
<p><em>A Newsletter for the Ansible Developer Community</em>
<em>Issue #44, 2022-02-03 (<a href="https://us19.campaign-archive.com/home/?u=56d874e027110e35dea0e03c1&amp;id=d6635f5420">Past Issues</a>)</em></p>
<p>Welcome to <a href="https://github.com/ansible/community/wiki/News#the-bullhorn">The Bullhorn</a>, our newsletter for the Ansible developer community. If you have any questions or content you’d like to share, you're welcome to chat with us in the <a href="https://matrix.to/#/#social:ansible.com">Ansible Social room on Matrix</a>, and mention <a href="https://matrix.to/#/@newsbot:ansible.im"><code>newsbot</code></a> to have your news item tagged for review for the next weekly issue!</p>
</div>
          </div>
      </article><br><hr>
<br>
</div>
          <ul class="pager postindexpager clearfix">
<li class="previous"><a href="index-15.html" rel="prev">Newer posts</a></li>
            <li class="next"><a href="index-13.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content-->
</div>
        <div class="content-slim redhat-footer">
      <div class="footer-left">
        <ul class="footer-left-links">
<li>
            <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
          </li>
          <li>
            <a href="https://www.redhat.com/en/about/privacy-policy" target="_blank">Privacy policy</a>
          </li>
          <li>
            <a href="https://docs.ansible.com/ansible/latest/community/code_of_conduct.html" target="_blank">Code of conduct</a>
          </li>
        </ul>
</div>
      <div class="footer-right">
        <span class="redhat">Powered by</span>
        <span class="redhat-logo">
          <a href="https://www.redhat.com/en/technologies/management/ansible" target="_blank">
            <img src="../assets/images/redhat_reversed.svg" alt="Red Hat logo." width="96" height="28"></a>
        </span>
      </div>
    </div>

</div>

            <script src="../assets/js/jquery.min.js"></script><script src="../assets/js/popper.min.js"></script><script src="../assets/js/bootstrap.min.js"></script><script src="../assets/js/baguetteBox.min.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
</script><script src="../assets/js/clipboard.min.js" type="text/javascript"></script><script src="../assets/js/clipboard.js" type="text/javascript"></script>
</body>
</html>
